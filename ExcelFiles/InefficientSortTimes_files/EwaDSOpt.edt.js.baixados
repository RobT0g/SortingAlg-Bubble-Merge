'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[16],{1125:function(t,C,a){a.d(C,"a",function(){return b});var c=a(520);const b=()=>{c.a.Hi('.ewa-ac{position:absolute;z-index:102;margin-top:1px;width:auto}.ewa-ac .ewa-ac-param{white-space:nowrap;margin-bottom:3px;direction:ltr}.ewa-ac .ewa-ac-param function_param_table{position:absolute}.ewa-ac .ewa-ac-param .ewa-function-help-link{text-decoration:underline}.ewa-lb{position:absolute;border:1px solid #a2a6ab;overflow-x:hidden;overflow-y:auto;cursor:default;background-color:#fff;color:#262626;font-size:12px;font-family:"Segoe UI";z-index:102;height:auto;margin:0 8px;touch-action:manipulation;vertical-align:middle}.ewa-lb.ewa-fb-refactor{position:relative;margin:0}.ewa-lb table{left:0;right:0;border-collapse:collapse}.ewa-lb table td{white-space:nowrap}.ewa-lb table td div.clip16x16{margin:0 0 0 2px}.ewa-lb table td.list-item{height:24px;padding:0 8px}.ewa-lb table td.list-item-selected{background-color:#d3f0e0}@media screen and (-ms-high-contrast:active){.ewa-lb table td.list-item-selected{border:2px solid #fff}}.ewa-lb table.list-table-touch td.list-item{height:35px}div#suggested_cells_list_box{margin:0}div#suggested_cells_list_box .list-table .ewa-suggested-cell-name{float:left;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}@font-face{font-family:"Segoe UI Semibold";font-weight:600;src:local("Segoe UI Semibold"),local("Segoe UI")}.ewa-lb table td.columnName-header{color:#666;font-size:12px;font-family:"Segoe UI Semibold";text-align:left;padding:3px 8px;text-overflow:ellipsis}.ewa-tt{background-color:#f7f7f7;border:1px solid #a2a6ab;color:#444;height:auto;vertical-align:middle;width:auto;z-index:102;font-size:8pt;margin:0;padding-bottom:3px;padding-top:2px}.ewa-root-ltr .ewa-tt{text-align:left;padding-left:5px;padding-right:7px}.ewa-root-rtl .ewa-tt{text-align:right;padding-left:7px;padding-right:5px}.ewa-dlg-function-link-container .ewa-fdb-help-link,.ewa-tt-rtl .ewa-fdb-help-link,.ewa-tt-ltr .ewa-fdb-help-link{color:#00f;text-decoration:underline}.ewa-function-link-container .ewa-function-udf-name,.ewa-function-link-container-udf .ewa-function-help-link{display:none}.ewa-root.rtl .ewa-function-link-container{text-align:left}')}},
1126:function(t,C,a){a.d(C,"a",function(){return r});t=a(0);C=a(245);var c=a(7),b=a(33),f=a(12),e=a(21),d=a(36),h=a(6);class r extends C.a{constructor(l){super(document.createElement("div"));this.GR=this.pKa=this.oKa=this.qKa=this.sKa=this.rKa=!1;this.uJ=null;this.visible=void 0;this.Crc=(u,v)=>{this.Vt(u,v)};this.qNa=()=>{this.Db.textBox.DF=!0};this.nAa=()=>{this.mz(!0)};this.mDf=()=>{this.Db.textBox.focus()};this.Vf=()=>{e.h(this.$).inRangePicker||(this.Ae=!1)};this.$=l;e.h(l)&&e.h(l).ga&&e.h(this.$).ga.FC(this.Vf);
this.tl=b.a.R5(l)}get rI(){return this.yu.rI}get Ae(){return this.yu.Ae}set Ae(l){this.yu.Ae=l}get Db(){return this.uJ}set Db(l){(this.uJ=l)&&this.uJ.v4d.add(this)}get YOh(){return b.a.tN()?-5:-40}get_visible(){return void 0!==this.visible?this.visible:this.visible=super.get_visible()}set_visible(l){if(this.visible===l)return l;this.visible=l;return super.set_visible(l)}Vt(){this.uDa(!1);this.yu.Vt()}dispose(){this.$&&e.h(this.$)&&e.h(this.$).ga&&e.h(this.$).ga.JI(this.Vf);this.$=null;super.dispose()}ai(l,
u,v=!1){l=!1;if((this.X2a||v)&&!this.oya()&&this.get_visible()&&this.Ae)switch(this.tl&&this.ZFc(u),u){case 1872288872:this.Ae=!1;l=!0;break;case -798660877:this.yu.EB(1);l=!0;break;case 137938150:this.yu.EB(-1);l=!0;break;case 2091832999:this.yu.EB(this.rI-1);l=!0;break;case 742457698:this.yu.EB(-(this.rI-1));l=!0;break;case 125627505:l=this.mz(!1);break;case 267796030:b.a.R5(this.$)&&(l=this.mz(!1))}return l}uDa(l){if(this.Ae||l){var u=e.h(this.$);l=u.domElement;var v=this.uJ.textBox.domElement,
x=d.a(this.$).Ph(v.offsetHeight),w=d.a(this.$).Ph(v.offsetTop),m=d.a(this.$).Ph(v.offsetWidth);v=d.a(this.$).Ph(v.offsetLeft);u=u.am;var n=h.AFrameworkApplication.sa&&h.AFrameworkApplication.sa.Pa.tf,z=$get(this.$.Ib+c.a.$1a,this.$.domElement);n&&(z=document.getElementById("EditorContainer"));var y=new Sys.UI.Point(u?this.yu.Zcc:0,u?this.YOh:r.yci);x=z.offsetTop+y.y+(b.a.tN()&&u?0:x+w);this.$.d6||(w=$get(c.a.Mta,this.$.domElement),x+=w&&!n?w.offsetHeight:0);w=this.domElement;w.style.top=f.HelperMethods.Ic(x);
v=z.offsetLeft+v+y.x;!b.a.tN()&&this.$.isChromeRtl?w.style.right=f.HelperMethods.Ic(u?this.yu.Zcc:l.offsetLeft+l.offsetWidth-v-m):w.style.left=f.HelperMethods.Ic(v)}}NUa(l){this.yu&&(l&&!this.GR?(this.yu.T$(this.mDf),this.yu.C1b(this.qNa),this.yu.eqb(this.nAa),this.GR=!0):this.GR&&(this.yu.Kea(this.mDf),this.yu.Pwc(this.qNa),this.yu.SLb(this.nAa),this.GR=!1))}ZFc(l){switch(l){case -798660877:case 137938150:case 2091832999:case 742457698:this.rKa=!0;break;case 125627505:this.qKa=!0;break;case 267796030:b.a.R5(this.$)&&
(this.oKa=!0)}}}r.Zcc=0;r.yci=1;Object(t.a)(r,"AutoCompleteControl",C.a,[531])},1127:function(t,C,a){a.d(C,"a",function(){return c});t=a(0);class c extends Sys.EventArgs{constructor(b,f=0,e="",d=""){super();this.length=b;this.selectedIndex=f;this.nG=e;this.description=d}}Object(t.a)(c,"ListEventArgs",Sys.EventArgs,[])},1128:function(t,C,a){a.d(C,"a",function(){return w});t=a(0);var c=a(14),b=a(29);C=a(864);var f=a(804),e=a(7),d=a(80),h=a(33),r=a(13),l=a(1),u=a(122),v=a(21),x=a(944);class w extends C.a{constructor(m,
n){super(m,n,new x.a(f.a.listItem,f.a.hFb,f.a.kFb,f.a.lFb));this.mgc=!1;this.Tnb=this.Sq=null;this.v1e=!1;this.visible=void 0;this.FCa(!0);this.v1e=l.EwaSettings.isChangeGateEnabled("OfficeVSO:5893822_FixFormulaBarXOffsetCrash")}get Zcc(){if(h.a.tN()){var m=document.getElementById(this.$.Ib+e.a.u1e);return!this.v1e||m?r.DOMElementExtensions.getBoundingClientRect(m).x:0}m=l.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.AddNamedRange",!1)?document.getElementById(e.a.lCd):document.getElementById(this.$.Ib+
e.a.lCd+"-"+e.a.cAf);c.ULS.shipAssertTag(537170323,0,!!m||this.$.MF,"AutoCompleteListBox.FormulaBarXOffset : Can't find the name box combobox element.");return m?m.offsetWidth:0}get qe(){return this.Tnb}set qe(m){this.Tnb=m}get Ae(){return void 0!==this.visible?this.visible&&0<this.Sq.length:(this.visible=r.DOMElementExtensions.isVisible(this.fg))&&0<this.Sq.length}set Ae(m){this.visible!==m&&(r.DOMElementExtensions.setVisible(this.fg,m),r.DOMElementExtensions.setVisible(this.nVa,m),this.visible=
m);const n=v.h(this.$).view;m?this.mgc||(n.qt(this.nIa.Crc),this.mgc=!0):(this.Sq.length=0,this.mgc&&(n.hr(this.nIa.Crc),this.mgc=!1))}Fza(){var m=460;const n=v.h(this.$);var z=n.domElement,y=this.nVa.style;const A=this.fg.offsetTop+this.Tj.offsetHeight*this.Tj.sectionRowIndex-this.fg.scrollTop;y.width="auto";y.whiteSpace="nowrap";y.position="absolute";const F=z.offsetLeft+z.offsetWidth-(this.domElement.offsetLeft+this.fg.offsetLeft+this.fg.offsetWidth+3);z=this.domElement.offsetLeft-3-(z.offsetLeft+
this.Zcc);m=Math.min(this.nVa.offsetWidth,m,Math.max(F,z));r.DOMElementExtensions.iw(this.nVa,m);y.whiteSpace="";y.position="absolute";A+3>this.fg.offsetTop+this.fg.offsetHeight||A<this.fg.offsetTop||(m=this.fg.offsetLeft-3-this.nVa.offsetWidth,y=this.fg.offsetLeft+this.fg.offsetWidth+3,r.DOMElementExtensions.updatePosition(this.nVa,z>F!==n.rtl?m:y,A,!1))}EB(m){super.EB(m);this.Fza()}Vt(){this.Fza()}Cta(){const m=this.Sn,n=this.fg,z=3===d.a.Eb||b.a.yp,y=z?this.dGb:this.rI;this.Ae=!0;n.style.height=
"auto";this.nIa.set_visible(!0);this.Ipb(m,z);this.Sq.length>y&&(r.DOMElementExtensions.pJ(n,Math.floor(n.offsetHeight*y/this.Sq.length)),n.style.overflowY="auto");r.DOMElementExtensions.iw(n,m.offsetWidth+(this.Sq.length>y?u.a.Xu:0))}}Object(t.a)(w,"AutoCompleteListBox",C.a,[])},1129:function(t,C,a){a.d(C,"a",function(){return d});t=a(0);var c=a(125),b=a(31),f=a(1),e=a(564);class d{constructor(l){this.mzf=l;this.LW=Object.assign({},r);this.Ivb=[];this.fpc=-1;(this.lzf=f.EwaSettings.isChangeGateEnabled("OfficeVSO:5999949_formulaTelemetryMetriThresholds"))&&
l&&(this.LW.countAboveThresholds={},l.forEach(u=>this.LW.countAboveThresholds[u]=0))}static get K_d(){return b.a.Ya.Ce.m}EUa(){this.fpc=d.K_d}P4(l,u=null){if(-1!==this.fpc||Object(e.b)(u))l?(this.Gpb(d.K_d-(u||this.fpc)),this.fpc=-1):this.LW.failedCount++}j_e(){this.LW.excludingFirstAction=d.i_e(this.Ivb);this.Ivb.push(this.LW.firstAction);this.LW.includingFirstAction=d.i_e(this.Ivb)}Gpb(l){this.LW.count?1E3>this.LW.count&&this.Ivb.push(l):this.LW.firstAction=l;this.lzf&&this.mzf&&this.mzf.forEach(u=>
{l>u&&this.LW.countAboveThresholds[u]++});this.LW.count++}static i_e(l){const u=Object.assign({},h);0<l.length&&(c.i(l),u.median=l[Math.floor(.5*l.length)],u.P75=l[Math.floor(.75*l.length)],u.P95=l[Math.floor(.95*l.length)],u.max=l[l.length-1],u.average=c.g(l,v=>v)/l.length);return u}}Object(t.a)(d,"PerformanceMeasurement",null,[]);const h={average:0,max:0,median:0,P75:0,P95:0},r={count:0,countAboveThresholds:void 0,failedCount:0,firstAction:0,includingFirstAction:Object.assign({},h),excludingFirstAction:Object.assign({},
h)}},1130:function(t,C,a){a.d(C,"a",function(){return f});t=a(0);var c=a(25);C=a(1131);var b=a(14);class f extends C.a{constructor(e,d,h,r){super();Object.assign(this,d);this.$=e;this.kbe=h;r&&(this.PYa=r.vHd,this.xzg=r.valueType,this.GVc=r.sheetId);this.A0={flowId:this.flowId,py:this.py,originCell:this.originCell,anonymizedFormula:this.anonymizedFormula}}set flowId(e){this.kbe=e}get flowId(){return this.kbe}get formula(){var e;void 0===this.JXa&&(this.JXa=null===(e=this.generatedFormula)||void 0===
e?void 0:e.formula)&&"="!==this.JXa.charAt(0)&&(b.ULS.sendTraceTag(509620492,306,50,"FormulaByExampleSuggestion.formula: appending = sign as formula prefix."),this.JXa=`=${this.JXa}`);return this.JXa}set py(e){this.OMc=e}get Odd(){return this.rows}get RNe(){return this.xzg}get anonymizedFormula(){var e;void 0===this.ube&&(this.ube=null===(e=this.generatedFormula)||void 0===e?void 0:e.anonymizedFormula);return this.ube}get sheetId(){return this.GVc}get py(){void 0===this.OMc&&(this.OMc=this.Odd.length);
return this.OMc}set originCell(e){this.PYa=e}get originCell(){void 0===this.PYa&&(b.ULS.sendTraceTag(509620491,306,10,`FormulaByExampleSuggestion.originCell: origin cell is not defined - falling back to first cell of annotation range. flowId: ${this.flowId}`),this.PYa=c.Range.Lc(this.Odd[0],this.column));return this.PYa}get range(){return new c.Range(this.tA.top,this.PYa.left,this.tA.bottom,this.PYa.left,!0,!0)}ulf(e){return e.xd(this.range)&&this.Odd.includes(e.top)}}Object(t.a)(f,"FormulaByExampleSuggestionBase",
C.a,[])},1131:function(t,C,a){a.d(C,"a",function(){return b});t=a(0);C=a(746);var c=a(722);class b extends C.a{constructor(){super();this.rows=null;this.column=0;this.generatedFormula=this.formulas=null;this.resultKind=this.invocationMethod=this.stateID=0;this.errorMessage=this.guid=null;this.H_=Object.assign(new c.a,{T_:b.getTypeName(),B_:b.Td()})}static getTypeName(){return"AugLoop_FormulaByExample_FormulaByExampleAnnotation"}static Td(){return["AugLoop_Core_Annotation"]}}Object(t.a)(b,"FormulaByExampleAnnotation",
C.a,[])},1132:function(t,C,a){a.d(C,"a",function(){return b});var c=a(14);const b=(f,e,d)=>{const h=d.Hfc(f);if(!h)return null;const r=f.usedRange,l=e-r.left;return 0>l||l>=h.count?(c.ULS.sendTraceTag(537161876,306,10,`FormulaByExampleSuggestionCache.getUniqueTableColumnIdentifier: invalid inputs. tableRange: ${r}, columnNumber: ${e}, `+`areAllTableHeadersAvailable: ${d.NUg(f,h)}`),null):(e=h.ma(l))?f.name+"_"+e:null}},1184:function(t,C,a){function c(Ka){var zb=Object(M.h)(Ka),Yb=Object(P.a)(Ka);
const oc=zb.Ih;var Wc=zb.cellTextEditBox.Jnf;Wc=zb.am||Wc&&Yb;Yb=b((Wc?Yb:oc).textBox.domElement);N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaAssistanceIndentedRender",!1)&&(Yb.left+=12);if(Wc)zb={top:0,left:0,right:innerWidth,bottom:innerHeight};else if(zb=b(zb.domElement),{zoom:Ka}=Object(E.a)(Ka),1!==Ka)for(const vd of[Yb,zb])for(const Dd in vd)vd[Dd]*=Ka;return{target:Yb,bounds:zb}}function b(Ka){const {top:zb,left:Yb,right:oc,bottom:Wc}=Ka.getBoundingClientRect();return{top:zb,
left:Yb,right:oc,bottom:Wc}}function f(Ka){var zb;if(Ka){var Yb=new gf(0===Ka.kind);Ka=null===(zb=null===Ka||void 0===Ka?void 0:Ka.rangeInfo)||void 0===zb?void 0:zb.positionKindInfo;if(!Ka)return Yb;Yb.KF=0===Ka.firstRow;Yb.JF=0===Ka.firstColumn;Yb.JK=0===Ka.secondRow;Yb.IK=0===Ka.secondColumn;return Yb}}var e={};a.r(e);a.d(e,"FormulaAssistanceReadoutHandler",function(){return wa});var d=a(10),h=a(0),r=a(718),l=a(53),u=a(39),v=a(14),x=a(19),w=a(391),m=a(80);class n{}n.Sdd="!";n.COf="[";n.BOf="]";
n.openParen="(";n.closeParen=")";n.wrg=" /.(*\\".split("");n.Z$b="...";n.jJb="param_help_link";n.WHd="param_help_udf";n.Ggd="function_list_box";n.UPh="function_param_box";n.Igd="function_reader_description";n.Bgd="function_description_box";n.P1e="function_param_table";n.g9i="param_row_";n.ytc="param_set";n.lPf="param_row_0";n.mPf="param_row_1";n.VPh="<div id='{0}' class='{1}'></div>";n.TPh="<div id='{0}' class='{1} {2} {3}'>\r\n\t<table id='{4}'>\r\n\t\t{5}\r\n\t\t{6}\r\n\t</table>\r\n</div> ";n.nPf=
"<tr>\r\n\t<td id='{0}'>\r\n\t\t<span id='{0}_{1}' class='{2}'></span>\r\n\t\t<a href = '#' id='{0}_{3}' class='{4}'></a>\r\n\t\t<span id ='{0}_{5}'></span>\r\n\t</td>\r\n</tr>";n.RPh="<div id='{0}' class='{1} {2} {3}'></div>";n.NPh="<div id='{0}' class='{1} {2} {3} {4}'></div>";n.Veh=1;n.Ueh=3;n.Toh=500;n.Fyf=50;Object(h.a)(n,"FormulaAssistanceConstants",null,[]);var z=a(15),y=a(295),A=a(9),F=a(7),D=a(98),B=a(12),M=a(21),R=a(365),P=a(119),E=a(36),H=a(41),G=a(157),N=a(1);const I=(Ka,zb,Yb)=>{if(Ka){const oc=
Ka.da.Aa(491);oc?oc.MJ("lm"):v.ULS.sendTraceTag(523551513,0,50,"FormulaAssistanceExtensions: logHelpLinkClick getService returned a null formulaAssistanceManager");Yb?U(Ka,zb,Yb):(Yb=new D.a(-859308420,m.a.Eb,Ka.Bc,0,null),Ka.Ia.Nb(Yb,{[m.a.Uc]:F.a.OV,[m.a.$f]:"HelpID="+zb}))}},O=(Ka,zb,Yb)=>{const oc={};oc[F.a.AH]=zb;zb={};zb.FunctionName=Yb;oc[F.a.Rbc]=zb;Ka.Xc(802602464,0,8,oc)},U=(Ka,zb,Yb)=>{if(Yb){if(zb&&(!zb||zb.startsWith("http://")||zb.startsWith("https://"))){if(N.EwaSettings.ya(147)){let oc;
if(N.EwaSettings.isChangeGateEnabled("OfficeVSO:7574381_RemoveResolveSyncV2"))oc=G.a.jo(H.W);else try{oc=G.a.EBa(H.W)}catch(Wc){}if(oc&&oc.oDa(zb))return}B.HelperMethods.vf(zb,"_blank",R.a)}}else B.HelperMethods.FW(Ka.AG,"XLWAEndUser_"+zb,Ka.WS)},ca=Ka=>{let zb=A.a.p0;const Yb=Ka.da.Aa(368);Yb&&!Object(M.h)(Ka).am&&(zb=Yb.zoom);return zb};var Q=a(274),Y=a(6),la=a(34),ea=a(564);class ha{constructor(Ka){this.$=Ka;this.zbe={};this.vdb={};this.gfe=void 0;this.HUg=z.a.instance.ha(1033);this.hMd=z.a.instance.ha(1034);
this.FHe=z.a.instance.ha(1032);this.OPh="InsertFunctionDialog";this.BWf="recentlyUsedFunctions";this.fNi=15;this.Vki=()=>{this.Ega=this.$.da.Aa(19);this.Ega.NKa({Filter:null,FilterType:2,IncludeOneOfEachGroupUI:!0},!0);this.hQe(this.Wki,this.oli,this.Eki)};this.oli=()=>{if(this.fnf){this.Def=this.q0h();this.vdb=JSON.parse(this.localStorage.nMa(this.BWf));this.vdb||(this.vdb={});const zb=this.vdb[this.Def];zb&&(Array.isArray(zb)&&zb.every(this.Vui)?this.fBa=zb:T("initRecentlyUsedFunctions: Recently used functions are not an array of numbers as expected"))}this.fBa||
(this.fBa=this.Ega.jMa(this.FHe).map(X))};this.Wki=()=>{this.w2b=this.Ega.hdc.filter(this.Hnf);this.w2b.forEach(zb=>{this.zbe[zb.FunctionIndex]=zb})};this.Eki=()=>{this.categories=this.functionInfoManager.xxb.filter(zb=>zb!==this.FHe);this.categories.unshift(this.hMd)};this.gfj=zb=>{this.fBa?(this.fBa=this.fBa.filter(Yb=>Yb!==zb).slice(0,this.fNi-1),this.fBa.unshift(zb),this.fnf&&(this.vdb[this.Def]=this.fBa,this.localStorage.vOb(this.BWf,JSON.stringify(this.vdb)))):T("pushFunctionToRecentlyUsed: Recently used functions array was not initialized.")};
this.Hnf=zb=>!this.Ega.kkc(zb);this.hQe=(...zb)=>{if(this.Ega.aW)zb.forEach(Yb=>Yb());else{const Yb=()=>{this.Ega.Qdb(Yb);zb.forEach(oc=>{oc()})};this.Ega.EHa(Yb)}};this.q0h=()=>{const zb=Y.AFrameworkApplication.fa.Wa("LoggableUserId");return zb?la.a.Au(zb).toString():"0"};this.Vui=zb=>"number"===typeof zb&&Object(ea.b)(this.functionInfoManager.tjd(zb));this.localStorage=new Q.a;this.fnf=this.localStorage.Pe();this.Vki()}static instance(Ka){this.Ma||(this.Ma=new ha(Ka));return this.Ma}get functionInfoManager(){return this.Ega}get PPh(){return this.zbe}get xxb(){return this.categories}get RMh(){var Ka;
return null!==(Ka=this.gfe)&&void 0!==Ka?Ka:this.hMd}jMa(Ka){this.gfe=Ka;return Ka===this.hMd?this.fBa:this.Ega.jMa(Ka).filter(this.Hnf).map(X)}sLh(Ka=""){Ka=Ka.toLocaleLowerCase();const zb=this.w2b.filter(({NameUI:Yb})=>Yb.toLocaleLowerCase().startsWith(Ka));3<=Ka.length&&(zb.push(...this.w2b.filter(Yb=>Yb.NameUI.toLocaleLowerCase().includes(Ka)&&!zb.includes(Yb))),zb.push(...this.w2b.filter(Yb=>Yb.Help.toLocaleLowerCase().includes(Ka)&&!zb.includes(Yb))));return zb.map(X)}}Object(h.a)(ha,"FunctionDialogUtils",
null,[]);const X=Ka=>Ka.FunctionIndex,T=Ka=>{v.ULS.sendTraceTag(509670041,0,10,`FunctionDialogUtils.${Ka}`)};var ua=a(275),Ha=a(23),Ca=a(33),Ga=a(186);class sa{constructor(){this.f3a=[];this.Qtd=N.EwaSettings.isChangeGateEnabled("OfficeVSO:7705772_newFuncDialogTelemetry");this.recordAction=(Ka,zb)=>{if(this.Qtd)if(Object(ea.c)(this.data))this.gza(`RecordAction: Trying to record an action when the data object is undefined. stream: ${this.f3a.join(";")}`);else if(this.f3a.push(`${Ka}_${zb}`),this.data[Ka]||
(v.ULS.sendTraceTag(509117001,0,15,`FunctionDialogTelemetryManager.RecordAction: Trying to record an action when data[source] doesn't exist.
       data: ${JSON.stringify(this.data)},
       source: ${Ka},
       stream: ${this.f3a.join(", ")}`),this.data[Ka]={}),this.data[Ka][zb]=!0,"close"===zb||"insert"===zb||"feedback"===zb&&"arguments"!==Ka)this.data.endedBy=zb,this.flush()};this.$wi=Ca.a.Ptd();this.isValuePreviewEnabled=Ca.a.jya()}nhf(Ka,zb,Yb){this.Qtd&&!this.Opf&&(Ka=-2060563418===Ka?"ribbon":1===Yb?"shortcut":"Fx",zb=(Yb=zb.jb)?zb.Ih.text:zb.Ob(null).cell.LL,zb=Ha.a.Yg(zb)?"empty":Object(Ga.g)(zb)?"formula":"text",this.Kki(Ka,Yb,zb))}get Opf(){return 0<this.f3a.length}flush(){this.Qtd&&(this.Opf?
(v.ULS.sendTraceTag(509137437,0,50,`FunctionDialogTelemetryManager: Dialogs actions recorded: ${this.f3a.join(",")}`),v.ULS.sendTraceTag(509137436,0,50,`FunctionDialogTelemetryManager: Dialog data:${JSON.stringify(this.data)}`),this.f3a=[],this.data=void 0):this.gza(`flush: Trying to flush when no dialog actions were recorded. data: ${JSON.stringify(this.data)}`))}Kki(Ka,zb,Yb){this.data={origin:Ka,openedWhileEditing:zb,initialCellContent:Yb,isNewDialog:this.$wi,isValuePreviewEnabled:this.isValuePreviewEnabled,
endedBy:void 0,functions:{},signatures:{},arguments:{}}}gza(Ka){v.ULS.sendTraceTag(509137435,0,10,`FunctionDialogTelemetryManager.${Ka}`)}}sa.instance=()=>sa.Ma||(sa.Ma=new sa);Object(h.a)(sa,"FunctionDialogTelemetryManager",null,[]);var bb;(function(Ka){Ka.functionInfo="functionInfo";Ka.giveFeedbackCallback="giveFeedbackCallback";Ka.listSeparator="listSeparator"})(bb||(bb={}));Object(h.b)("SignatureDialogPropKeys",bb);class Ba extends y.a{static show(Ka,zb){Ka=ha.instance(zb).functionInfoManager.tjd(Ka);
new Ba(Ka,zb)}constructor(Ka,zb){super(zb);this.functionInfo=Ka;this.ztg=(oc,Wc)=>{1===oc?(this.recordAction("next"),this.hide(),oc=new D.a(1117706454,0,this.$.Bc,8,null),this.$.Ia.Nb(oc,{[Fb.gdc]:Wc.selectedFunctionInfo,["argumentsDialogSource"]:2})):2===oc?(this.hide(),this.recordAction("back"),Wc=new D.a(753860909,0,this.$.Bc,8,null),this.$.Ia.Nb(Wc,{tOf:!0})):0===oc&&this.recordAction("close")};this.hFd=oc=>{this.hide();O(this.$,"functionSignatureDialog",oc);this.recordAction("feedback")};this.el=
z.a.instance.ha(1035);const Yb=sa.instance();this.recordAction=oc=>Yb.recordAction("signatures",oc);this.dqd()}dqd(){this.initializeAndShow(this.el,this.ztg,{[Ba.Gt]:this.uc,[bb.functionInfo]:this.functionInfo,[bb.giveFeedbackCallback]:this.hFd.bind(this),[bb.listSeparator]:this.$.listSeparator});this.recordAction("shown")}get uc(){return"FunctionSignatureDialog"}}Object(h.a)(Ba,"FunctionSignatureDialog",y.a,[]);var qa=a(645);class pa{constructor(Ka){this.S5=!1;this.o_g=()=>{this.S5?this.gza("blockGrid: Called blockGrid when grid is already blocked."):
(this.pca.addEventListener("mousedown",this.ix,!0),this.pca.addEventListener("touchend",this.$z,!0),this.pca.addEventListener("contextmenu",this.ix,!0),this.pca.addEventListener("focus",this.E1d),this.S5=!0)};this.E1d=()=>{this.S5&&(this.pca.removeEventListener("mousedown",this.ix,!0),this.pca.removeEventListener("touchend",this.$z,!0),this.pca.removeEventListener("contextmenu",this.ix,!0),this.pca.removeEventListener("focus",this.E1d),this.S5=!1)};this.ix=zb=>{this.DQa(zb,zb.button===Sys.UI.MouseButton.leftButton)};
this.$z=zb=>{this.DQa(zb,!0)};this.DQa=(zb,Yb)=>{if(this.rangePickerController.Exi&&Yb)return!1;zb.stopPropagation();zb.preventDefault();return!0};this.gza=zb=>{v.ULS.sendTraceTag(509211348,0,10,`GridInteractionBlocker.${zb}`)};this.pca=M.h(Ka).domElement;this.rangePickerController=qa.a.r6a(Ka)}static d0h(Ka){this._singleton||(this._singleton=new pa(Ka));return this._singleton}}Object(h.a)(pa,"GridInteractionBlocker",null,[]);var ya;(function(Ka){Ka[Ka.FunctionsDialog=0]="FunctionsDialog";Ka[Ka.RibbonButton=
1]="RibbonButton";Ka[Ka.SignatureDialog=2]="SignatureDialog"})(ya||(ya={}));Object(h.b)("ArgumentsDialogSource",ya);class za extends y.a{static show(Ka,zb,Yb,oc,Wc){new za(Ka,zb,Yb,oc,Wc)}constructor(Ka,zb,Yb,oc,Wc){super(Ka);this.functionInfo=zb;this.formulaAuthoringHelper=Yb;this.Ldg=oc;this.uXg=Wc;this.ctd=N.EwaSettings.isChangeGateEnabled("OfficeVSO:7640464_blockGridDuringArgumentsDialog");this.KPh=(Dd,be)=>{var se;this.hide();switch(Dd){case 1:Dd=this.functionInfo.NameUI;for(be=null!==(se=be.functionArgs)&&
void 0!==se?se:[];1<be.length&&Ha.a.Yg(be[be.length-1]);)be.pop();se={[m.a.Uc]:Dd,["functionArgs"]:be,["ibdk"]:!0};be=new D.a(-433697611,0,this.$.Bc,8,null);this.recordAction("insert");this.$.Ia.Nb(be,se);break;case 2:this.recordAction("back");switch(this.uXg){case ya.FunctionsDialog:se=new D.a(753860909,0,this.$.Bc,8,null);this.$.Ia.Nb(se,{tOf:!0});break;case ya.SignatureDialog:Ba.show(this.functionInfo.FunctionIndex,this.$)}break;case 0:this.recordAction("close")}};this.FW=()=>{U(this.$,this.functionInfo.HelpId,
!1);this.recordAction("help")};this.Y_h=()=>this.formulaAuthoringHelper.hasRepeatingParams(this.functionInfo)?Dd=>this.formulaAuthoringHelper.getFunctionParamByIndex(this.Ldg,this.functionInfo,Dd):void 0;this.feedbackCallback=Dd=>{O(this.$,"functionArgumentsDialog",Dd);this.recordAction("feedback")};this.el=z.a.instance.ha(1035);this.rangePickerController=Object(M.h)(this.$).Wg.r6a();this.ctd&&(this.Pbf=pa.d0h(Ka));const vd=sa.instance();this.recordAction=Dd=>vd.recordAction("arguments",Dd);this.Cg()}get uc(){return"FunctionArgumentsDialog"}Cg(){this.Xb=
1;this.Pq={[ua.a.Gt]:this.uc,["functionInfo"]:this.functionInfo,["initialArgs"]:this.formulaAuthoringHelper.getMinimalParamArray(this.Ldg,this.functionInfo),["generateArgByIndex"]:this.Y_h(),["helpCallback"]:this.FW,["giveFeedbackCallback"]:this.feedbackCallback,["isModal"]:!1,["rangePickerController"]:this.rangePickerController};this.ctd&&this.Pbf.o_g();this.initializeAndShow(this.el,this.KPh,this.Pq);this.recordAction("shown")}hide(){this.ctd&&this.Pbf.E1d();this.rangePickerController.disposeRangePicker(void 0);
super.hide()}}Object(h.a)(za,"FunctionArgumentsDialog",y.a,[]);var cb;(function(Ka){Ka.CategoryList="categoryList";Ka.FunctionsMap="functionsMap";Ka.FunctionIdsToDisplay="functionIdsToDisplay";Ka.RefreshListCallback="refreshListCallback";Ka.HelpCallback="helpCallback";Ka.feedbackCallback="giveFeedbackCallback";Ka.InitialCategory="initialCategory";Ka.AllCategoryName="allFunctionsCategoryName"})(cb||(cb={}));Object(h.b)("PropsKeys",cb);class Pa extends y.a{static show(Ka){new Pa(Ka)}constructor(Ka){super(Ka);
this.I1e=(Yb,oc)=>{if(1===Yb){this.hide();var Wc=oc.functionName;Yb=this.functionInfoManager.k6e(Wc);oc=0<Yb.Params.length;Wc={[Fb.gdc]:Yb,["ibdk"]:!0,["argumentsDialogSource"]:0,[m.a.Uc]:Wc};const vd=new D.a(oc?1117706454:-433697611,0,this.$.Bc,8,null);this.recordAction(oc?"next":"insert");this.$.Ia.Nb(vd,Wc);this.utils.gfj(Yb.FunctionIndex)}else 0===Yb&&this.recordAction("close")};this.dqd=()=>{const Yb=this.utils.RMh;this.Pq={[Pa.Gt]:this.uc,[cb.CategoryList]:this.utils.xxb,[cb.FunctionsMap]:this.utils.PPh,
[cb.FunctionIdsToDisplay]:this.utils.jMa(Yb),[cb.RefreshListCallback]:this.T_i.bind(this),[cb.feedbackCallback]:this.hFd.bind(this),[cb.HelpCallback]:this.zhi,[cb.InitialCategory]:Yb,[cb.AllCategoryName]:this.utils.HUg};this.initializeAndShow(this.el,this.I1e,this.Pq);this.recordAction("shown")};this.zhi=Yb=>{U(this.$,Yb,!1);this.recordAction("help")};this.hFd=Yb=>{this.hide();O(this.$,this.utils.OPh,Yb);this.recordAction("feedback")};this.el=z.a.instance.ha(1035);this.utils=ha.instance(Ka);const zb=
sa.instance();this.recordAction=Yb=>zb.recordAction("functions",Yb);this.Cg()}get uc(){return"FunctionDialog"}get functionInfoManager(){return this.utils.functionInfoManager}Cg(){this.Xb=1;this.utils.hQe(this.dqd)}l6j(Ka){this.Pq[cb.FunctionIdsToDisplay]=Ka;this.DVa(this.el,this.u6a(this.I1e),this.Pq)}T_i(Ka,zb){Ka=zb?this.utils.sLh(zb):this.utils.jMa(Ka);this.l6j(Ka)}}Object(h.a)(Pa,"FunctionDialog",y.a,[]);var nb=a(60),Ma=a(75),Oa=a(92),La=a(29),ra=a(219),V=a(76),ma=a(115),W=a(231),aa=a(54),ia=
a(753),ka=a(13),Xa=a(77);const sb=V.a.Xzh,ib=V.a.gAh,Ub=V.a.hAh,hc=V.a.CUe,yb=V.a.Zzh,Gb=V.a.aAh,Sa=V.a.xUe,db=V.a.FUe,fb=V.a.$zh,ab=V.a.AUe;class wb extends ra.a{constructor(Ka,zb){super(Ka,z.a.instance.ha(1035),void 0,void 0,void 0,N.EwaSettings.ya(350));this.zxb=this.puf=this.R1e=this.O1e=this.Fka=this.N1e=this.Bxb=this.HLa=this.Gka=this.ILa=null;this.eod=!1;this.pAb=this.IGb=this.k5b=null;this.onFunctionInfoLoaded=()=>{if(!this.HLa.count){const Yb=this.functionInfoManager.xxb;for(let oc=0,Wc=
Yb.length;oc<Wc;++oc)this.HLa.YT(Yb[oc],Yb[oc],!1).className=V.a.Yzh;this.HLa.selectedIndex=0;Oa.a.wc([this.k5b,this.IGb,this.pAb]);this.k5b=this.De.ke(this.ILa);this.IGb=this.De.ke(this.Gka);this.pAb=this.De.ke(this.zxb);this.k5b.la("change",this.IGf);this.IGb.la("change",this.wYi);this.IGb.la("dblclick",this.xYi);this.pAb.la("click",this.Tda);this.pAb.la("keyup",this.z_i);ka.DOMElementExtensions.setVisible(this.Gka,!0);ka.DOMElementExtensions.setVisible(this.N1e,!1);this.$.W9c&&ka.DOMElementExtensions.setVisible(this.puf,
!0)}this.IGf(null);this.getButton(0).get_element().disabled=!1;this.ILa.disabled=!1;this.zTa();this.eod=!0};this.Tda=()=>{this.mba&&I(this.$,this.mba.HelpId,this.mba.IsDynamicUdf)};this.z_i=Yb=>{13!==Yb.keyCode&&32!==Yb.keyCode||this.Tda(Yb)};this.IGf=()=>{const Yb=this.functionInfoManager.jMa(this.HLa.qe.value);this.u5a(Yb);this.Gka.scrollTop=0;this.a8f()};this.wYi=()=>{this.a8f()};this.xYi=Yb=>{this.mba&&(Xa.g(Yb),this.close(0))};this.dd=(Yb,oc)=>{W.b(oc)&&this.zv()};this.functionInfoManager=Ka.da.Aa(19);
this.formulaAssistanceControl=Ka.da.Aa(221);if(this.qxb=Ca.a.ZV(this.$))this.formulaAssistanceManager=Ka.da.Aa(464);this.FQ=zb;this.telemetry=sa.instance()}get uc(){return"FunctionDeprecatedDialog"}get mba(){if(!this.Gka||!this.Gka.firstChild)return null;const Ka=Number.parseInvariant(this.Gka.children[this.Gka.selectedIndex].value);return this.functionInfoManager.tjd(Ka)}initialize(){this.dc.classList.add(V.a.Wzh);if(N.EwaSettings.isChangeGateEnabled("OfficeVSO:7262176_FunctionDeprecatedDialogReduceInnerHtml")){var Ka=
document.createElement("div");Ka.classList.add(V.a.wUe);var zb=document.createElement("label");zb.setAttribute("for",wb.Agd);zb.innerText=z.a.instance.ha(1038)+" ";Ka.appendChild(zb);zb=document.createElement("select");zb.id=wb.Agd;zb.classList.add(sb);zb.setAttribute("disabled","true");Ka.appendChild(zb);this.dc.appendChild(Ka);Ka=document.createElement("div");Ka.classList.add(ma.a.Vp);Ka.innerText=z.a.instance.ha(1039);this.dc.appendChild(Ka);Ka=document.createElement("div");Ka.classList.add(V.a.vUe);
zb=document.createElement("select");zb.id=wb.M1e;zb.classList.add(ib,La.a.Ww?Ub:null,x.a.Ho,x.a.ms);zb.size=7;Ka.appendChild(zb);zb=document.createElement("div");zb.classList.add(Gb);zb.innerText=z.a.instance.ha(736);Ka.appendChild(zb);this.dc.appendChild(Ka);Ka=document.createElement("div");Ka.classList.add(V.a.yUe);zb=document.createElement("div");zb.classList.add(ab);zb.style.direction="ltr";var Yb=document.createElement("span");Yb.classList.add(fb,x.a.Ho);const oc=document.createElement("span");
oc.classList.add(x.a.sz,V.a.zUe);const Wc=document.createElement("img");Wc.title=z.a.instance.qb(3);Wc.classList.add(x.a.mXe);Wc.src=aa.a.mf(13);oc.appendChild(Wc);Yb.appendChild(oc);zb.appendChild(Yb);Yb=document.createElement("span");Yb.id=wb.Dgd;Yb.classList.add(db);zb.appendChild(Yb);Yb=document.createElement("a");Yb.tabIndex=0;Yb.title=z.a.instance.ha(1040);Yb.classList.add(yb);zb.appendChild(Yb);Yb=document.createElement("span");Yb.id=wb.fdc;zb.appendChild(Yb);Ka.appendChild(zb);zb=document.createElement("div");
zb.classList.add(Sa);zb.id=wb.Cgd;Ka.appendChild(zb);this.dc.appendChild(Ka)}else this.dc.innerHTML=wb.t8c();this.Uf||(this.Rt(),this.uta());super.initialize();Ka=ka.DOMElementExtensions.sk(this.dc,ab);this.rtl&&(Ka.align="right",this.zxb.style.marginLeft="5px");this.Uf&&(Ka.style.padding="1px");this.functionInfoManager.NKa({Filter:null,FilterType:2,IncludeOneOfEachGroupUI:!0},!0);this.telemetry.recordAction("functions","shown")}dispose(){this.functionInfoManager&&(this.functionInfoManager.Qdb(this.onFunctionInfoLoaded),
this.functionInfoManager.$.ea.xk(this.dd));Oa.a.wc([this.k5b,this.IGb,this.pAb,this.HLa,this.Bxb]);super.dispose()}Rt(){this.ILa=ka.DOMElementExtensions.sk(this.dc,sb);this.Gka=ka.DOMElementExtensions.sk(this.dc,ib);this.ILa.setAttribute(F.a.Kd,F.a.b3b);this.HLa=new ia.a(this.ILa,!0);this.Bxb=new ia.a(this.Gka,!0);this.N1e=ka.DOMElementExtensions.sk(this.dc,Gb);this.zxb=ka.DOMElementExtensions.sk(this.dc,yb);this.R1e=ka.DOMElementExtensions.sk(this.dc,db);this.puf=ka.DOMElementExtensions.sk(this.dc,
fb);this.O1e=$get(wb.fdc,this.dc);this.Fka=ka.DOMElementExtensions.sk(this.dc,Sa);this.Uf&&(this.Fka.style.paddingLeft="1px");this.functionInfoManager.EHa(this.onFunctionInfoLoaded);this.functionInfoManager.$.ea.Zj(this.dd)}kN(Ka){this.$.da.kb(40,()=>{this.HLa.kN(Ka)})}vq(){this.qxb?this.formulaAssistanceManager.X9b():this.formulaAssistanceControl.set_visible(!1);super.vq();this.eod||(this.getButton(0).get_element().disabled=!0)}setFocus(){!this.ILa.disabled&&this.eod&&ka.DOMElementExtensions.setFocus(this.ILa)}commit(){return!0}mtb(){let Ka=
this.mba.NameDataStrings;const zb=new D.a(-433697611,0,this.$.Bc,8,null);this.$.Ia.Nb(zb,{[m.a.Uc]:Ka,["ibdk"]:!0});this.telemetry.recordAction("functions","insert")}hua(){this.qxb?this.formulaAssistanceManager.Qea():this.formulaAssistanceControl.drb();this.telemetry.recordAction("functions","close")}u5a(Ka){this.Bxb.clear();const zb=wb.fdc+" "+wb.Cgd;for(let Yb=0,oc=Ka.length;Yb<oc;++Yb){const Wc=this.Bxb.YT(Ka[Yb].NameUI,Ka[Yb].FunctionIndex.toString(),!1);La.a.Ww&&Wc.classList.add(hc);Wc.setAttribute(F.a.vM,
wb.Dgd);Wc.setAttribute(F.a.kH,zb)}this.Bxb.selectedIndex=0}a8f(){if(this.mba){this.zxb.parentNode.className=V.a.AUe+(this.functionInfoManager.kkc(this.mba)?"-udf":"");var Ka=this.mba.NameDataStrings;this.R1e.innerText=Ka;this.zxb.innerText=Ka;this.Fka.innerText=this.mba.Help;Ka=this.mba.Params.split(n.Sdd);this.O1e.innerText=n.openParen+(1<Ka.length?n.Z$b:Ka[0])+n.closeParen}}static t8c(){return String.format("<div class='"+V.a.wUe+"'>\r\n\t<label for='{6}'>{0}</label>\r\n\t<select id='{6}' class='{9}' disabled='true'></select>\r\n</div>\r\n<div class='"+
ma.a.Vp+"'>{1}</div>\r\n<div class='"+V.a.vUe+"'>\r\n\t<select id='{16}' class='{17} "+x.a.Ho+" "+x.a.ms+"' size='{8}'></select>\r\n\t<div class='{11}' >{2}</div>\r\n</div>\r\n<div class='"+V.a.yUe+"'>\r\n\t<div style='direction:ltr' class='{15}'>\r\n\t\t<span class='{14} "+x.a.Ho+"'>\r\n\t\t\t<span class='"+x.a.sz+" "+V.a.zUe+"'>\r\n\t\t\t\t<img title='{3}' class='"+x.a.mXe+"' src='{4}'/>\r\n\t\t\t</span>\r\n\t\t</span>\r\n\t\t<span id='{19}' class='{13}'></span>\r\n\t\t<a tabindex='0' title='{5}' class='{10}'></a>\r\n\t\t<span id='{7}'></span>\r\n\t</div>\r\n\t<div id='{18}' class='{12}'></div>\r\n</div>",
z.a.instance.ha(1038),z.a.instance.ha(1039),z.a.instance.ha(736),z.a.instance.qb(3),aa.a.mf(13),z.a.instance.ha(1040),wb.Agd,wb.fdc,7,sb,yb,Gb,Sa,db,fb,ab,wb.M1e,ib+(La.a.Ww?" "+Ub:""),wb.Cgd,wb.Dgd)}}wb.fdc="function_dialog_param_string";wb.Cgd="function_dialog_function_description";wb.Dgd="function_dialog_function_name";wb.M1e="function_list";wb.Agd="function_category";Object(h.a)(wb,"FunctionDeprecatedDialog",ra.a,[]);var kb=a(2),tb=a(276),hb=a(45);class Fb{constructor(Ka,zb,Yb){this.$=Ka;this.Xa=
zb;this.functionInfoManager=Yb;this.QPh="FinancialFns LogicalFns TextFns DateTimeFns LookupReferenceFns MathTrigFns StatisticalFns EngineeringFns CubeFns InformationFns".split(" ");this.menuId=null;this.onFunctionInfoLoaded=()=>{this.menuId&&this.QPh.includes(this.menuId)&&this.frame.Dx(this.menuId)};this.ZV=Ca.a.ZV(this.$);this.WCb=Ca.a.Ptd();this.D8a=N.EwaSettings.isChangeGateEnabled("OfficeVSO:7561900_InsertFunctionPositionBugFix");this.ZV&&(this.formulaAssistanceManager=this.$.da.Aa(464));this.bZ=
{};this.frame=this.$.frame;this.functionInfoManager.EHa(this.onFunctionInfoLoaded);this.formulaAssistanceTelemetryManager=Ka.da.Aa(491);this.J1e=sa.instance()}Oc(Ka,zb){switch(zb){case 753860909:case -2060563418:case 1117706454:case 917756490:case -1756230110:case -1702465186:case -977299160:case 2135922458:case -1960662393:case -1999560076:case 493672674:case -1031255406:case 548833656:case 641360851:case -433697611:return Ka=M.h(this.$).Ih,Ka.z7a||!Ka.jb||0>=Ka.text.length?!1:!0;default:return!1}}executeCommand(Ka,
zb,Yb){var oc,Wc;const vd=zb.command;Ka=M.h(this.$);const Dd=Ka.Ih;switch(vd){case 753860909:case -2060563418:this.D8a&&!Yb.tOf&&this.OBe();this.J1e.nhf(vd,Ka,zb.method);null===(oc=this.formulaAssistanceManager)||void 0===oc?void 0:oc.X9b();Ka.inRangePicker&&Dd.XE(!1);this.WCb?Pa.show(this.$):(new wb(this.$,Dd)).qg();this.formulaAssistanceTelemetryManager.n5a.dialogShownCounter++;break;case 1117706454:this.J1e.nhf(vd,Ka,zb.method);null===(Wc=this.formulaAssistanceManager)||void 0===Wc?void 0:Wc.X9b();
Ka.inRangePicker&&Dd.XE(!1);void 0===Yb.argumentsDialogSource&&(Yb.argumentsDialogSource=1,Yb[Fb.gdc]=this.functionInfoManager.k6e(Yb[m.a.Uc]));this.D8a&&1===Yb.argumentsDialogSource&&this.OBe();const be=Yb[Fb.gdc];if(be.Params.includes("!")){Ba.show(be.FunctionIndex,this.$);break}const se=Ha.a.AYf(be.Params).split(this.$.listSeparator).filter(Ia=>"..."!==Ia);u.TaskExtensions.k4(l.GetServiceTaskFactory.Sa(this.$.da,520,521,0),Ia=>{za.show(this.$,be,Ia.result,se,Yb.argumentsDialogSource)},this.$.ka,
3);Yb.ibdk?this.formulaAssistanceTelemetryManager.n5a.argsDialogOpenedByDialogCounter++:this.formulaAssistanceTelemetryManager.n5a.argsDialogOpenedByRibbonCounter++;break;case -433697611:zb=Yb.functionArgs;Yb.ibdk&&(void 0!==zb?this.formulaAssistanceTelemetryManager.n5a.argsDialogCommitedCounter++:this.formulaAssistanceTelemetryManager.n5a.dialogCommitedCounter++);let Oe=Yb[m.a.Uc]+n.openParen;this.WCb&&(void 0!==zb&&(Oe+=zb.join(this.$.listSeparator)),Oe+=n.closeParen);Yb.UILocation&&this.$.Xc(-1075437823,
-1,0,null);Ka.view.visibleArea.contains(Ka.Mg(null))||Ka.Nv(Ka.ga.qa.activeCell,3,"FormulaAssistanceCommandHandler.ExecuteCommand");const Me=Dd.textBox;zb=this.D8a?Dd.textBox.selection:{index:Dd.textBox.caretPosition,length:Me.xS?Me.xS.length:0};Dd.jb?(oc=Dd.text,Wc=0<zb.index?oc.substring(0,zb.index):"=",Dd.text=Wc+Oe+oc.substring(zb.index+zb.length,oc.length),Me.caretPosition=Wc.length+Oe.length):this.WCb?(zb=Ka.ga.qa.activeCell,this.D8a&&(this.Tbi(),zb=this.BQb.activeCell),Ka.setCell(Object(kb.a)(new tb.a,
{Text:`=${Oe}`}),zb,0,127,null)):u.TaskExtensions.za(Ka.startEdit(!0,1),()=>{Dd.text="="+Oe;const Ia=Oe.length+1;Me.hfb(Ia);Me.caretPosition=Ia},this.$.ka,11,Ma.a.current);Ka.am&&(Ka=Ka.hc,Ka.text=Me.text,Ka.setCaretPosition(Me.caretPosition));this.ZV?this.formulaAssistanceManager.Qea():(Ka=Dd.D3.get(w.a.Axb),null===Ka||void 0===Ka?void 0:Ka.jZ(!1))}return nb.Task.Ua(!0)}Ac(Ka,zb){switch(zb.command){case 753860909:case -2060563418:case -433697611:return!0;case 1117706454:return this.WCb;default:return!1}}PQh(Ka,
zb){zb=this.Xa.Nq(zb);const Yb=this.Xa.Nc();var oc=this.functionInfoManager.jMa(Ka);if(!oc)return v.ULS.sendTraceTag(537162067,0,15,"FormulaAssistanceCommandHandler.GenerateFunctionMenu: functionList is null"),zb.VE();const Wc=this.WCb?1117706454:-433697611;for(let vd=0;vd<oc.length;++vd){const Dd=oc[vd].NameUI,be=this.Xa.rQ(280,"Formulas."+Ka+"MenuItem_"+oc[vd].FunctionIndex.toString(),Wc,null,1,"None",0,0,Dd,!1,0);be.label=Dd;const se=oc[vd].Params.split(n.Sdd);be.yS(Dd+" "+(n.openParen+(1<se.length?
n.Z$b:se[0])+n.closeParen)+"\n"+oc[vd].Help);Yb.buttons.push(be)}Ka=this.Xa.Nc();oc=this.Xa.rQ(280,"Formulas.MoreFunctionsMenuItem",-2060563418,x.a.DXe,3,"Image16by16",1037,0,"Formulas.MoreFunctionsMenuItem",!1,0);Ka.buttons.push(oc);zb.Cc.push(Yb);zb.Cc.push(Ka);return zb.VE()}Vc(Ka,zb,Yb){Ka=this.Q_h(zb);if(-1===Ka)return!1;this.menuId=Yb.MenuId;if(!this.functionInfoManager.aW)return this.functionInfoManager.NKa({Filter:null,FilterType:2,IncludeOneOfEachGroupUI:!0},!0),!1;Ka=this.functionInfoManager.xxb[Ka];
this.bZ[Ka]=this.bZ[Ka]||this.PQh(Ka,Yb.MenuId);Yb.MenuItems=this.bZ[Ka];return!0}Q_h(Ka){switch(Ka){case "PopulateFinancialFnsMenu":return 2;case "PopulateLogicalFnsMenu":return 9;case "PopulateTextFnsMenu":return 8;case "PopulateDateTimeFnsMenu":return 3;case "PopulateLookupReferenceFnsMenu":return 6;case "PopulateMathTrigFnsMenu":return 4;case "PopulateStatisticalFnsMenu":return 5;case "PopulateEngineeringFnsMenu":return 11;case "PopulateCubeFnsMenu":return 12;case "PopulateInformationFnsMenu":return 10;
default:return-1}}OBe(){const Ka=M.h(this.$);this.BQb={activeCell:Ka.ga.qa.activeCell.clone(),selectedRanges:hb.d(Ka.ga.qa.selectedRanges),Xq:Ka.ga.qa.Xq,sheetName:this.$.ua.na.sheetName}}Tbi(){M.h(this.$).o_(this.BQb.selectedRanges,this.BQb.Xq,this.BQb.sheetName,null,this.BQb.activeCell,null,null,60,"FormulaAssistanceCommandHandler.ExecuteCommand")}}Fb.gdc="functionInfo";Object(h.a)(Fb,"FormulaAssistanceCommandHandler",null,[233]);class va extends r.a{constructor(Ka){super(Ka)}Fd(){const Ka=l.GetServiceTaskFactory.create(this.$.da,
102,this.ka,this.Na),zb=l.GetServiceTaskFactory.create(this.$.da,153,this.ka,this.Na);u.TaskExtensions.za(u.TaskExtensions.Pd([Ka,zb],this.ka),()=>{this.qd([new Fb(this.$,Ka.result,zb.result)])},this.ka,3)}static la(Ka){r.a.Yd(92,new va(Ka))}}Object(h.a)(va,"FormulaAssistanceCommandHandlerFactory",r.a,[]);var jb=a(228),Ab=a(159),Qa=a(472),Z;let wa=Z=class{constructor(Ka,zb){this.JLa=this.gwa=this.zka=null;this.sKf=(Yb,oc)=>{this.Xij(oc.functionName,oc.Hgd)};this.uKf=(Yb,oc)=>{this.Uij(oc.Hgd,oc.nSd,
oc.h9i)};this.tKf=(Yb,oc)=>{Yb=[];for(var Wc of oc.nSd)(!this.Vxa||void 0!==Wc&&null!==Wc)&&(oc=Wc.trim())&&Yb.push(oc);if(!this.Vxa||Yb.length){Wc="";for(oc=0;oc<Yb.length;oc++){const vd=this.P2c(Yb[oc]),Dd=Z.bJd(oc,Yb.length);Wc+=vd+Dd;Dd&&(Wc+=this.ariaLiveNotifier.iza)}this.ariaLiveNotifier.readText(Wc)}};this.vKf=(Yb,oc)=>{this.ariaLiveNotifier.Zij(oc.nG,oc.description,oc.selectedIndex.toString(),oc.length.toString())};this.oKf=(Yb,oc)=>{this.ariaLiveNotifier.RVf(oc.description,oc.length)};this.CGf=
()=>{this.ariaLiveNotifier.kdb(z.a.instance.ha(884),F.a.Rta)};this.uGf=()=>{this.ariaLiveNotifier.readText(z.a.instance.ha(885))};this.xGf=()=>{this.ariaLiveNotifier.readText(z.a.instance.ha(886))};this.$=zb;this.ariaLiveNotifier=Ka;this.$.da.Ha(219,this);this.Vxa=Ca.a.R5(zb)}dispose(){this.Q1d();this.JLa=this.gwa=this.zka=null}o1c(Ka){Ka&&(this.zka=Ka,this.zka.vte(this.sKf),this.zka.mue(this.uKf),this.Vxa&&this.zka.lue(this.tKf))}p1c(Ka){Ka&&(this.gwa=Ka,this.Vxa&&(this.gwa.tte(this.CGf),this.gwa.pte(this.uGf)),
this.gwa.ste(this.xGf))}q1c(Ka){Ka&&(this.JLa=Ka,this.JLa.s_c(this.vKf),this.JLa.H1b(this.oKf))}Q1d(){var Ka,zb,Yb;this.zka&&(this.zka.d_f(this.sKf),this.zka.C_f(this.uKf),this.Vxa&&this.zka.B_f(this.tKf));this.JLa&&(this.JLa.DOd(this.vKf),this.JLa.Swc(this.oKf));this.Vxa&&(null===(Ka=this.gwa)||void 0===Ka?void 0:Ka.c_f(this.CGf),null===(zb=this.gwa)||void 0===zb?void 0:zb.ZZf(this.uGf));null===(Yb=this.gwa)||void 0===Yb?void 0:Yb.b_f(this.xGf)}Xij(Ka,zb){if(zb){let Yb="";this.Vxa||(Yb+=z.a.instance.qb(57)+
this.ariaLiveNotifier.iza);for(let oc=0;oc<zb.length;oc++)Yb+=Ka+this.ariaLiveNotifier.iza+this.P2c(zb[oc])+Z.bJd(oc,zb.length);this.Vxa&&(Yb+=z.a.instance.ha(883)+this.ariaLiveNotifier.iza);this.ariaLiveNotifier.readText(Yb)}}Uij(Ka,zb,Yb){if(Ka){let Wc="",vd=0;if(zb){for(let Dd=0;Dd<zb.length;Dd++){if(Yb>=Ka[Dd].split(this.$.listSeparator).length){vd++;continue}var oc=zb[Dd].trim();if(!oc)return;oc=this.P2c(oc);const be=Z.bJd(Dd-vd,zb.length-vd);Wc+=oc+be;be&&(Wc+=this.ariaLiveNotifier.iza)}this.ariaLiveNotifier.readText(Wc)}}}P2c(Ka){if(!Ka)return"";
var zb=Ka.split(this.$.listSeparator);Ka="";for(const Yb of zb){if(Z.Asd(Yb))Ka+=Yb;else{const oc=(zb=Z.rxi(Yb))?Yb.replace("[","").replace("]",""):Yb;Ka+=String.format(zb?z.a.instance.qb(59):z.a.instance.qb(58),oc)}Ka+=this.ariaLiveNotifier.iza}return Ka}static bJd(Ka,zb){return Ka>=zb||1===zb?(v.ULS.shipAssertTag(537161997,0,Ka<zb,"FormulaAssistanceControl.PositionInList: requested item index >= list length."),""):String.format(z.a.instance.qb(55),Ka+1,zb)+"\r\n"}static Asd(Ka){return Ha.a.contains(Ka,
n.Z$b,!0)}static rxi(Ka){return Ka.trimStart().startsWith(n.COf)||Ka.trimEnd().endsWith(n.BOf)}};wa=Z=Object(Ab.b)([Object(G.d)(H.z),Object(Ab.c)(0,Object(Qa.AriaLiveNotifierService)()),Object(Ab.c)(1,Object(H.u)())],wa);Object(h.a)(wa,"FormulaAssistanceReadoutHandler",null,[515,2]);class Ea extends jb.a{constructor(Ka){super();this.$=Ka;this.Mb()}create(){const Ka=this.$.da;u.TaskExtensions.za(l.GetServiceTaskFactory.Sa(Ka,211,212,this.Na),zb=>{zb=Ka.Aa(219)||new wa(zb.result,this.$);this.vb(zb)},
this.ka,3)}static la(Ka){Ka.da.Ha(220,new Ea(Ka))}}Object(h.a)(Ea,"FormulaAssistanceReadoutHandlerFactory",jb.a,[]);var fa=a(229),Ua=a(16),Aa=a(89),Ib=a(198),Pb=a(1126),Fa=a(67),da=a(804),K=a(35),xa=a(25),rb=a(73),Qb=a(294),pc=a(259),Lb=a(184),qb=a(120);class bc{constructor(Ka=!1){this.vT=0;this.vde=!1;this.MXa=this.Yee=null;this.yDg=Ka;this.textEdit=null}L8f(Ka){this.vT=0;this.vde=Ka.IsCompatibility;this.set_name(Ka.NameDataStrings);this.MXa=Ka.Help}FEj(Ka){this.vT=1;this.set_name(Ka.Name)}hEj(Ka){this.vT=
2;this.set_name(Ka.name);this.MXa=Ka.tooltip}OFj(Ka){this.vT=3;this.set_name(Ka.name);this.MXa=Ka.toolTip}dIj(Ka){this.vT=4;this.set_name(Ka.name)}fIj(Ka){this.vT=5;this.set_name(Ka.name);this.MXa=Ka.toolTip}eIj(Ka){this.vT=7;this.set_name(Ka.name)}HGj(){this.vT=6;this.set_name(z.a.instance.qb(192));this.MXa=z.a.instance.qb(193)}get itemType(){return this.vT}get Gsi(){return this.vde}get name(){return this.label}set_name(Ka){return this.Yee=Ka}get label(){return this.Yee}get Fka(){return this.MXa}get GDb(){return this.yDg}static qlh(){return Object(kb.a)(new bc(!0),
{})}}Object(h.a)(bc,"AutoCompleteItem",null,[628]);class sc{constructor(){this.sheetName=this.namedRange=this.tooltip=this.name=null;this.type=0}}Object(h.a)(sc,"DefinedNameInfo",null,[]);var Tb=a(176);class $a{constructor(Ka){this.VNe={};this.$=Ka}get UNe(){const Ka=[];if(!this.$.Hb||!this.$.Hb.items)return Ka;let zb=0;const Yb=Ca.a.ZV(this.$);for(const oc of this.$.Hb.items)if(oc&&(3===oc.type&&oc.usedRange||Yb&&2===oc.type)){const Wc=new sc;Wc.tooltip=oc.sheetName+Fa.a.exclamation+oc.usedRange.toString();
Wc.name=oc.name;Wc.namedRange=this.beh(oc.usedRange);Wc.sheetName=oc.sheetName;Wc.type=this.Udh(oc.type);Ka.push(Wc);this.VNe[oc.name.toUpperCase()]=Wc;++zb;if(!N.EwaSettings.isChangeGateEnabled("OfficeVSO:7395300_FixTableAutoCompleteMissingInfo")&&zb===n.Fyf){v.ULS.sendTraceTag(537162076,0,15,`Maximum number of defined names reached for formula assistance: ${n.Fyf}`);break}}return Ka}k2j(Ka){var zb=this.VNe[Ka.toUpperCase()];if(!zb)return{returnValue:!1,sheetName:"",range:null};Ka=zb.sheetName;zb=
this.Mdh(zb.namedRange);return{returnValue:!0,sheetName:Ka,range:zb}}beh(Ka){if(null!=Ka&&void 0!=Ka)return{top:Ka.top,left:Ka.left,bottom:Ka.bottom,right:Ka.right,maxRows:Ka.maxRows,maxColumns:Ka.maxColumns,sheetName:void 0}}Mdh(Ka){if(null!=Ka&&void 0!=Ka)return new Tb.a(Ka.top,Ka.left,Ka.bottom,Ka.right,Ka.maxRows,Ka.maxColumns)}Udh(Ka){switch(Ka){case 2:return 0;case 3:return 1;default:return-1}}}Object(h.a)($a,"DefinedNameInfoManager",null,[]);var Nb=a(140),Ra=a(232),ob=a(273),mb=a(245);class gb extends Sys.EventArgs{constructor(Ka,
zb){super();this.functionName=Ka;this.Hgd=zb}}Object(h.a)(gb,"FormulaAssistanceFunctionChangedEventArgs",Sys.EventArgs,[]);class lb extends Sys.EventArgs{constructor(Ka){super();this.nSd=Ka}}Object(h.a)(lb,"FormulaAssistanceSelectedParameterChangedEventArgs",Sys.EventArgs,[]);class Xb extends Sys.EventArgs{constructor(Ka,zb,Yb){super();this.Hgd=Ka;this.nSd=zb;this.h9i=Yb}}Object(h.a)(Xb,"FormulaAssitanceSelectedParameterChangedEventArgs",Sys.EventArgs,[]);var Xd=a(272);class Qd{constructor(Ka,zb,
Yb,oc,Wc=null){this.jjc=this.y3c=!1;this.$=Ka;this.formulaAssistanceUIControl=zb;this.q1e=Yb;this.lAj=oc;this.Gcf=Wc;this.jjc=N.EwaSettings.isChangeGateEnabled("OfficeVSO:6592066_FixAutoCompleteCardFocusBug")}get Qf(){return this.y3c}set Qf(Ka){this.y3c!==Ka&&(Ka?Xd.a(this.$).ti(this):Xd.a(this.$).gA(this),this.y3c=Ka)}get je(){return this.lAj}get rc(){return this.formulaAssistanceUIControl.getRootElement(this.q1e)}pg(Ka,zb){Ka=!1;zb||(M.h(this.$).Ih.textBox.DF=!0,Ka=this.formulaAssistanceUIControl.focus(this.q1e));
return Ka}Gh(Ka){const zb=this.rc;return!(void 0===zb||null===zb)&&ka.DOMElementExtensions.Mf(zb,Ka)}Bj(){this.Gcf&&this.Gcf();const Ka=M.h(this.$).Ih.textBox;this.selection=Ka.selection;Ka.removeSelection()}hk(){M.h(this.$).Ih.textBox.selection=this.selection}dispose(){Xd.a(this.$).gA(this)}}Object(h.a)(Qd,"FormulaAssistanceFocusManager",null,[36,2]);var te=a(40),Pc=a(380),Ne=a(199),Hb=a(65),pb=a(37),mc=a(258),Kc=a(293),Nc=a(933);class pd extends te.a{constructor(Ka,zb){super();this.fBg=[];this.Kgd=
{};this.Lgd={};this.rT=null;this.a$=[];this.KLa={};this.$Gf=(Yb,oc)=>{v.ULS.sendTraceTag(537161987,0,50,"FunctionInfoManager.OnGetFunctionListPartialSucceeded");this.KGf(Yb,!!oc&&1!==oc.FilterType,!0)};this.ZGf=()=>{v.ULS.sendTraceTag(537161986,0,50,"FunctionInfoManager.OnGetFunctionListPartialFailed -  reset varaible to ensure we will re-issue the webservice call");this.rT=null};this.HGf=Yb=>{v.ULS.sendTraceTag(537161985,0,50,"FunctionInfoManager.OnFullFunctionListLoaded - full list was loaded");
this.zMd(Yb.Hka,!0,!1)};this.YGf=Yb=>{v.ULS.sendTraceTag(537161984,0,50,"FunctionInfoManager.OnGetFunctionListFullSucceeded");this.KGf(Yb,!0,!1)};this.LPc=this.OPc=!1;this.pb=Ka;this.pluginScheduler=zb;this.$.da.Ha(19,this)}EHa(Ka){this.addHandler("FunctionInfoLoaded",Ka)}Qdb(Ka){this.removeHandler("FunctionInfoLoaded",Ka)}VQg(Ka){this.addHandler("FunctionInfoReset",Ka)}Ppj(Ka){this.removeHandler("FunctionInfoReset",Ka)}get aW(){return this.OPc}get Fui(){return this.LPc}get hdc(){var Ka=this.rT,zb=
Nc.a(this.$);if(!zb)return Ka;zb=zb.g_h();const Yb=zb.length;if(0>=Yb)return Ka;const oc=[];oc.push(...Ka);for(Ka=0;Ka<Yb;Ka++){const Wc=zb[Ka],vd={};vd.FunctionIndex=oc.length;vd.HelpId=vd.GroupUI=null;vd.Help=Wc.description;vd.IsCommonlyUsed=vd.IsCompatibility=!1;vd.NameDataStrings=Wc.name;vd.NameUI=Wc.name;vd.Params=null;vd.ParamsHelp=null;oc.push(vd)}return oc}get xxb(){return this.a$}get $(){return this.pb}dispose(){const Ka=this.$.da.Aa(268);Ka&&Ka.hOd(this.HGf);this.pb=null;super.dispose()}Z1f(){this.raiseEvent("FunctionInfoReset")}VPd(){this.Z1f();
this.OPc=!1;this.rT=null;this.LPc=!0}NKa(Ka,zb=!1){if(this.aW)this.yUf();else{v.ULS.sendTraceTag(537161991,0,50,`Retrieving the list of function names for culture '${this.$.xa.UICultureTag}' from the server.`);let oc=null;(oc=this.$.da.Aa(268))||v.ULS.sendTraceTag(537161990,0,50,"instantaneousSupportInformationManager == null");if((null===oc||void 0===oc?0:oc.Hka)&&0<oc.Hka.length)N.EwaSettings.ya(114)?oc.sOh(this.YGf):this.zMd(oc.Hka,!0,!1);else{var Yb=this.$.pa.va.ic();Ka&&(this.$.ea.jc||zb)&&!this.Fui&&
(zb?Pc.a(this.$.userOperationManager,(Wc,vd,Dd)=>Hb.o(this.$.pa.va,Ka,Kc.b(Wc,this.$Gf),Kc.a(vd,this.ZGf),Dd,Ka,Yb),Wc=>new Ne.a(130,0,Wc,16),null):Hb.o(this.$.pa.va,Ka,this.$Gf,this.ZGf,null,Ka,Yb));!this.aW&&this.$.ea.jc&&(oc?(v.ULS.sendTraceTag(537161989,0,50,`FunctionInfoManager.EnsureFunctionInfoAsync - Functions not loaded yet, wait for them. IsFullyLoaded=${this.aW}, IsSessionActive=${this.$.ea.jc}`),oc.ute(this.HGf)):(v.ULS.sendTraceTag(537161988,0,50,"FunctionInfoManager.EnsureFunctionInfoAsync - instantaneousSupportInformationManager is null"),
Hb.o(this.$.pa.va,{FilterType:0},this.YGf,null,null,null,Yb),this.LPc=!1))}}}tjd(Ka){return 0>Ka||Ka>=this.rT.length?null:this.rT[Ka]}ujd(Ka){return pb.a.Mc(this.Kgd,Ka.toUpperCase())}k6e(Ka){return pb.a.Mc(this.Lgd,Ka.toUpperCase())}jMa(Ka){return pb.a.Mc(this.KLa,Ka)}kkc(Ka){return!Ka.GroupUI}KGf(Ka,zb,Yb){const oc=mc.a(Ka);v.ULS.sendTraceTag(537161955,0,50,`FunctionInfoManager.OnFunctionListSuceeded: areNonStatusMessagesPresentInResult=${oc}`);oc?(M.h(this.$).endEdit(!1,"FunctionInfoManager.OnFunctionListSuceeded"),
this.$.ea.qo(Ka.Errors)):(this.zMd(Ka.Result,zb,Yb),Ca.a.$V(this.$)&&!Ca.a.ZV(this.$)&&this.q8j())}zMd(Ka,zb,Yb){v.ULS.sendTraceTag(537161954,0,50,`FunctionInfoManager.RefreshFunctionList: functionsInfo count = ${Ka.length}, isCategorized = ${zb}, partialResult = ${Yb} IsFullyLoaded = ${this.aW}`);this.aW||(this.rT=Ka,this.Z0g(zb),this.OPc=!Yb,this.yUf())}yUf(){this.raiseEvent("FunctionInfoLoaded")}q8j(){const Ka=this.hdc;this.pluginScheduler.notifier().setFunctionsInfo(Ka);v.ULS.sendTraceTag(512278604,
0,50,`FuntionInfoManager.updateSchedulerFunctionArgumentAssistanceList update functions info with ${null===Ka||void 0===Ka?void 0:Ka.length} functions}`)}Z0g(Ka){var zb=z.a.instance.ha(1032),Yb=[];this.KLa={};this.a$=[];this.KLa[zb]=Yb;const oc=z.a.instance.ha(1033),Wc=[];this.a$.push(zb);this.a$.push(oc);for(let Dd=0,be=this.rT.length;Dd<be;Dd++){zb=this.rT[Dd];zb.IsCompatibility||Wc.push(zb);var vd=zb.NameUI;const se=zb.NameDataStrings;this.Kgd[se.toUpperCase()]||(this.Kgd[se.toUpperCase()]=zb);
this.Lgd[vd.toUpperCase()]||(this.Lgd[vd.toUpperCase()]=zb);if(!this.kkc(zb)){if(Ka){vd=zb.GroupUI;let Oe=pb.a.Mc(this.KLa,vd);Oe||(Oe=[],this.KLa[vd]=Oe,this.a$.push(vd));Oe.push(zb)}zb.IsCommonlyUsed&&Yb.push(zb);zb.IsCompatibility||this.fBg.push(se)}}this.KLa[oc]=Wc;Ka&&(pd.uYf(Yb,[2,3,0,5,4,9,1,7,8,6]),Yb=Array(14),Yb[0]=0,Yb[1]=1,Yb[2]=7,Yb[3]=11,Yb[4]=5,Yb[5]=2,Yb[6]=6,Yb[7]=10,Yb[8]=9,Yb[9]=3,Yb[10]=4,Yb[11]=13,Yb[12]=12,Yb[13]=8,pd.uYf(this.a$,Yb),Yb=[],Yb.push(...this.a$),Yb.splice(13,1),
this.a$=Yb);Yb=(Dd,be)=>Dd.NameUI.localeCompare(be.NameUI);this.rT=[...this.rT];this.rT.sort((Dd,be)=>Dd.NameDataStrings.localeCompare(be.NameDataStrings));for(let Dd=1,be=this.a$.length;Dd<be&&Ka;Dd++)this.KLa[this.a$[Dd]].sort(Yb);for(let Dd=0,be=this.rT.length;Dd<be;Dd++)this.rT[Dd].FunctionIndex=Dd}static uYf(Ka,zb){const Yb=[...Ka];for(let oc=0;oc<Yb.length&&oc<zb.length;oc++)Ka[oc]=Yb[zb[oc]]}}Object(h.a)(pd,"FunctionInfoManager",te.a,[615,616,2]);var Vd=a(246),$d=a(101),ue=a(52),he=a(733);
class Ge extends $d.a{constructor(Ka,zb,Yb,oc=null){super(Ka,oc);this.E4=null;this.jQb=this.sZd=!1;this.offsetParent=this.Q8=this.R3a=null;this.hOc=!1;this.$Ed=Wc=>this.p7(Wc);this.ZEd=Wc=>this.o7(Wc);this.vFf=Wc=>{const vd=B.HelperMethods.Ko(Wc);vd.button===Sys.UI.MouseButton.leftButton&&2===Wc.Cb&&(this.Isd(vd.target)||this.CUa(vd));return!1};this.V$d=zb;Yb&&(this.sZd=!0,Vd.a.instance.ta(Ua.a.pointerDown,this.MQe,this.vFf));this.uga=!1}get J$b(){return this.uga}get MQe(){return this.V$d}get Dgi(){return this.hOc}dispose(){this.sZd&&
(Vd.a.instance.Ba(Ua.a.vk,this.MQe,this.vFf),this.sZd=!1);this.jQb&&(this.jQb=!1,Vd.a.instance.Ba(Ua.a.og,this.domElement.ownerDocument.body,this.$Ed),Vd.a.instance.Ba(Ua.a.vk,this.domElement.ownerDocument.body,this.ZEd));this.E4=this.V$d=null;super.dispose()}nre(Ka){this.E4?this.E4.push(Ka):this.E4=[Ka]}Isd(Ka){if(this.E4)for(let zb=0,Yb=this.E4.length;zb<Yb;++zb)if(ka.DOMElementExtensions.Mf(this.E4[zb],Ka))return!0;return!1}CUa(Ka){this.J$b||(this.uga=!0,Ha.a.equals(this.domElement.currentStyle.position,
"absolute",!0)||(this.domElement.style.position="absolute"),this.txh(),Vd.a.instance.ta(Ua.a.og,this.domElement.ownerDocument.body,this.$Ed),Vd.a.instance.ta(Ua.a.vk,this.domElement.ownerDocument.body,this.ZEd),this.jQb=!0,this.drag(!0,Ka))}drag(Ka,zb){Xa.g(zb);var Yb=new ue.a(0,0),oc=new Sys.UI.Point(zb.clientX,zb.clientY);zb=this.domElement.parentNode;oc=he.a.fv(Yb,zb,oc,this.isRtl());Ka?(Yb=he.a.xF(Yb,zb,this.domElement,this.isRtl()),this.R3a=he.a.hE(oc,Yb),this.Q8=oc,this.hOc=!1):!this.Dgi&&this.zgi(oc,
this.Q8)&&(this.hOc=!0);Yb=he.a.hE(oc,this.R3a);he.a.kfb(zb,this.domElement,Yb,this.isRtl(),Ka)}Kw(Ka){this.jQb&&(this.jQb=!1,Vd.a.instance.Ba(Ua.a.og,this.domElement.ownerDocument.body,this.$Ed),Vd.a.instance.Ba(Ua.a.vk,this.domElement.ownerDocument.body,this.ZEd));Xa.g(Ka);this.uga=!1;this.Q8=this.R3a=null}p7(Ka){const zb=B.HelperMethods.Ko(Ka);zb.button===Sys.UI.MouseButton.leftButton&&2===Ka.Cb&&this.Kw(zb);return!1}o7(Ka){2===Ka.Cb&&this.drag(!1,B.HelperMethods.Ko(Ka));return!1}zgi(Ka,zb){return zb.x<
Ka.x-2||zb.x>Ka.x+2||zb.y<Ka.y-2||zb.y>Ka.y+2}txh(){this.offsetParent=this.domElement.offsetParent||this.domElement.ownerDocument.body;ka.DOMElementExtensions.getLocation(this.offsetParent)}}Object(h.a)(Ge,"BaseDraggableBehavior",$d.a,[]);class Ad extends Ge{constructor(Ka,zb,Yb=null,oc=!1){super(Ka,zb,!1,Yb);this.JTa(oc);this.tj=Ha.a.equals("rtl",Ka.dir,!0)}setVisible(Ka){ka.DOMElementExtensions.setVisible(this.domElement,Ka);Ka||(this.domElement.style.top="auto",this.domElement.style.left="auto")}isRtl(){return this.tj}JTa(Ka){const zb=
this.domElement.style;zb.cursor="move";zb.position=Ka?"relative":"absolute"}}Object(h.a)(Ad,"FunctionParamBoxDraggableItem",Ge,[]);class Ie{constructor(){this.onDismissClick=this.onFeedback=this.onHelpLink=this.onIsExpandedChange=this.onCardModeChange=null}}Object(h.a)(Ie,"FormulaArgumentAssistanceCallbacks",null,[]);class me{constructor(){this.callbacks=this.functionRenderingInfo=null;this.cardMode=0;this.showCollapseText=this.isExpanded=!1}}Object(h.a)(me,"FormulaArgumentAssistanceRenderingInfo",
null,[]);var cc=a(91),$c=a(114),rd=a(166);class Nd{constructor(Ka){this.Gv=Ka;this.sB=this.UTa=this.Xi=!1;this.onKeyDown=zb=>!this.sB&&zb.keyCode===cc.a.Vfa&&zb.altKey&&zb.ctrlKey?(this.l4a(),zb.stopPropagation(),zb.preventDefault(),!0):!1;this.Hma=zb=>{if(!this.sB)return!1;if(zb.eventName===Ua.a.fc){const Yb=zb.Da.ctrlKey?1:zb.Da.shiftKey?50:10;switch(zb.Da.keyCode){case cc.a.Aqa:this.XK(0,-Yb);break;case cc.a.o9:this.XK(0,Yb);break;case cc.a.p9:this.XK(-Yb,0);break;case cc.a.GDa:this.XK(Yb,0);break;
case cc.a.DG:case cc.a.Wh:this.UTa=!0;break;default:return!1}}zb.eventName===Ua.a.Vd&&this.UTa&&this.RM(!0);zb.Da.preventDefault();return!0};this.EAa=zb=>{if(!this.sB)return!1;zb.Da.preventDefault();this.RM();return!0};this.onBlur=()=>{if(!this.sB)return!1;this.RM();return!0};this.Mo=$c.KeyInputManager.instance;this.pointerInputManager=Vd.a.instance}la(Ka){(this.root=Ka)&&!this.Xi&&(this.root.addEventListener("keydown",this.onKeyDown,!0),this.Xi=!0)}detach(){this.root&&this.Xi&&(this.root.addEventListener("keydown",
this.onKeyDown,!0),this.Xi=!1)}l4a(){this.root&&(this.target=this.Gv.BIb("move",!0),this.RYd=this.target.getBoundingClientRect(),this.sB=!0,this.UTa=!1,this.au(),this.Hza||this.fub(),this.target.appendChild(this.Hza))}RM(Ka=!1){this.Gv.nrc(Ka);this.sB=!1;this.qLb();this.gLb();this.RYd=this.target=void 0}au(){this.Mo.capture(this.Hma,null);this.pointerInputManager.Js(Ua.a.pointerDown,this.target,this.EAa,!0);this.target.addEventListener("blur",this.onBlur)}gLb(){this.Mo.releaseCapture();this.pointerInputManager.Us(Ua.a.pointerDown,
this.target,this.EAa,!0);this.target.removeEventListener("blur",this.onBlur)}qLb(){var Ka;this.target&&(null===(Ka=this.Hza)||void 0===Ka?void 0:Ka.parentNode)===this.target&&this.target.removeChild(this.Hza)}XK(Ka,zb){const Yb=this.target.getBoundingClientRect();this.Gv.onMove(Ka+Yb.left-this.RYd.left,zb+Yb.top-this.RYd.top)}fub(){this.Hza=rd.createClusteredImage(24,24,"ShapeQuadArrow_24x24x32","WACMoveArrowIcon",!0,"")}}Object(h.a)(Nd,"FormulaAssistanceMoveAdapter",null,[]);var ed=a(289);class yd{constructor(Ka){this.Gv=
Ka;this.Xi=!1}W5(){return this.Xi&&!!this.vD}cAa(Ka){this.vD.style.cursor="grabbing";this.yUj=Ka.clientPoint.x;this.zUj=Ka.clientPoint.y;this.Gv.BIb("drag");return!0}Rda(Ka){this.Gv.onMove(Ka.clientPoint.x-this.yUj,Ka.clientPoint.y-this.zUj);return!0}Qda(){this.Kw()}Pda(){this.Kw()}la(Ka){if(this.vD=Ka)this.vD.style.cursor="grab",ed.a.instance.cX(this.vD,this),this.Xi=!0}detach(){this.Xi&&this.vD&&(this.vD.style.cursor="",ed.a.instance.O1(this.vD,this),this.Xi=!1)}Kw(){this.vD.style.cursor="grab";
this.Gv.nrc()}}Object(h.a)(yd,"FormulaAssistanceDragAdapter",null,[648]);class Ed{get YHc(){return this.BLa.getWindowEdgeBuffer()+1}constructor(Ka,zb){this.BLa=Ka;this.formulaAssistanceTelemetryManager=zb;this.Xi=!1;this.gIa=N.EwaSettings.isChangeGateEnabled("OfficeVSO:7376612_argumentAssistanceOrderedActionsTelemetry");this.U1={[Ud.Drag]:0,[Ud.Move]:0};this.wGb=new Nd(this);this.Avb=new yd(this)}la(Ka,zb,Yb,oc){this.root=Ka;this.render=Yb;this.dismiss=oc;this.detach();zb&&(this.Avb.la(zb),this.wGb.la(Ka.firstChild),
this.Xi=!0)}detach(){this.Xi&&(this.Avb.detach(),this.wGb.detach(),this.Xi=!1);ka.DOMElementExtensions.Hf(this.placeholder)}clear(){this.BLa.setOverrideTarget(void 0);this.detach();this.lMb()}BIb(Ka,zb=!1){this.U1[Ka]+=1;this.aDc=this.root.firstChild.getBoundingClientRect();this.placeholder=this.root.cloneNode(!0);Ka=this.placeholder.firstChild;Ka.style.animationDuration="0ms";this.root.parentElement.appendChild(this.placeholder);zb&&(this.FRa=document.activeElement,Ka.tabIndex=0,Ka.focus());this.dismiss();
return Ka}onMove(Ka,zb){this.placeholder.firstChild.style.transform=`translate(${Math.min(Math.max(Ka,this.YHc-this.aDc.left),window.innerWidth-this.aDc.right-this.YHc)}px, ${Math.min(Math.max(zb,this.YHc-this.aDc.top),window.innerHeight-this.aDc.bottom-this.YHc)}px)`}nrc(Ka=!0){const zb=this.placeholder.firstChild.getBoundingClientRect(),Yb=this.BLa.getDirectionalHint({top:zb.top,left:zb.left});this.BLa.setOverrideTarget({top:1===Yb?zb.bottom:zb.top,left:zb.left});this.render();window.requestAnimationFrame(()=>
{ka.DOMElementExtensions.Hf(this.placeholder);this.FRa&&(Ka&&this.FRa.focus(),this.FRa=void 0)})}lMb(){const Ka=this.U1[Ud.Drag],zb=this.U1[Ud.Move];0<Ka&&(this.formulaAssistanceTelemetryManager.MJ("d"),this.gIa||(this.formulaAssistanceTelemetryManager.XP.argumentAssistanceDragTotalCounter+=Ka),this.U1[Ud.Drag]=0);0<zb&&(this.formulaAssistanceTelemetryManager.MJ("m"),this.gIa||(this.formulaAssistanceTelemetryManager.XP.argumentAssistanceMoveTotalCounter+=zb),this.U1[Ud.Move]=0)}}Object(h.a)(Ed,"FormulaAssistanceDragControl",
null,[]);var Ud;(function(Ka){Ka.Drag="drag";Ka.Move="move"})(Ud||(Ud={}));Object(h.b)("FormulaAssistanceDragMode",Ud);class fe extends mb.a{constructor(Ka,zb,Yb,oc,Wc,vd,Dd){super(fe.OLa(Ca.a.R5(Ka),N.EwaSettings.isChangeGateEnabled("OfficeVSO:6296544_ReduceInnerHTMLUsage"),Dd));this.$=Ka;this.Kj=zb;this.functionInfoManager=Yb;this.formulaAssistanceUIControl=oc;this.formulaAssistanceTelemetryManager=Wc;this.pluginScheduler=vd;this.Sb=Dd;this.T3a=null;this.naa=0;this.Tq=null;this.Q0c=!1;this.Lma=
this.Uo=null;this.kma=N.EwaSettings.isChangeGateEnabled("OfficeVSO:6409372_isGroupwisePluginOperationsUsed");this.onCardModeChange=be=>{this.k2d(be);1===be?this.formulaAssistanceTelemetryManager.MJ("c"):this.formulaAssistanceTelemetryManager.MJ("e")};this.kTa=be=>{const se={};se[F.a.AH]="ArgumentAssistanceCard";const Oe={};Oe.FunctionName=be.functionName;se[F.a.Rbc]=Oe;this.$.Xc(802602464,0,8,se)};this.Wf=()=>{this.Gv.clear()};this.vYi=be=>{be.button===Sys.UI.MouseButton.leftButton&&be.target&&(Xa.g(be),
this.T3a&&this.T3a.CUa(be))};this.Vt=()=>{void 0!==this.Uo&&null!==this.Uo&&this.Uo()};this.tl=Ca.a.R5(Ka);this.xCi=N.EwaSettings.isChangeGateEnabled("OfficeVSO:6296544_ReduceInnerHTMLUsage");this.tl?(this.VTd(),this.Tq=new Qd(this.$,this.formulaAssistanceUIControl,0,pc.a.ggd),N.EwaSettings.isChangeGateEnabled("OfficeVSO:7457690_ArgumentAssistanceOnEditEnded")&&M.h(this.$).cellTextEditBox.Bm(this.Wf),this.Gv=new Ed(this.formulaAssistanceUIControl,this.formulaAssistanceTelemetryManager),N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaAssistanceNoLayer",
!1)&&this.$.domElement.appendChild(this.domElement)):(this.T3a=new Ad(this.domElement,this.$.VC,void 0,Ca.a.tN()),this.Pc.la("mousedown",this.vYi),Ka=$get(n.Ggd,this.Kj),this.Kj.insertBefore(this.domElement,Ka));M.h(this.$).view.qt(this.Vt)}vte(Ka){this.addHandler("FAFunctionNameUpdated",Ka)}d_f(Ka){this.removeHandler("FAFunctionNameUpdated",Ka)}mue(Ka){this.addHandler("FAParameterSelectionChangedOld",Ka)}C_f(Ka){this.removeHandler("FAParameterSelectionChangedOld",Ka)}lue(Ka){this.addHandler("FAParameterSelectionChanged",
Ka)}B_f(Ka){this.removeHandler("FAParameterSelectionChanged",Ka)}set_visible(Ka){this.tl?Ka||this.W9b():Sys.UI.Control.prototype.set_visible.call(this,Ka);return Ka}W9b(){this.formulaAssistanceUIControl&&(this.Uo=null,this.Gv.detach(),this.formulaAssistanceUIControl.dismiss(this.domElement),this.Lma=null,this.Tq.Qf=!1)}show(Ka){this.tl||(this.formulaAssistanceTelemetryManager.gE(["argumentAssistanceRender"]),this.T3a.setVisible(!!Ka),this.formulaAssistanceTelemetryManager.Hv(["argumentAssistanceRender"]),
this.Q0c&&(this.Q0c=!1,this.formulaAssistanceTelemetryManager.Cva("argumentAssistanceOverall")))}GPd(){this.formulaAssistanceTelemetryManager.gE(["argumentAssistanceOverall"]);this.formulaAssistanceTelemetryManager.gE(["argumentAssistanceComputation"]);const Ka=M.h(this.$).Ih,zb={content:Ka.text,caretPosition:Ka.textBox.caretPosition};(this.kma?this.pluginScheduler.getRequester().argumentAssistance(zb,0):this.pluginScheduler.requester().argumentAssistance(zb)).then(Yb=>{0===Yb.kind?Yb.payload?(this.formulaAssistanceTelemetryManager.Hv(["argumentAssistanceComputation"]),
this.hOj(this.xuc(Yb.payload),Ka.textBox.domElement)):this.W9b():this.formulaAssistanceTelemetryManager.Hv(["argumentAssistanceComputation"],!1);return null})}update(Ka,zb,Yb,oc){if(!this.tl&&Ka){this.formulaAssistanceTelemetryManager.gE(["argumentAssistanceComputation","argumentAssistanceOverall"]);this.Q0c=!0;var Wc=this.$.listSeparator;try{var vd=$get(n.Igd,this.Kj);const Dd=$get(n.Bgd,this.Kj);vd.innerText="";Dd.innerText="";const be=$get(n.P1e,this.Kj),se=Ka.Params.split(n.Sdd);vd=[];for(let Oe=
0,Me=be.rows.length;Oe<Me;Oe++){const Ia=be.rows[Oe];ka.DOMElementExtensions.setVisible(Ia,Oe<se.length);let Jb=se[Oe];const xc=n.g9i+Oe+"_",Zc=Ka.NameDataStrings;$get(xc+n.jJb,Ia).innerText=Zc;$get(xc+n.WHd,Ia).innerText=Zc;if(Jb){const qd=se[Oe].split(Wc),Pd=fe.Asd(qd[qd.length-1]),le=fe.uxi(Ka);Pd&&(le&&(2<qd.length?(qd[qd.length-2]+="1",qd[qd.length-3]+="1"):v.ULS.sendTraceTag(537162073,0,50,"pair params formula should have at least 2 params. at UpdateParameterAssistance. formula '{0}', {1} params, currentParameterIndex = {3}.",
Zc,qd.length.toString(),zb)),fe.dWg(qd,le,zb,Ka));Jb=qd.join(Wc.toString()+" ");se[Oe]=Jb;Yb<qd.length?(vd[Oe]=qd[Yb],v.ULS.shipAssertTag(537162072,0,!!qd[Yb]&&1<=qd[Yb].length,"Emphasized parameter is too short or empty selectedParameterIndex = {0}, currRowParamsArray.Length = {1}, formula name = {3}, current row = {4}",Yb,qd.length,Zc,Oe),qd[Yb]=`${"<b>"}${qd[Yb]}${"</b>"}`,Jb=qd.join(Wc.toString()+" ")):v.ULS.shipAssertTag(537162071,0,!1,"the current param index is larger than the param list count. selectedParameterIndex = "+
Yb+"currRowParamsArray.Length = "+qd.length+", current row = "+Oe);oc&&v.ULS.sendTraceTag(558474578,0,50,`formula '${Zc}', ${qd.length} params, isElipsis = ${Pd}, isPairsParamsFormula = ${le}, currentParameterIndex = ${zb}`)}this.xCi?this.Sb.uh($get(xc+n.ytc,Ia),"("+(Jb||"")+")"):$get(xc+n.ytc,Ia).innerHTML="("+(Jb||"")+")"}oc?this.raiseEvent("FAFunctionNameUpdated",new gb(Ka.NameDataStrings,se)):this.raiseEvent("FAParameterSelectionChangedOld",new Xb(se,vd,Yb));be.className=da.a.qBh+(this.functionInfoManager.kkc(Ka)?
"-udf":"")}catch(Dd){throw v.ULS.shipAssertTag(558474577,0,!1,"UpdateParameterAssistance Exception. formula '{0}', {1} params. \nException: {4}",Ka.NameDataStrings,zb,Dd),Dd;}this.formulaAssistanceTelemetryManager.Hv(["argumentAssistanceComputation"])}}dispose(){this.tl||(this.Pc.iD(),Oa.a.Ja(this.Pc),M.h(this.$).view.hr(this.Vt),Oa.a.Ja(this.T3a),this.T3a=null);this.tl&&(Oa.a.Ja(this.Tq),N.EwaSettings.isChangeGateEnabled("OfficeVSO:7457690_ArgumentAssistanceOnEditEnded")&&M.h(this.$).cellTextEditBox.km(this.Wf));
this.functionInfoManager=this.$=null;super.dispose()}xuc(Ka){const zb=new me;zb.functionRenderingInfo=Ka;zb.cardMode=this.naa;this.cNd(zb);return zb}cNd(Ka){Ka.callbacks=new Ie;Ka.callbacks.onHelpLink=this.Ejd(Ka.functionRenderingInfo);Ka.callbacks.onCardModeChange=this.onCardModeChange;Ka.callbacks.onFeedback=this.kTa}hOj(Ka,zb){if(this.formulaAssistanceUIControl){this.formulaAssistanceTelemetryManager.gE(["argumentAssistanceRender"]);const Yb={};Yb.zoomLevel=ca(this.$);this.formulaAssistanceUIControl.updateContext(Yb);
this.Uo=()=>{this.formulaAssistanceUIControl.renderArgumentAssistanceCard(this.domElement,zb,Ka,()=>{})};this.Uo();this.Fxc();this.Utc(Ka);this.Gv.la(this.formulaAssistanceUIControl.getCalloutElement(0),this.formulaAssistanceUIControl.getDraggableElement(0),this.Uo,()=>this.formulaAssistanceUIControl.dismiss(this.domElement));this.Tq.Qf=!0;this.formulaAssistanceTelemetryManager.Hv(["argumentAssistanceRender"]);this.formulaAssistanceTelemetryManager.Cva("argumentAssistanceOverall")}}Ejd(Ka){return()=>
{I(this.$,Ka.helpID,Ka.isUDF)}}VTd(){const Ka=Nb.a.get(F.a.Uqb);this.naa=Ka?parseInt(Ka,10):fe.w$c;this.formulaAssistanceTelemetryManager.t7f(this.naa)}Utc(Ka){var zb=Ka.functionRenderingInfo.functionName;this.Lma&&Ha.a.equals(this.Lma,zb,!0)?(zb=Ra.a.map(Ka.functionRenderingInfo.signatures,Yb=>{let oc="";0<=Yb.signatureParams.activeParam&&Yb.signatureParams.activeParam<Yb.signatureParams.params.length&&(oc=Yb.signatureParams.params[Yb.signatureParams.activeParam]);return oc}),this.raiseEvent("FAParameterSelectionChanged",
new lb(zb))):(this.Lma=zb,Ka=Ra.a.map(Ka.functionRenderingInfo.signatures,Yb=>Yb.signatureParams.params.join(", ")),this.raiseEvent("FAFunctionNameUpdated",new gb(zb,Ka)))}k2d(Ka){this.naa=Ka;try{Nb.a.Qs(F.a.Uqb,Ka.toString(),ob.AFrame.hP)}catch(zb){v.ULS.sendTraceTag(537162070,0,15,`Failed setting ArgumentAssistanceCardCollapseState cookie with error message: ${zb.message}`)}}Fxc(){const Ka=this.formulaAssistanceUIControl.getPosition().renderDown?"rd":"ru";this.formulaAssistanceTelemetryManager.MJ(Ka)}static Asd(Ka){return Ha.a.contains(Ka,
n.Z$b,!0)}static uxi(Ka){return!!Ka&&Ha.a.d4a(Ka.NameDataStrings,"IFS")}static dWg(Ka,zb,Yb,oc){try{if(!Ka||2>Ka.length)v.ULS.shipAssertTag(537162069,0,!1,`Requested not on elipsis function, formula '${oc.NameDataStrings}', ${Ka?Ka.length.toString():"currRowParamsArray == null"} params, isPairsParamsFormula = ${zb}, currentParameterIndex = ${Yb}.`);else{var Wc=Ka.pop().toString();for(let vd=Ka.length-1;vd<Yb;vd++){const Dd=Ka[vd].trim();if(zb){const be=Ka[vd-1].trim();Ka.push(fe.GRh(be,Dd))}else{const be=
fe.bhf(Dd);Ka.push(fe.r2e(be))}}Ka.push(Wc)}}catch(vd){throw v.ULS.shipAssertTag(537162068,0,!1,`AppendNewOptionalParameters Exception. formula '${oc.NameDataStrings}', ${Ka?Ka.length.toString():"currRowParamsArray == null"} params, isPairsParamsFormula = ${zb}, currentParameterIndex = ${Yb}.
Exception: ${vd}`),vd;}}static GRh(Ka,zb){Ka=fe.bhf(Ka);const Yb=fe.L8e(Ka);zb=fe.L8e(zb);return fe.r2e(Ka,!0,!!Yb&&!!zb&&Yb!==zb)}static bhf(Ka){var zb=Ka.match(fe.QDd);Ka=Ha.a.trimEnd(Ha.a.trimStart(Ka,n.COf),n.BOf);if(zb&&zb.length){zb=zb[zb.length-1];const Yb=Number.parseLocale(zb)+1;Ka=Ka.replace(zb,Yb.toString())}else Ka=`${Ka}${1}`;return Ka}static r2e(Ka,zb=!1,Yb=!1){let oc="[{0}]";zb&&(oc=Yb?"[{0}":"{0}]");return String.format(oc,Ka)}static L8e(Ka){return(Ka=Ka.match(fe.QDd))&&Ka.length?
Ka[0]:null}static OLa(Ka,zb,Yb){if(Ka)return document.createElement("div");Ka=String.format(n.nPf,n.lPf,n.WHd,da.a.UUe,n.jJb,da.a.TUe,n.ytc);var oc=String.format(n.nPf,n.mPf,n.WHd,da.a.UUe,n.jJb,da.a.TUe,n.ytc);Ka=String.format(n.TPh,n.UPh,da.a.JVe,da.a.xyh,x.a.Ho,n.P1e,Ka,oc);oc=document.createElement("div");zb?Yb.uh(oc,Ka):oc.innerHTML=Ka;return oc.firstChild}}fe.QDd=RegExp("\\d+");fe.w$c=0;Object(h.a)(fe,"FormulaArgumentAssistanceControlDeprecated",mb.a,[627]);class We{constructor(){this.Uia=this.vua=
this.wua=!1;this.pOf=40;this.gGe=41;this.c2a=this.BHd=this.CHd=this.kJb=0;this.WEf=!0;this.dGd=!1;this.V_e=this.$Rd=-1}}Object(h.a)(We,"ParseContext",null,[]);var lf=a(425),Se=a(950),Ae=a(333),Qe=a(783),$e=a(954),of=a(70);class re extends Se.a{constructor(Ka,zb,Yb,oc){super(Ka,zb);this.formulaAssistanceControl=Yb;this.formulaAssistanceTelemetryManager=oc;this.YNf=!1;this.ZTa=null;this.Npd=0;this.aKa=this.IKc=null;this.AQ=0;this.nrb=zb.textBox;this.tl=Ca.a.R5(Ka);this.$nj=N.EwaSettings.zb()}get bCb(){return Object(lf.a)(wb,
this.$.ub.vh)}get KK(){return this.formulaAssistanceControl.Ae}set KK(Ka){this.formulaAssistanceControl.Ae=Ka}get z7a(){return this.Db.z7a}get Vji(){var Ka=this.nrb.text;let zb=!1;if(0>=Ka.length)return zb;const Yb=this.$.Rb.Qc("LoadingUIShown","FormulaAutoCompleteListAutoCompleteBehavior"),oc=M.h(this.$).ga.qa.activeCell.clone();var Wc=Ka.charCodeAt(0);this.aKa="";this.AQ=this.p6g(Ka,this.nrb.caretPosition);if(61===Wc&&-1!==this.AQ){Wc=0;for(var vd=this.AQ-1;1<=vd&&!(this.AQ-vd>re.pNi);vd--)if(re.k0g.includes(Ka.charAt(vd))){Wc=
vd;break}Wc=Ka.substring(Wc+1,this.AQ);Ka=""!==Wc?this.$.Hb.getItemByName(Wc):null;vd=this.AQ;for(let Dd=this.AQ+1;Dd<=this.Db.textBox.caretPosition;Dd++)if("["===this.Db.text.charAt(Dd))vd=Dd;else break;this.AQ=vd;Ka&&2===Ka.type?(zb=!0,this.aKa=Wc):M.h(this.$).wb.mh(oc)&&(zb=!0,this.aKa="")}Yb.stop();this.Npd=Yb.Jc;v.ULS.sendTraceTag(575776011,0,50,`FormulaAutoCompleteListAutoCompleteBehavior.InTableHeaderMode: Regression time in cell edit due to column header mode parsing is ${this.Npd} milliseconds`);
return zb}get key(){return w.a.Axb}get calcManager(){this.IKc||(this.IKc=Object(of.c)({xna:266,new:H.g,registry:this.$.da,oLa:N.EwaSettings.Kqa}));return this.IKc}get sWd(){if(null!=this.ZTa)return this.ZTa;if(!N.EwaSettings.ya(128))return this.ZTa=!1;const Ka=M.h(this.$).ga.qa.activeCell.clone();if(1!==Ka.fyf||!Ka.left||M.h(this.$).ga.qa.oOa())return!1;let zb=this.formulaAssistanceControl.tableManager.aq(Ka);if(zb)return this.ZTa=!1;--Ka.left;--Ka.right;if(!Ka.Qz)return!1;zb=this.formulaAssistanceControl.tableManager.aq(Ka);
return this.ZTa=!!zb&&Ka.top===zb.top&&this.formulaAssistanceControl.tableManager.Seh(zb,M.h(this.$))}ai(Ka,zb){this.formulaAssistanceControl.Db=this.Db;-1470715894!==zb&&-1231471547!==zb||!this.WOe()||(this.KK=!1);return super.ai(Ka,zb)}nEd(){var Ka=this.z7a;if(Ka||this.sWd)if(this.formulaAssistanceControl.Db=this.Db,this.formulaAssistanceTelemetryManager.srb.formulaAssistanceRequestAttemptedCounter++,this.WOe())if(!Ka&&this.sWd)this.formulaAssistanceControl.pye();else if(this.Vji){if(Ka=this.$.Rb.Qc("LoadingUIShown",
"FormulaAutoCompleteListAutoCompleteBehavior"),this.formulaAssistanceControl.rye(),Ka.stop(),this.nrb.text.endsWith("[")&&"["!==this.nrb.text.charAt(this.nrb.text.length-2)){const zb=""===this.aKa?this.formulaAssistanceControl.tableManager.lj:Object(Aa.a)(Ae.a,this.$.Hb.getItemByName(this.aKa));v.ULS.sendTraceTag(575776010,0,50,`FormulaAutoCompleteListAutoCompleteBehavior.OnAutoCompleteTimerTick: AutoComplete List Box for Table Column Headers is shown after user types =[ inside a table with id ${zb.sj} in ${Ka.Jc} ms with cell edit regression time of ${this.Npd} ms and popup visibility - ${this.KK}`)}}else this.formulaAssistanceControl.drb(),
this.YNf&&(this.YNf=this.KK=!1);else this.formulaAssistanceTelemetryManager.srb.formulaAssistanceRequestOptimizedCounter++;else this.KK=!1}Ki(){this.$nj||(this.ZTa=null,this.sWd&&this.formulaAssistanceControl.d_())}Wf(){this.KK=!1;this.formulaAssistanceControl.set_visible(!1);this.formulaAssistanceControl.Pxc();this.tl&&this.jIi()}MKd(Ka,zb){return this.formulaAssistanceControl.ai(Ka,zb)}jIi(){N.EwaSettings.isChangeGateEnabled("OfficeVSO:7041469_LogSuggestionsDismissalControl")&&this.formulaAssistanceControl.tba&&
!this.formulaAssistanceControl.Eja&&!this.formulaAssistanceControl.Hpa&&(this.formulaAssistanceTelemetryManager.UJ.dismissSmartSuggestionImplicitlyCounter++,this.formulaAssistanceControl.tba=!1);this.formulaAssistanceControl.fJ&&(this.formulaAssistanceTelemetryManager.pD.smartSuggestionShownCounter++,this.formulaAssistanceControl.fJ=!1,Object(Qe.b)($e.a));this.formulaAssistanceControl.Hpa&&(this.formulaAssistanceTelemetryManager.pD.smartSuggestionSelectedCounter++,this.formulaAssistanceControl.Hpa=
!1,Object(Qe.b)($e.c));this.formulaAssistanceControl.xUa&&(this.formulaAssistanceTelemetryManager.pD.smartSuggestionCommittedCounter++,this.formulaAssistanceControl.xUa=!1);this.formulaAssistanceControl.isCellContentOnlyEqualDuringEdit&&(this.formulaAssistanceTelemetryManager.pD.isCellContentOnlyEqualDuringEditCounter++,this.formulaAssistanceControl.isCellContentOnlyEqualDuringEdit=!1);this.formulaAssistanceControl.QNa&&(this.formulaAssistanceTelemetryManager.pD.isCellContentFormulaCounter++,this.formulaAssistanceControl.QNa=
!1)}p6g(Ka,zb){let Yb=0,oc;for(;-1!==Yb;)if(Yb=Ka.indexOf("[",Yb+1),-1!==Yb&&Yb<zb&&(oc=Ka.indexOf("]",Yb+1),-1===oc||oc>=zb))return Yb;return-1}WOe(){const Ka=this.Db.text,zb=this.Db.textBox.caretPosition,Yb=this.formulaAssistanceControl.jda,oc=this.formulaAssistanceControl.Mma;if(this.KK&&Ha.a.equals(Ka,Yb,!0)&&zb===oc)return!1;this.formulaAssistanceControl.jda=Ka;this.formulaAssistanceControl.Mma=zb;return!0}}re.k0g=" !%&'()*+,-/:;<=>@[]^{|}~".split("");re.pNi=255;Object(h.a)(re,"FormulaAutoCompleteListAutoCompleteBehavior",
Se.a,[]);var zf;(function(Ka){Ka[Ka.function=0]="function";Ka[Ka.field=1]="field";Ka[Ka.definedName=2]="definedName";Ka[Ka.letVariable=3]="letVariable";Ka[Ka.tableColHeaderName=4]="tableColHeaderName";Ka[Ka.tableSpecialStructRef=5]="tableSpecialStructRef";Ka[Ka.pendingData=6]="pendingData";Ka[Ka.tableNamedObject=7]="tableNamedObject"})(zf||(zf={}));Object(h.b)("ItemType",zf);var Lf=a(1128),Ze=a(1127);class ec{constructor(Ka){this.index=Ka}execute(Ka){Ka.push(this.index)}}Object(h.a)(ec,"AppendIndexOperation",
null,[816]);class Lc{execute(){}}Object(h.a)(Lc,"NopIndexOperation",null,[816]);class Da{constructor(Ka,zb){this.sdj=Ka;this.HAf=zb}execute(Ka){for(let zb=0;zb<Ka.length;zb++)Ka[zb]===this.sdj&&(Ka[zb]=this.HAf)}}Object(h.a)(Da,"ReplaceIndexOperation",null,[816]);var Cb=a(85);class Zb{constructor(Ka,zb){this.$=Ka;this.items=zb;this.Nca=Ca.a.Nca(this.$)}hLe(Ka,zb){const Yb=new ec(zb);if(!this.Nca)return Yb;Ka=this.CCi(Ka,zb);return null!=Ka?this.items[Ka].GDb?new Da(Ka,zb):new Lc:Yb}CCi(Ka,zb){const Yb=
this.items[zb];v.ULS.shipAssertTag(537162075,0,!!Yb,"Internal error: invalid item index");Ka=Cb.where(Cb.asEnumerable(Ka),oc=>this.items[oc].name===Yb.name);return Cb.Ct(Ka)?Cb.first(Ka):null}}Object(h.a)(Zb,"FilterItemOperationFactory",null,[]);var yc=a(122),Vc=a(864);class jd{constructor(){this.evaluation=this.textEdit=this.label=null;this.kind=0;this.shouldRequestAutocompleteOnCommit=this.isPrefixed=this.detail=this.type=null}}Object(h.a)(jd,"CompletionItem",null,[]);const ld=`<tr>\r\n\t{0}\r\n\t<td id='name_cell{4}' class='{1}'>{2}</td>\r\n\t<td id='${"description_cell"}{4}' class='${x.a.Ho}'>{3}</td>\r\n\t<td id='${"item_type_cell"}' class='${x.a.Ho}'>{5}</td>\r\n</tr>`,
Bd=`<tr>\r\n\t{0}\r\n\t<td id='name_cell{1}' class='{3}'>{4}</td>\r\n\t<td id='${"description_cell"}{1}' class='${x.a.Ho}'></td>\r\n\t<td id='${"item_type_cell"}' class='${x.a.Ho}'>{2}</td>\r\n</tr>`,Td=`<td>\r\n\t<div class='${x.a.sz}'>\r\n\t\t<img class='{0}' src='{1}' alt='{2}'/>\r\n\t</div>\r\n</td>`,Jd=`<tr>\r\n\t<td><b>{0}</b></td>\r\n\t<td id='name_cell{1}' class='{3}'>{4}</td>\r\n\t<td id='${"description_cell"}{1}' class='${x.a.Ho}'>{5}</td>\r\n\t<td id='${"item_type_cell"}' class='${x.a.Ho}'>{2}</td>\r\n</tr>`;
class ce extends Lf.a{constructor(Ka,zb,Yb,oc,Wc,vd){super(Ka,zb);this.Sb=Wc;this.Osa=null;this.ogb=this.uzc=0;this.stb=null;this.Q1e=Yb;this.yxb=oc;this.formulaAssistanceControl=vd;this.Sq=[];this.UW=[];this.tl=Ca.a.R5(Ka);this.wvi=N.EwaSettings.isChangeGateEnabled("OfficeVSO:6296544_ReduceInnerHTMLUsage")}s_c(Ka){this.addHandler("FLBSelectedRowChanged",Ka)}DOd(Ka){this.removeHandler("FLBSelectedRowChanged",Ka)}H1b(Ka){this.addHandler("ACLBUpdated",Ka)}Swc(Ka){this.removeHandler("ACLBUpdated",Ka)}get Ylc(){return 0<
this.ogb&&this.ogb===this.Sq.length}get $zi(){return 0<this.ogb}get Ae(){return super.Ae}set Ae(Ka){super.Ae=Ka;Ka||(this.uzc=0,this.qe=null);0===this.uzc?ka.DOMElementExtensions.setVisible(this.yxb,Ka&&!this.tl):ka.DOMElementExtensions.setVisible(this.yxb,!1)}get Tj(){return this.Osa}set Tj(Ka){this.bDa(this.Tj);if(Ka){this.Q1e.innerText="";this.Osa=Ka;var zb=this.bDa(this.Tj);const Yb=Ka.rowIndex+1,oc=$get("description_cell"+Yb,Ka);this.yxb.innerText=oc.innerText;const Wc=$get("item_type_cell",
Ka);this.qe=zb=zb.innerText;this.uzc="field"===Wc.innerText?1:"definedName"===Wc.innerText?2:"letVariable"===Wc.innerText?3:"tableColHeaderName"===Wc.innerText?4:"tableSpecialStructRef"===Wc.innerText?5:"pendingData"===Wc.innerText?6:"tableNamedObject"===Wc.innerText?7:0;this.raiseEvent("FLBSelectedRowChanged",new Ze.a(this.Sq.length,Yb,zb,oc.innerText));this.fzc(Ka)}}get nVa(){return this.yxb}get nIa(){return this.formulaAssistanceControl}get g1(){return this.uzc}dispose(){super.dispose();this.Osa=
this.Q1e=this.yxb=null}ODc(Ka,zb,Yb,oc=0){this.tl||this.U8(!1);let Wc="";Yb&&(Wc+=`<table aria-live='off' id='${"list_column_header"}'><tr><td class='${da.a.cah}'>${Yb}</td></tr></table>`);Wc+=`<table class='${this.pda}' aria-live='off'><tbody>`;const vd=new Ib.a;for(let be=0,se=this.UW.length;be<se;be++)Wc+=this.iaf(Ka[this.UW[be]],be+1,zb,oc),this.tl&&vd.add(this.B4e(Ka[this.UW[be]]));let Dd=this.UW.length;for(let be=0,se=this.Sq.length;be<se;be++)this.UW.includes(this.Sq[be])||(Dd++,Wc+=this.iaf(Ka[this.Sq[be]],
Dd,zb,oc),this.tl&&vd.add(this.B4e(Ka[this.Sq[be]])));Wc+="</tbody></table>";this.wvi?this.Sb.uh(this.fg,Wc):this.fg.innerHTML=Wc;this.Sn=ka.DOMElementExtensions.sk(this.domElement,this.pda);this.tl&&(this.stb=vd.toArray());this.tl?(this.Ae=!0,this.nIa.set_visible(!0)):(this.U8(!0),this.WTg(!!Yb))}rLa(Ka,zb,Yb,oc="",Wc=0,vd=!1){if(Ka){var Dd=[],be=[];this.ogb=0;var se=new Zb(this.$,Ka);if(zb){var Oe=!!zb&&0<Wc,Me=Oe&&91===zb.charCodeAt(Wc+1)?Wc+2:Wc+1;vd=Oe?zb.length===Me:!1;Oe&&zb.length===Wc&&N.EwaSettings.ya(128)&&
(vd=!0);var Ia=null;!vd&&Oe&&zb.length>Wc+1&&(Ia=zb.substring(Me,zb.length));if(zb)for(let Jb=0,xc=Ka.length;Jb<xc;Jb++)if(Oe=Ka[Jb].name,!Ka[Jb].Gsi){Me=se.hLe(Dd,Jb);Ka[Jb].GDb&&this.ogb++;if(!Ia&&!vd||0===Ka[Jb].itemType)({ghf:Dd,BRf:be}=this.b_e(zb,Oe,Yb,Me,Dd,be));Ia&&1===Ka[Jb].itemType&&({ghf:Dd,BRf:be}=this.b_e(Ia,Oe,!0,Me,Dd,be));vd&&1===Ka[Jb].itemType&&Me.execute(Dd)}}else for(Yb=0;Yb<Ka.length;++Yb)if(Ka[Yb].GDb||vd)Ia=se.hLe(Dd,Yb),Ia.execute(Dd),Ia.execute(be),Ka[Yb].GDb&&this.ogb++;
this.UW=be;this.Sq=Dd;this.ODc(Ka,zb,oc,Wc)}}s7j(Ka){if(Ka&&!(1<Ka.length)){var zb=[],Yb=[];zb.push(0);Yb.push(0);this.UW=zb;this.Sq=Yb;this.ODc(Ka,"","",0)}}Fza(){this.Tj&&super.Fza()}Rgj(Ka,zb){this.raiseEvent("ACLBUpdated",new Ze.a(Ka,void 0,void 0,zb))}jog(Ka){const zb=this.Sn.rows[Ka];return(!this.Tj||this.Tj!==zb)&&Ka<this.Sn.rows.length?(this.Tj=zb,!0):!1}static C4e(Ka){switch(Ka){case 0:return 3;case 2:return 100;case 1:case 6:return 103;case 3:return 102;case 4:return 101;case 5:return 107;
case 7:return 106;default:return 3}}onItemClick(Ka){Xa.g(Ka.Da);0===this.g1||2===this.g1||3===this.g1||4===this.g1||5===this.g1||7===this.g1?(this.raiseEvent(Vc.a.H6a),this.Fza()):1===this.g1?this.nIa.mz(!1):(this.nIa.mz(!1),Ka=M.h(this.$),Ka.Xo(!1),Ka.focus());return!0}WTg(Ka){this.Cta();if(Ka){var zb=this.Sn.offsetWidth+(this.Sq.length>this.rI?yc.a.Xu:0);Ka=$get("list_column_header");Ka.offsetWidth>zb&&ka.DOMElementExtensions.iw(this.fg,Ka.offsetWidth);zb=this.fg.getElementsByClassName(this.a0);
for(let Yb=0;Yb<zb.length;Yb++)zb[Yb].style.width=B.HelperMethods.Ic(Ka.offsetWidth)}}iaf(Ka,zb,Yb,oc){if(1===Ka.itemType){const Wc=la.a.Jh(Ka.name),vd=la.a.Jh(oc?Yb.substring(oc+1,Yb.length):Yb);let Dd=0;Wc.substring(0,vd.length).toLowerCase()!==vd.toLowerCase()&&(Dd=ce.eUj(Wc,n.wrg,vd));Yb="";Yb=0<=Dd?Yb+(Wc.substring(0,Dd)+"<b>"+Wc.substring(Dd,Dd+vd.length)+"</b>"+Wc.substring(Dd+vd.length,Wc.length)):Yb+Wc;oc=oc?String.format(Td,x.a.kWe,la.a.Fla(aa.a.mf(0)),z.a.instance.ha(712)):"";return String.format(Bd,
oc,zb,zf[Ka.itemType],this.a0,Yb)}if(5===Ka.itemType)return String.format(Jd,"",zb,zf[Ka.itemType],this.a0,la.a.Jh(Ka.name),la.a.Jh(Ka.Fka));if(4===Ka.itemType)return String.format(Jd,"(...)",zb,zf[Ka.itemType],this.a0,la.a.Jh(Ka.name));if(6===Ka.itemType)return oc=oc?String.format(Td,x.a.kWe,la.a.Fla(aa.a.mf(0)),z.a.instance.ha(712)):"",String.format(ld,oc,this.a0,la.a.Jh(Ka.name),la.a.Jh(Ka.Fka),zb,zf[Ka.itemType]);oc=String.format(Td,2===Ka.itemType||3===Ka.itemType?x.a.yEh:x.a.wEh,la.a.Fla(aa.a.mf(0)),
z.a.instance.ha(709));return String.format(ld,oc,this.a0,la.a.Jh(Ka.name),la.a.Jh(Ka.Fka),zb,zf[Ka.itemType])}B4e(Ka){const zb=new jd;zb.label=Ka.label;zb.textEdit=Ka.textEdit;zb.kind=ce.C4e(Ka.itemType);zb.type=Ka.GDb?1:0;if(N.EwaSettings.isChangeGateEnabled("OfficeVSO:5607789_FunctionShortDescriptions")&&3===zb.kind){const Yb=this.formulaAssistanceControl.R_h(Ka.label);zb.detail=Yb?Yb:Ka.Fka}else zb.detail=Ka.Fka;return zb}b_e(Ka,zb,Yb,oc,Wc,vd){Ha.a.equals(zb,"Pretend this is the line.",!1)&&0<
Wc.length||Ha.a.rG(zb,Ka)?(oc.execute(Wc),oc.execute(vd)):Yb&&Ka.length>=n.Veh&&ce.yph(zb,n.wrg,Ka)?oc.execute(Wc):!Yb&&Ka.length>=n.Ueh&&Ha.a.contains(zb,Ka,!0)&&oc.execute(Wc);return{ghf:Wc,BRf:vd}}static yph(Ka,zb,Yb){for(const oc of zb)if(zb=Ka.split(oc),!(2>zb.length))for(const Wc of zb)if(Ha.a.rG(Wc,Yb))return!0;return!1}static eUj(Ka,zb,Yb){for(const oc of zb)if(zb=Ka.toLowerCase().indexOf((oc+Yb).toLowerCase()),0<zb)return zb+1;return-1}}Object(h.a)(ce,"FormulaAutoCompleteListBox",Lf.a,[626]);
class ie{constructor(){this.E$=this._name=null}get name(){return this._name}get toolTip(){return this.E$}}Object(h.a)(ie,"LETVariableInfo",null,[]);class we{constructor(){this._name=null}get name(){return this._name}}Object(h.a)(we,"TableColHeaderNameInfo",null,[]);class zc{constructor(){this._name=null}get name(){return this._name}}Object(h.a)(zc,"TableNamedObjectInfo",null,[]);class Sc{constructor(){this.E$=this._name=null}get name(){return this._name}get toolTip(){return this.E$}}Object(h.a)(Sc,
"TableSpecialStructRefInfo",null,[]);var td=a(171),Md=a(47),wd=a(32),Ta=a(106),Vb=a(952),qc=a(263),Ic=a(55),gd=a(154);class Kd{constructor(){this.onRestoreFocus=this.onDismiss=this.onFeedback=this.onCompletionItemCommitted=this.onCompletionItemSelected=null}}Object(h.a)(Kd,"FormulaAutoCompleteCallbacks",null,[]);class oe{constructor(){this.callbacks=this.completionItems=null;this.activeItemIndex=0}}Object(h.a)(oe,"FormulaAutoCompleteRenderingInfo",null,[]);class Ce{}Object(h.a)(Ce,"RunExperimentRequest",
null,[]);class ze extends Pb.a{constructor(Ka,zb,Yb,oc,Wc,vd,Dd,be,se,Oe){super(Ka);this.functionInfoManager=zb;this.calcManager=oc;this.instantaneousSupportInformationManager=Wc;this.formulaAssistanceUIControl=Dd;this.formulaAssistanceTelemetryManager=be;this.pluginScheduler=se;this.fhc=!1;this.y6=this.zwd=this.kW=this.lj=this.oIa=this.Tq=null;this.C8b=this.UDc=this.yvb=this.tQe=this.D4=this.idc=this.o5a=0;this.CBc=!1;this.Ftc=this.fka=null;this.columnName="";this.aDe=this.F$c=!1;this.CLa=[];this.zQ=
null;this.QPb=[];this.fga=this.Jgd=this.Uo=null;this.Eja=this.tba=this.QNa=this.isCellContentOnlyEqualDuringEdit=this.xUa=this.Hpa=this.fJ=this.Kga=!1;this.jda=null;this.Mma=0;this.x7d=null;this.vrd=!1;this.onRestoreFocus=()=>{};this.yib=void 0;this.kma=N.EwaSettings.isChangeGateEnabled("OfficeVSO:6409372_isGroupwisePluginOperationsUsed");this.Qmd=()=>{this.tl&&this.raiseEvent(ze.Nfd,null)};this.XZe=()=>{this.fka=!1;this.kW=this.Db.text;this.kh.rLa(this.Ar,this.kW,!0,this.columnName,void 0,!1);1===
this.kh.Sq.length&&1===this.kh.UW.length?(this.set_visible(!1),this.aDe||this.Hpd()):this.show()};this.xFd=Me=>{if(mc.a(Me))-315732528!==Me.Errors[0].MessageId&&v.ULS.sendTraceTag(537162013,0,10,`FormulaAssistanceControl.OnGetTableColHeadersSuccess - Webservice call failed with Unexpected error : ${wd.a.xc(Me.Errors)}`);else if((Me=Me.Result)&&Me.length){this.lj.UO||(this.lj.UO={},this.lj.UO.HeadersList=[]);this.lj.UO.IsFullTableHeaders=!0;for(let Ia=0;Ia<Me.length;++Ia)this.lj.UO.HeadersList[Ia]=
{},this.lj.UO.HeadersList[Ia].Index=Ia,this.lj.UO.HeadersList[Ia].Name=Me[Ia];this.WQf(!0);this.kW=this.faf();this.kh.rLa(this.Ar,this.kW,!0,void 0,void 0,!0);this.show()}else v.ULS.sendTraceTag(537162012,0,10,"FormulaAssistanceControl.OnGetTableColHeadersSuccess - Webservice call returned no results")};this.wFd=Me=>{Me=qb.a.Ye(Me.data);v.ULS.sendTraceTag(537162011,0,10,`FormulaAssistanceControl.OnGetTableColHeadersFailure - Webservice call failed with Errors: ${wd.a.xc(Me)}`)};this.CCf=(Me,Ia)=>
{this.gridView.jb||this.gridView.ni||this.$Gb(null===Ia||void 0===Ia?void 0:Ia.cell)};this.l7=(Me,Ia)=>{this.Dyc(Ia.newValue)};this.$c=()=>{this.set_visible(!1)};this.JGf=()=>{this.fga=this.oIa=null};this.Fj=()=>{this.tl&&this.H3a()};this.onFunctionInfoLoaded=()=>{this.drb()};this.dAa=()=>{this.Lla?(this.oIa=this.fga=null,this.drb()):this.ih.fl&&this.pye()};this.Tda=()=>{this.zQ&&I(this.$,this.zQ.HelpId,this.zQ.IsDynamicUdf);return!0};this.Yda=(Me,Ia)=>{0==Ia.er&&(170==Ia.Of.operation.operationName&&
this.formulaAssistanceTelemetryManager.REb++,this.$.userOperationManager.ro(this.Yda))};this.GQa=(Me,Ia)=>{0==Ia.er&&(12==Ia.Of.operation.operationName&&this.$.userOperationManager.tr(this.Yda),this.$.userOperationManager.ro(this.GQa))};this.H3a=()=>{this.tl&&this.Kyd();N.EwaSettings.isChangeGateEnabled("OfficeVSO:7041469_LogSuggestionsDismissalControl")&&this.fJ&&(this.tba=!0);this.CD&&this.Db.jb&&this.woa();this.Uo=null;this.formulaAssistanceUIControl&&(this.formulaAssistanceUIControl.dismiss(this.B3b),
this.Tq.Qf=!1);this.vrd=!1};this.DLf=()=>{this.CD&&this.woa();this.idg();1===this.d6f.type&&N.EwaSettings.zb()&&!this.Db.text.includes("\n")&&this.MJd(this.d6f)};this.onDismiss=()=>{this.Ae=!1;this.gridView.Ih.textBox.focus()};this.kTa=()=>{const Me={};Me[F.a.AH]=this.kh.Ylc?"SmartSuggestionsCard":this.kh.$zi?"FunctionAndSmartSuggestionsCard":"SimpleAutoCompleteCard";this.$.Xc(802602464,0,8,Me)};this.QEd=(Me,Ia)=>{this.kh.jog(Ia);this.tl&&(this.sKa=!0)};this.PEd=Me=>{this.tl&&(this.pKa=!0);this.CD?
(this.wHe(),this.J4f(),this.gridView.Fba.j7f(),this.gridView.Ih.endEdit(!0,"FormulaAssistanceControl.OnCompletionItemClicked",0)):Me.textEdit?this.ntb(Me.textEdit):this.mz(!0)};this.gridView=M.h(Ka);this.domElement.className=da.a.VTe;this.ih=vd.e8c(Ka,Yb);this.p9b=new $a(Ka);this.$Ig=Yb;ze.Lhc||(ze.Lhc=ze.OLa());N.EwaSettings.isChangeGateEnabled("OfficeVSO:6296544_ReduceInnerHTMLUsage")?Oe.uh(this.domElement,ze.Lhc):this.domElement.innerHTML=ze.Lhc;this.QDd=RegExp("\\d+");qc.d(this.style,this.$.isChromeRtl);
this.yka=new fe(this.$,this.domElement,this.functionInfoManager,this.formulaAssistanceUIControl,this.formulaAssistanceTelemetryManager,this.pluginScheduler,Oe);zb=$get(n.Ggd,this.domElement);Yb=$get(n.Bgd,this.domElement);oc=$get(n.Igd,this.domElement);this.cBg=new ce(this.$,zb,oc,Yb,Oe,this);this.ih.A1b(this.dAa);this.functionInfoManager.EHa(this.onFunctionInfoLoaded);this.functionInfoManager.VQg(this.JGf);this.B3b=this.domElement;this.tl&&(this.$.ua.kg(this.Fj),this.kh.s_c(this.DLf),N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaAssistanceNoLayer",
!1)&&(this.B3b=document.createElement("div")));this.NUa(!0);this.ugg(!0);this.$.domElement.appendChild(this.B3b);this.oVc=0;(Oe=P.a(Ka))&&this.CLa.push(new re(Ka,Oe,this,this.formulaAssistanceTelemetryManager));this.CLa.push(new re(Ka,this.gridView.hc,this,this.formulaAssistanceTelemetryManager));this.rxb=this.CLa[0];this.ysb=this.CLa[this.CLa.length-1];Ka.da.Ha(221,this);this.instantaneousSupportInformationManager||this.$.da.kb(268,Me=>{this.instantaneousSupportInformationManager=Me});this.qZe=N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.LETAutocomplete",
!1);this.wUa=Ca.a.Nca(this.$);this.Abg=Ca.a.Nca(this.$);this.sDd=N.EwaSettings.isChangeGateEnabled("OfficeVSO:5656143_SendCellFormatOnCellChanged");Ca.a.$V(this.$)&&this.yqd();Ca.a.tN()&&zb.classList.add("ewa-fb-refactor");this.tl?this.gridView.ga.IC(this.$c):this.gridView.ga.QJ(this.$c);this.Tq=new Qd(this.$,this.formulaAssistanceUIControl,1,pc.a.hgd,this.Qmd)}tte(Ka){this.addHandler(ze.ngd,Ka)}c_f(Ka){this.removeHandler(ze.ngd,Ka)}pte(Ka){this.addHandler(ze.Nfd,Ka)}ZZf(Ka){this.removeHandler(ze.Nfd,
Ka)}ste(Ka){this.addHandler("FormulaAutoCompleteShown",Ka)}b_f(Ka){this.removeHandler("FormulaAutoCompleteShown",Ka)}get yu(){return this.kh}get Ar(){return this.fga}get BNb(){return this.kh.qe}get L1e(){return this.kh}get p1e(){return this.yka}get kh(){return this.cBg}get X2a(){return this.wUa?this.Db?this.Db.text:null:this.kW}get Gnf(){var Ka;return 0===(null===(Ka=this.U_e)||void 0===Ka?void 0:Ka.type)}get jAi(){var Ka;return 1===(null===(Ka=this.U_e)||void 0===Ka?void 0:Ka.type)}get_visible(){return void 0!==
this.yib?this.yib:this.yib=super.get_visible()}set_visible(Ka){if(this.yib===Ka)return this.tl&&!Ka&&this.H3a(),Ka;this.yka.set_visible(Ka);this.tl&&!Ka&&this.H3a();Sys.UI.Control.prototype.set_visible.call(this,Ka);return this.yib=Ka}get Ae(){return this.yu.Ae}set Ae(Ka){this.tl&&!Ka&&this.H3a();this.yu.Ae=Ka}get tableManager(){return this.$Ig}get Lla(){return 0<this.KZ}get CD(){return this.Kga}get wb(){return this.gridView.wb}A5g(Ka,zb){this.Ae&&(Ka+=n.openParen,zb++,this.$Hd(Ka,zb));var Yb=zb===
Ka.length||Ka.charAt(zb)===n.closeParen;if(!(0<zb&&Ka.charAt(zb-1)===n.openParen&&Yb))return v.ULS.sendTraceTag(537162053,0,50,`FormulaAssistanceControl.CanInsertFormulaArguments Caret position: ${zb} is invalid. Is cell empty: ${!Ka.length}. Function exists in cell: ${!!this.zQ}`),!1;Yb=Ka.substring(0,zb).lastIndexOf(this.$.listSeparator);const oc=Ka.substring(0,zb-1).lastIndexOf(n.openParen);Ka=Ka.substring(-1===Yb&&-1===oc?1:Math.max(Yb,oc)+1,zb-1).trim();return this.functionInfoManager.ujd(Ka)?
!0:(v.ULS.sendTraceTag(537162052,0,50,`FormulaAssistanceControl.CanInsertFormulaArguments No valid function name before caret. Function exists in cell: ${!!this.zQ}`),!1)}xoi(Ka,zb){var Yb=this.A5g(Ka,zb);if(!Yb||!this.zQ)return v.ULS.shipAssertTag(537162051,0,!Yb||Yb&&!!this.zQ,"FormulaAssistanceControl.InsertFormulaArgumentsFromCaretPosition currentFunctionInfo is null"),{returnValue:null,DAf:0,W_e:0};Yb=this.zQ.Params;Yb=Yb.replace(RegExp("[\\[\\]]","g"),"");const oc=Ka.charAt(zb-1)===n.openParen,
Wc=oc?"":"(",vd=zb===Ka.length?")":"";var Dd=this.$.listSeparator;Dd=Yb.includes(Dd)?Yb.indexOf(Dd):Yb.length;return{returnValue:Ka.substring(0,zb)+Wc+Yb+vd+Ka.substring(zb,Ka.length),DAf:oc?zb:zb+1,W_e:Dd}}Vt(Ka,zb){this.tl&&void 0!==this.Uo&&null!==this.Uo&&this.Uo();this.tl||super.Vt(Ka,zb)}get m3b(){return this.x7d}get KZ(){return this.tQe}set KZ(Ka){this.tQe=Ka;Ka||(this.D4=0)}get nMj(){if(null==this.Ftc){const Ka=this.$.nc;this.Ftc=!!Ka&&!Ka.inEmbedView}return this.Ftc}get d6f(){return this.kh.stb[this.kh.Tj.rowIndex]}get U_e(){var Ka,
zb;return null===(zb=null===(Ka=this.kh)||void 0===Ka?void 0:Ka.stb)||void 0===zb?void 0:zb[0]}get T1e(){!this.Jgd&&this.pluginScheduler&&(this.Jgd=this.pluginScheduler.getFunctionsShortDescriptions());return this.Jgd}dispose(){if(this.$){this.NUa(!1);const Ka=this.gridView;this.$.userOperationManager.ro(this.Yda);this.$.userOperationManager.ro(this.GQa);Ka&&(Ka.ga&&(this.tl?Ka.ga.UB(this.$c):Ka.ga.LI(this.$c),Ca.a.$V(this.$)&&Ka.ga.Iea(this.CCf)),Ka.view.hr(this.Crc));this.tl&&this.$.ua&&this.$.ua.Gg(this.Fj)}this.functionInfoManager&&
(this.functionInfoManager.Qdb(this.onFunctionInfoLoaded),this.functionInfoManager.Ppj(this.JGf));this.ih&&this.ih.Mwc(this.dAa);this.tl&&this.kh&&this.kh.DOd(this.DLf);Ca.a.kjc&&this.Db&&this.Db.CLb(this.l7);this.ugg(!1);Oa.a.Ja(this.kh);Oa.a.Ja(this.m3b);Oa.a.Ja(this.yka);Oa.a.Ja(this.Tq);this.Db=this.functionInfoManager=this.ih=null;Oa.a.wc(this.CLa);this.lj=this.fga=this.yka=this.CLa=null;super.dispose()}oya(){return!this.Ar}$vi(){return!this.oIa}b5j(Ka){this.jAi&&1872288872===Ka&&(this.formulaAssistanceTelemetryManager.Hv(["autoCompleteSmartSuggestionActiveDismissing"]),
this.Eja=!0)}ai(Ka,zb){if(!this.oya()){N.EwaSettings.isChangeGateEnabled("OfficeVSO:7041469_LogSuggestionsDismissalControl")&&this.b5j(zb);if(this.tl&&this.CD){if(125627505===zb||267796030===zb)return this.tl&&this.ZFc(zb),this.wHe(),this.J4f(),!1;if(1872288872===zb)return this.woa(),this.Ae=!1,!0;if(this.kh.Ylc&&(-798660877===zb||137938150===zb))return!1}if(1!==this.kh.g1||125627505!==zb&&267796030!==zb)if(6===this.kh.g1){var Yb=Ka.keyCode;13!==Yb&&9!==Yb||this.mz(!1)}else{if(4===this.kh.g1||5===
this.kh.g1)return super.ai(Ka,zb,!0);1===this.kh.UW.length&&(Yb=Ka.keyCode,this.aDe=8===Yb||127===Yb||46===Yb?!0:!1)}else{if(this.mz(!1)&&!this.Lla)return this.gridView.ga.ai(Ka,zb);if(125627505===zb&&this.Lla)return!0}}return super.ai(Ka,zb)}Pxc(){this.ih.oeb();this.fga=null;null==this.fka||this.fka||this.Wnc("NoFieldChosen",1,2,1);this.fka=null;this.KZ=0;this.y6=this.zwd=this.Ftc=null}drb(){this.formulaAssistanceTelemetryManager.gE(["argumentAssistanceOverall"]);const Ka=!!this.Db&&!rb.f(this.$.na);
let zb=null;Ka&&(zb=this.Db.text,zb.startsWith("=")&&(this.QNa=!0,1===zb.length&&(this.isCellContentOnlyEqualDuringEdit=!0)));if(this.Abg&&Ka){const Yb={content:zb,caretPosition:null};(this.kma?this.pluginScheduler.getRequester().functionSuggestion(Yb,0):this.pluginScheduler.requester().functionSuggestion(Yb)).then(oc=>{if(0===oc.kind){v.ULS.shipAssertTag(537162050,0,!!oc&&!!oc.payload.items,"FormulaAssistanceControl.AssistFormula - x10Scheduler returned `null` suggestion");const Wc=Cb.toArray(Cb.select(Cb.asEnumerable(oc.payload.items),
vd=>ze.Jdh(vd)));this.gridView.Fba.ZTd(oc.payload,zb);this.wUa&&(this.QPb=Wc,Y.AFrameworkApplication.ug||(this.wb.o6(this.gridView.ga.qa.activeCell)?this.formulaAssistanceTelemetryManager.pD.smartSuggestionWouldSuggestInsidePivotCounter++:this.qye(Ka,!0)))}return null})}this.wUa&&Ka&&this.Abg||this.qye(Ka,!1)}faf(){const Ka=this.gridView.am?this.rxb.AQ:this.ysb.AQ;this.UDc="@"===this.Db.text.charAt(Ka+1)&&this.Db.textBox.caretPosition>Ka+1?Ka+2:Ka+1;return this.Db.text.substring(this.UDc,this.Db.textBox.caretPosition)}rye(){this.wdg()&&
(this.Flh(),this.Ar&&(this.fka=!1,this.kW=this.faf(),this.kh.rLa(this.Ar,this.kW,!0,void 0,void 0,!0),this.show(),N.EwaSettings.isChangeGateEnabled("OfficeVSO:5516893_fixInTableHeaderModeAccordingToCaretPoisiton")&&this.yka.W9b()))}pye(){this.wdg()&&(this.m3b&&this.m3b.cancel(),this.ih.w8a?(this.oya()&&this.SJe(!0),this.get_visible()?this.XZe():this.x7d=td.AsyncMethodContext.Oq(this.XZe,n.Toh,Md.a.POh,this.m3b)):this.d_())}wdg(){return this.Db?0<this.$.ub.$R||!this.Db.text||!this.Db.jb?(this.set_visible(!1),
!1):rb.f(this.$.na)?!1:!0:!1}ntb(Ka){this.Db&&this.Ae&&(this.Nqd(this.Db.text,Ka),this.Db.textBox.caretPosition=Ka.range.start.character+Ka.newText.length,this.set_visible(!1))}mz(){var Ka;if(!this.Db||!this.Ae)return!1;const zb=this.kh.g1;this.formulaAssistanceTelemetryManager.F0f(ce.C4e(zb));let Yb="";var oc=0;const Wc=this.gridView,vd=this.Db.text;var Dd=0,be=this.kh.qe,se=!1;if(0===zb||2===zb||3===zb||7===zb)Yb+=vd.substr(0,this.o5a)+this.kh.qe,0!==zb||this.kh.qe.endsWith(")")||(Yb+="("),oc=Yb.toString().length,
Yb+=vd.substr(this.idc),2===zb&&(Dd=4,be="DefinedName",se=!0,this.set_visible(!1));else if(1===zb)if(this.fka=!0,this.Lla){Yb+=vd.substr(0,this.KZ+2);!Yb.toString().endsWith(Fa.a.YU)&&N.EwaSettings.ya(128)&&(Yb+=Fa.a.YU);Dd=this.kh.qe;Dd=Dd.replace("'","''");Dd=Dd.replace("[","'[");Dd=Dd.replace("]","']");if(this.F$c||this.vKh(Dd))Dd=Fa.a.bFi+Dd+Fa.a.Pwj,se=!0;Yb+=Dd;oc=Yb.length;Dd=3;gd.a("PulloutFieldAccepted")}else return this.Db.text=this.kh.qe,this.set_visible(!1),Wc.Xo(!1),Wc.focus(),this.Wnc("FieldName",
1,1,1),gd.a("TableHeaderAutoCompleteSuggestionAccepted"),!0;else if(5===zb)v.ULS.sendTraceTag(537162048,0,50,"FormulaAssistanceControl.Autocomplete: User selected TableSpecialStructRef listbox item"),Yb+=vd.substr(0,this.UDc),Ha.a.equals(this.kh.qe,"@ - "+this.instantaneousSupportInformationManager.Ve.ThisRowStructRefString,!1)?Yb+="@":(Yb+=this.kh.qe,se=!0,this.set_visible(!1)),oc=Yb.length;else if(4===zb){v.ULS.sendTraceTag(575776009,0,50,"FormulaAssistanceControl.Autocomplete: User selected TableColHeaderName listbox item}");
Yb+=vd.substr(0,this.UDc);se="";oc=!1;const Oe=[39,91,93,64,35];for(let Me=0;Me<this.kh.qe.length;Me++){const Ia=this.kh.qe.charCodeAt(Me);Oe.includes(Ia)&&(se+="'");se+=this.kh.qe.charAt(Me).toString();oc||Ha.a.isNumeral(Ia)||Ha.a.Xmf(Ia)||(oc=!0)}Yb+="@"===vd.charAt((this.gridView.am?this.rxb.AQ:this.ysb.AQ)+1)&&oc?"["+se+"]":se;se=!0;this.set_visible(!1);oc=Yb.toString().length}else if(6===zb)Yb+=vd.substr(0,this.yvb);else return v.ULS.sendTraceTag(537162019,0,10,"Autocomplete item type was not set on AutoComplete ListBox"),
!1;this.Db.text=Yb;this.Db.textBox.caretPosition=oc;this.Db.Eya()&&(null===(Ka=Wc.hs)||void 0===Ka?0:Ka.hwa)&&Wc.hs.INb(this.Db.text,this.Db.textBox.caretPosition,this.Db.textBox.caretPosition,this.Db.textBox.xS.length);Wc.am&&(Ka=Wc.hc,Ka.text=this.Db.text,Ka.setCaretPosition(this.Db.textBox.caretPosition));be=(null==this.fka?0:this.fka)?"FieldName":be;this.kh.Tj.sectionRowIndex>=this.kh.UW.length?this.Wnc(be,4,Dd,0):this.Wnc(be,1,Dd,0);se||(5===zb||4===zb?this.rye():7===zb?this.set_visible(!1):
this.drb());return!0}d_(Ka=null,zb=null){Ka?(this.ih.oeb(),this.ih.d_(Ka,!1,!1,zb)):(Ka=this.gridView,Ka.ga.qa.ph&&(Ka=hb.v(Ka.ga.qa.gd,this.$),this.ih.d_(Ka,!0,!0,zb)))}woa(){this.Kga=!1;this.Db.zPe()}R_h(Ka){Ka=this.calcManager.getWorksheetFuncId(Ka);return this.T1e?this.T1e.descriptionsMap.get(Ka):null}SJe(Ka){if(this.$vi()){if(this.ih.w8a&&this.ih.fl&&(!this.ih.fl.length||!this.ih.fl[0].FieldInfoDataList))return;this.o5j(Ka)}Ka=Cb.asEnumerable(this.oIa);Ka=Cb.concat(Ka,this.b2h(this.Db.text));
this.tl&&(Ka=Cb.concat(Ka,this.h3h()));Cb.OBc(Ka,zb=>zb.name,new Vb.a);this.wUa&&(Ka=Cb.concat(Cb.asEnumerable(this.QPb),Ka),N.EwaSettings.isChangeGateEnabled("OfficeVSO:7041469_LogSuggestionsDismissalControl")?0<this.QPb.length?(this.fJ||this.formulaAssistanceTelemetryManager.gE(["autoCompleteSmartSuggestionActiveDismissing","autoCompleteSmartSuggestionAccepted"]),this.fJ=!0):this.fJ&&this.Gnf&&(this.tba=!0):0<this.QPb.length&&(this.fJ=!0),this.QPb=[]);this.fga=Cb.toArray(Ka)}Flh(){const Ka=this.gridView.am?
this.rxb.aKa:this.ysb.aKa;let zb=!0;""!==Ka&&(this.lj=Object(Aa.a)(Ae.a,this.$.Hb.getItemByName(Ka)));this.lj||(this.lj=this.tableManager.lj,zb=!1);this.lj?this.lj.UO&&this.lj.UO.IsFullTableHeaders?this.WQf(zb):Lb.d(this.lj)?(v.ULS.sendTraceTag(537162017,0,50,"FormulaAssistanceControl.CreateTableColHeaderAutoCompleteList - Getting column headers for table with xluid - %s"),Qb.q(this.$.pa.va,this.lj.sj,this.xFd,this.wFd,null,null)):v.ULS.sendTraceTag(537162018,0,15,"FormulaAssistanceControl.CreateTableColHeaderAutoCompleteList - Table with xluid %s has header rows turned off."):
v.ULS.sendTraceTag(527234895,0,50,"FormulaAssistanceControl.createTableColHeaderAutoCompleteList - current table object is null. Total number of named objects in workbook: %d. Is target table name empty? %d")}vKh(Ka){if(!Ka)return!1;let zb=Ka.charCodeAt(0);if(46===zb||48<=zb&&57>=zb||63===zb)return!0;for(let Yb=0;Yb<Ka.length;Yb++,zb=Ka.charCodeAt(Yb))if(!(Ha.a.isLetter(zb)||92===zb||95===zb||63===zb||48<=zb&&57>=zb))return!0;return!1}$Hd(Ka,zb){let Yb=!1,oc=!1;var Wc=!1,vd=0;let Dd=0;this.o5a=0;
this.idc=zb;this.C8b=1;for(let be=zb-1;0<=be;--be)switch(Ka.charCodeAt(be)){case 39:oc=!oc;break;case 34:Yb=!Yb;break;case 91:++vd;Wc=vd>Dd;break;case 93:++Dd}Wc=Object(kb.a)(new We,{vua:!Yb,wua:!oc,Uia:!Wc,kJb:1});vd=this.C9i(Ka,zb,Wc);zb=this.D9i(Ka,zb,Wc.vua,Wc.wua,Wc.Uia);this.C8b=vd+zb;if(this.oVc=vd-1)this.CBc=!1;this.kLh(Ka,Yb,oc,Wc.BHd,Wc.CHd)}yqd(){this.gridView.ga.t3(this.CCf);const Ka=Ca.a.EBb()?this.gridView.Ob(null):void 0;this.$Gb(Ka);Ca.a.kjc&&this.gridView.Ih.D_a(this.l7);ze.mRd(this.pluginScheduler);
this.wUa&&this.W7g()}NJh(){return this.wUa||this.qZe}E9i(){var Ka=this.y6;if(!this.nMj||!Ka)return this.KZ=0,this.oIa=this.fga=null,!1;Ka=Ka.endsWith(Fa.a.YU);let zb;if(N.EwaSettings.ya(128)&&({sheetRange:zb}=this.A2j(this.y6.substring(0,this.D4))).returnValue){const Yb=this.y6.substring(0,this.KZ);if(Ka&&Yb!==this.zwd)return this.zwd=Yb,this.KZ=this.y6.length-(Ka?1:0),this.d_(zb,this.y6),this.fka=!1,v.ULS.sendTraceTag(537162015,0,50,"Begin dot notation autocomplete"),!0}return!1}b2h(Ka){const zb=
new Ib.a;this.calcManager&&N.EwaSettings.isChangeGateEnabled("OfficeVSO:4986015_LetAutocompleteTelemetry")&&v.ULS.shipAssertTag(537162014,0,!!this.calcManager.Ltb(xa.Range.Lc(1,1)),"FormulaAssistanceControl.GetLetVariables() - ConvertToSheetGridCell() is null");if(this.calcManager&&this.qZe&&(Ka=this.calcManager.extractLetVariables(Ka,this.Db.textBox.caretPosition)))for(const Yb of Ka){Ka=new ie;Ka._name=Yb;Ka.E$=z.a.instance.ha(2219);const oc=new bc;oc.OFj(Ka);zb.add(oc)}return zb}h3h(){const Ka=
new Ib.a,zb=this.$.Hb.items;for(let oc=0,Wc=zb.length;oc<Wc;oc++){var Yb=zb[oc];if(!rb.n(Yb))continue;const vd=new zc;vd._name=Yb.name;Yb=new bc;Yb.eIj(vd);Ka.add(Yb)}return Ka}rub(Ka){const zb=new bc,Yb=new Sc;Yb._name=Ka;zb.fIj(Yb);return zb}WQf(Ka){const zb=new Ib.a,Yb=this.Db.textBox.caretPosition-1;if(91===this.Db.text.charCodeAt(Yb)){var oc=this.rub("@ - "+this.instantaneousSupportInformationManager.Ve.ThisRowStructRefString);zb.add(oc)}for(var Wc of this.lj.UO.HeadersList){oc=new bc;const vd=
new we;vd._name=Wc.Name;oc.dIj(vd);zb.add(oc)}Wc=this.gridView.am?this.rxb.AQ:this.ysb.AQ;oc=this.Db.text.charCodeAt(Wc+1);!Ka||Yb!==Wc&&35!==oc||(Ka=this.rub("#"+this.instantaneousSupportInformationManager.Ve.AllStructRefString),zb.add(Ka),Ka=this.rub("#"+this.instantaneousSupportInformationManager.Ve.DataStructRefString),zb.add(Ka),Ka=this.rub("#"+this.instantaneousSupportInformationManager.Ve.HeadersStructRefString),zb.add(Ka),Ka=this.rub("#"+this.instantaneousSupportInformationManager.Ve.TotalsStructRefString),
zb.add(Ka));zb&&(this.fga=zb.toArray())}o5j(Ka){let zb=Cb.empty();!Ka&&this.functionInfoManager.aW&&(zb=Cb.concat(zb,Cb.select(Cb.asEnumerable(this.functionInfoManager.hdc),Yb=>{const oc=new bc;oc.L8f(Yb);return oc})),Ka=this.p9b.UNe,0<Ka.length&&(zb=Cb.OBc(Cb.concat(zb,Cb.select(Cb.asEnumerable(Ka),Yb=>{const oc=new bc;oc.hEj(Yb);return oc})),Yb=>Yb.name,new Vb.a)));if(this.ih.w8a&&this.ih.fl){if(!this.ih.fl.length||!this.ih.fl[0].FieldInfoDataList)return;zb=Cb.OBc(Cb.concat(zb,Cb.select(Cb.asEnumerable(this.ih.fl[0].FieldInfoDataList),
Yb=>{const oc=new bc;oc.FEj(Yb);return oc})),Yb=>Yb.name,new Vb.a);this.columnName=this.ih.fl[0].ColumnName}this.oIa=Cb.toArray(zb)}$Gb(Ka){var zb;const Yb=this.gridView.ga.qa.activeCell;if(Yb){var oc=this.calcManager.Ltb(Yb,!1);if(oc){var Wc=this.$.ua,vd=oc.sheet.index;0>=Wc.count||0>vd||vd>=Wc.count?v.ULS.sendTraceTag(512278611,0,50,`FormulaAssistanceControl.NotifyActiveCellChanged invalid sheet index. ewaSheetsCount = ${Wc.count}, currentSheetIndex = ${vd}.`):(vd=Wc=null,this.sDd&&void 0!==this.calcManager&&
null!==this.calcManager&&(Ka=null!==(zb=null===Ka||void 0===Ka?void 0:Ka.cell)&&void 0!==zb?zb:this.gridView.Ca.rs(Yb))&&(zb=this.calcManager.okd(Ka.si),void 0!==zb&&null!==zb&&(Wc=zb.FormatString,vd=zb.Builtin)),this.pluginScheduler.notifier().setActiveCell({colIndex:oc.range.col,rowIndex:oc.range.row,sheetIndex:this.$.ua.getItem(oc.sheet.index).sheetId,docName:oc.sheet.document.name,docPath:oc.sheet.document.path,formatString:Wc,builtIn:vd}),v.ULS.sendTraceTag(512278610,0,50,`FormulaAssistanceControl.NotifyActiveCellChanged sent notification to the scheduler. col: ${oc.range.col}, row: ${oc.range.row}`))}else v.ULS.sendTraceTag(512278612,
0,50,"FormulaAssistanceControl.NotifyActiveCellChanged ISheetGridCell location is null")}else v.ULS.sendTraceTag(512278613,0,50,"FormulaAssistanceControl.NotifyActiveCellChanged activeCell range is null")}J4f(){this.formulaAssistanceTelemetryManager.PF={Hk:this.gridView.ga.qa.activeCell,r5b:this.gridView.hc.text,u2a:!0};this.formulaAssistanceTelemetryManager.PEb=this.$.ea.Ee;this.formulaAssistanceTelemetryManager.snc=this.$.ua.na.sheetId;this.$.userOperationManager.tr(this.GQa)}W7g(){this.gridView.am?
this.rxb.jZ(!1):this.ysb.jZ(!1)}Hqf(Ka){let zb=Ha.a.isLetter(Ka);return 48<=Ka&&57>=Ka||46===Ka||95===Ka||zb}show(){if(this.Ar){var Ka=this.kh.jog(0);this.tl?0<this.kh.Sq.length?(this.formulaAssistanceTelemetryManager.G0f(this.kh.stb),Ka||this.idg()):this.H3a():((Ka=0<this.kh.Sq.length)&&this.formulaAssistanceTelemetryManager.gE(["autoCompleteRender"]),!this.Ae&&this.columnName&&Ka&&this.kh.Rgj(this.kh.Sq.length,this.columnName),this.Ae=Ka,this.yka.show(this.zQ),this.uDa(!0),this.kh.Fza(),Ka&&this.formulaAssistanceTelemetryManager.Hv(["autoCompleteRender"]))}}D9i(Ka,
zb,Yb,oc,Wc){for(Yb=Object(kb.a)(new We,{pOf:41,gGe:40,vua:Yb,wua:oc,Uia:Wc});zb<Ka.length&&!this.rPf(Ka,zb,Yb);++zb);return Yb.kJb}C9i(Ka,zb,Yb){for(--zb;0<=zb&&!this.rPf(Ka,zb,Yb);--zb);return Yb.kJb}rPf(Ka,zb,Yb){const oc=Ka.charCodeAt(zb);0>=this.D4&&(this.D4=Ka.substring(0,zb).lastIndexOf(Fa.a.YU));46===oc&&(zb<this.D4?this.D4=zb:zb>this.yvb&&(this.KZ=this.yvb=zb));if(!this.Hqf(oc)&&!ze.ZBi(oc)&&(!this.Lla||zb<=this.D4||!ze.vji(oc,Yb))){Yb.WEf&&(Yb.WEf=!1,this.o5a=zb+1);if(Yb.dGd){Yb.CHd=zb+
1;if(this.functionInfoManager.ujd(Ka.substring(Yb.CHd,Yb.BHd)))return!0;Yb.dGd=!1}switch(oc){case 39:Yb.wua=!Yb.wua;break;case 34:Yb.vua=!Yb.vua;break;case 91:Yb.Uia=!1;break;case 93:Yb.Uia=!0}oc===this.$.listSeparator.toString().charCodeAt(0)&&Yb.wua&&Yb.vua&&!Yb.c2a&&(!this.Lla||Yb.Uia)&&(zb<Yb.$Rd||-1===Yb.$Rd)&&(Yb.kJb+=1,this.C8b++);oc===Yb.gGe&&Yb.vua&&Yb.wua&&(!this.Lla||Yb.Uia)?Yb.c2a+=1:oc===Yb.pOf&&Yb.vua&&Yb.wua&&(!this.Lla||Yb.Uia)?0<Yb.c2a?--Yb.c2a:(Yb.$Rd=Yb.V_e,Yb.V_e=zb,0<zb&&this.Hqf(Ka.charCodeAt(zb-
1))&&(Yb.dGd=!0,Yb.BHd=zb)):this.Lla&&46===oc&&zb>this.D4&&(zb<this.D4?this.D4=zb:zb>this.yvb&&(this.KZ=this.yvb=zb))}return!1}kLh(Ka,zb,Yb,oc,Wc){this.idc>this.o5a&&0<=this.o5a?zb||Yb||(this.kW=Ka.substring(this.o5a,this.idc)):this.kW=null;oc!==Wc?(Ka=Ka.substring(Wc,oc),this.zQ&&Ha.a.equals(this.zQ.NameDataStrings,Ka,!0)||(this.CBc=!0),this.zQ=this.functionInfoManager.ujd(Ka)):(this.CBc=!1,this.zQ=null)}ugg(Ka){const zb=$get(n.lPf+"_"+n.jJb,this.domElement),Yb=$get(n.mPf+"_"+n.jJb,this.domElement);
Ka&&!this.fhc?(zb&&fa.a.instance.ta(Ua.a.click,zb,this.Tda),Yb&&fa.a.instance.ta(Ua.a.click,Yb,this.Tda),this.fhc=!0):this.fhc&&(zb&&fa.a.instance.Ba(Ua.a.click,zb,this.Tda),Yb&&fa.a.instance.Ba(Ua.a.click,Yb,this.Tda),this.fhc=!1)}A2j(Ka){let zb;zb=null;var Yb;if(({sheetName:oc,range:Yb}=hb.ab(Ka,this.$.ea.ua)).returnValue&&Yb){if(!oc){var oc=Object(Aa.a)(Ta.a,this.$.na);if(!oc)return{returnValue:!1,sheetRange:zb};oc=oc.name}zb=hb.v(Yb,this.$);zb.SheetName=oc;this.F$c=!1;return{returnValue:!0,sheetRange:zb}}return({sheetName:oc,
range:Yb}=this.p9b.k2j(Ka)).returnValue?(zb=hb.v(Yb,this.$),zb.SheetName=oc,this.F$c=!0,{returnValue:!0,sheetRange:zb}):{returnValue:!1,sheetRange:zb}}Dyc(Ka){Ka={content:Ka,isCellContentOnlyEqualDuringEdit:this.isCellContentOnlyEqualDuringEdit};this.kma?this.pluginScheduler.getRequester().runAuthoringExperiment(Ka,0):this.pluginScheduler.requester().runAuthoringExperiment(Ka)}Hpd(){if(1===this.kh.UW.length&&this.Ar.length){var Ka=this.Ar[this.kh.UW[0]];if(1===Ka.itemType){var zb=Ka.name;Ka=this.Db.text;
zb=zb.substring(Ka.length,zb.length);zb.length&&(this.Db.text=Ka+zb,this.Db.textBox.selectRange(Ka.length,this.Db.text.length))}}else v.ULS.shipAssertTag(537162007,0,!1,`InCellAutoComplete should only be called when there is 1 item (number of items: ${this.kh.UW.length})`)}Wnc(Ka,zb,Yb,oc){const Wc={};Wc.a=Ka;Wc.b=zb;Wc.c=Yb;Wc.d=oc;Ic.b().gf(38,Wc,!0)}qye(Ka,zb){if(!this.functionInfoManager.aW){if(Ka)if(this.$Hd(this.Db.text,this.Db.textBox.caretPosition),this.wUa||this.kW){const Yb={};Yb.Filter=
this.kW?this.kW.charAt(0).toString():"";Yb.FilterType=1;Yb.IncludeOneOfEachGroupUI=!1;this.functionInfoManager.NKa(Yb)}else this.get_visible()&&this.set_visible(!1);if(!zb)return}0<this.$.ub.$R||this.Db&&!this.Db.jb?this.set_visible(!1):Ka&&(this.$Hd(this.Db.text,this.Db.textBox.caretPosition),this.yka.update(this.zQ,this.C8b,this.oVc,this.CBc),this.y6=this.Db.text.substring(1,this.Db.textBox.caretPosition),this.D4=this.y6.indexOf(Fa.a.YU),this.KZ=this.y6.lastIndexOf(Fa.a.YU),this.E9i()?(Ka=new bc,
Ka.HGj(),this.oIa=this.fga=Ka=[Ka],this.kh.s7j(Ka),this.show()):((this.NJh()||this.oya())&&this.SJe(!1),0<this.KZ?this.kh.rLa(this.Ar,this.y6,!1,void 0,this.y6.lastIndexOf(Fa.a.YU),!1):this.kh.rLa(this.Ar,this.kW,!1,void 0,this.KZ,!1),this.show(),this.tl&&(this.kh.Sq.length||this.gridView.Ih.iL?this.yka.W9b():(this.yka.GPd(),this.tl&&this.H3a()))))}idg(){if(0<this.kh.Sq.length){this.formulaAssistanceTelemetryManager.gE(["autoCompleteRender"]);if(this.formulaAssistanceUIControl){const Ka={};Ka.zoomLevel=
ca(this.$);this.formulaAssistanceUIControl.updateContext(Ka);this.Uo=()=>{this.formulaAssistanceUIControl.renderAutoCompleteMenu(this.B3b,this.gridView.Ih.textBox.domElement,this.yec(),()=>{})};this.Uo();this.tl&&this.kh.Ylc&&this.raiseEvent(ze.ngd,null);this.vrd||this.kh.Ylc||this.raiseEvent("FormulaAutoCompleteShown");this.vrd=this.Tq.Qf=!0}this.formulaAssistanceTelemetryManager.Hv(["autoCompleteRender"]);N.EwaSettings.isChangeGateEnabled("OfficeVSO:7041469_LogSuggestionsDismissalControl")&&this.fJ&&
this.Gnf&&(this.tba=!0)}}Kyd(){this.rKa&&(this.formulaAssistanceTelemetryManager.UJ.selectByArrowKeyCounter++,this.rKa=!1);this.sKa&&(this.formulaAssistanceTelemetryManager.UJ.selectByMouseHoverCounter++,this.sKa=!1);this.qKa&&(this.formulaAssistanceTelemetryManager.UJ.commitByTabKeyCounter++,this.qKa=!1);this.oKa&&(this.formulaAssistanceTelemetryManager.UJ.commitByEnterKeyCounter++,this.oKa=!1);this.pKa&&(this.formulaAssistanceTelemetryManager.UJ.commitByMouseClickCounter++,this.pKa=!1);N.EwaSettings.isChangeGateEnabled("OfficeVSO:7041469_LogSuggestionsDismissalControl")&&
this.Eja&&(this.formulaAssistanceTelemetryManager.UJ.dismissSmartSuggestionExplicitlyCounter++,this.Eja=!1)}yec(){const Ka=new oe;Ka.completionItems=this.kh.stb;Ka.activeItemIndex=this.kh.Tj?this.kh.Tj.rowIndex:-1;this.ZMd(Ka);return Ka}ZMd(Ka){Ka.callbacks=new Kd;Ka.callbacks.onCompletionItemSelected=this.QEd;Ka.callbacks.onCompletionItemCommitted=this.PEd;Ka.callbacks.onFeedback=this.kTa;Ka.callbacks.onDismiss=this.onDismiss;Ka.callbacks.onRestoreFocus=this.onRestoreFocus}MJd(Ka){this.Kga=!0;const zb=
Ka.textEdit.newText;this.Db.zpa(zb.substring(this.Db.text.length-Ka.textEdit.range.start.character,zb.length))}wHe(){N.EwaSettings.isChangeGateEnabled("OfficeVSO:7041469_LogSuggestionsDismissalControl")&&this.formulaAssistanceTelemetryManager.Hv(["autoCompleteSmartSuggestionAccepted"]);this.mz(!0);this.Kga=this.Ae=!1;this.xUa=this.Hpa=!0}Nqd(Ka,zb){this.Db.text=Ka.substring(0,zb.range.start.character)+zb.newText+Ka.substring(zb.range.end.character,Ka.length);this.gridView.am&&(this.gridView.hc.text=
this.Db.text)}static mRd(Ka){N.EwaSettings.isChangeGateEnabled("OfficeVSO:6409372_isGroupwisePluginOperationsUse")?Ka.getRequester().runExperiment(new Ce,0):Ka.requester().runExperiment(new Ce)}static Jdh(Ka){const zb=bc.qlh(),Yb={IsCompatibility:!1};Yb.NameDataStrings=Ka.label;Yb.Help=Ka.detail;zb.L8f(Yb);zb.textEdit=Ka.textEdit;return zb}static OLa(){const Ka=String.format(n.VPh,n.Igd,K.a.XUe),zb=String.format(n.RPh,n.Ggd,da.a.Rac,x.a.ms,x.a.Ho),Yb=String.format(n.NPh,n.Bgd,da.a.Rac,x.a.ms,da.a.JVe,
x.a.Ho);return`${Ka}
${zb}
${Yb}`}static ZBi(Ka){return 36===Ka||58===Ka||33===Ka||39===Ka||32===Ka}static vji(Ka,zb){return 32===Ka||91===Ka||!zb.Uia}}ze.ngd="FACardOpened";ze.Nfd="FAFocusOnSmartSuggestionsCard";ze.Lhc=null;Object(h.a)(ze,"FormulaAssistanceControl",Pb.a,[620,531,2,621,622]);class af{constructor(Ka){this.Gv=Ka;this.sB=this.UTa=this.Xi=!1;this.onKeyDown=zb=>this.sB||"Space"!==zb.code&&" "!==zb.key||!zb.altKey||!zb.ctrlKey?!1:(this.l4a(),zb.stopPropagation(),zb.preventDefault(),!0);this.Hma=zb=>{if(!this.sB)return!1;
if(zb.eventName===Ua.a.fc){const Yb=zb.Da.ctrlKey?1:zb.Da.shiftKey?50:10;switch(zb.Da.keyCode){case cc.a.Aqa:this.XK(0,-Yb);break;case cc.a.o9:this.XK(0,Yb);break;case cc.a.p9:this.XK(-Yb,0);break;case cc.a.GDa:this.XK(Yb,0);break;case cc.a.DG:case cc.a.Wh:this.UTa=!0;break;default:return!1}}zb.eventName===Ua.a.Vd&&this.UTa&&this.RM(!0);zb.Da.preventDefault();return!0};this.EAa=zb=>{if(!this.sB)return!1;zb.Da.preventDefault();this.RM();return!0};this.onBlur=()=>{if(!this.sB)return!1;this.RM();return!0};
this.Mo=$c.KeyInputManager.instance;this.pointerInputManager=Vd.a.instance}la(Ka){(this.root=Ka)&&!this.Xi&&(this.root.addEventListener("keydown",this.onKeyDown,!0),this.Xi=!0)}detach(){this.root&&this.Xi&&(this.root.addEventListener("keydown",this.onKeyDown,!0),this.Xi=!1)}l4a(){this.root&&(this.Gv.BIb("move",!0),this.root.focus(),this.sB=!0,this.UTa=!1,this.au(),this.Hza||this.fub(),this.root.appendChild(this.Hza))}RM(Ka=!1){this.sB&&(this.sB=!1,this.Gv.nrc(Ka),this.qLb(),this.gLb())}au(){this.Mo.capture(this.Hma,
null);this.pointerInputManager.Js(Ua.a.pointerDown,this.root,this.EAa,!0);this.root.addEventListener("blur",this.onBlur)}gLb(){this.Mo.releaseCapture();this.pointerInputManager.Us(Ua.a.pointerDown,this.root,this.EAa,!0);this.root.removeEventListener("blur",this.onBlur)}qLb(){var Ka;null===(Ka=this.Hza)||void 0===Ka?void 0:Ka.remove()}XK(Ka,zb){const Yb=this.Gv.getPosition();Yb.x+=Ka;Yb.y+=zb;this.Gv.setPosition(Yb)}fub(){this.Hza=rd.createClusteredImage(24,24,"ShapeQuadArrow_24x24x32","WACMoveArrowIcon",
!0,"")}}Object(h.a)(af,"FormulaAssistanceMoveAdapter",null,[]);class Za{constructor(Ka){this.Gv=Ka;this.startOffset={x:0,y:0};this.bfg=!0;this.Xi=!1;this.P0c=N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ChangeArgumentAssistanceDragCursorToMove",!1)}W5(){return this.Xi&&!!this.vD}cAa(Ka){this.P0c||(this.vD.style.cursor="grabbing");const zb=this.Gv.getPosition();this.bfg=zb.renderDown;this.startOffset.x=zb.x-Ka.clientPoint.x;this.startOffset.y=zb.y-Ka.clientPoint.y;this.Gv.BIb("drag");
return!0}Rda(Ka){this.Gv.setPosition({x:Ka.clientPoint.x+this.startOffset.x,y:Ka.clientPoint.y+this.startOffset.y,renderDown:this.bfg});return!0}Qda(){this.Kw()}Pda(){this.Kw()}la(Ka,zb){this.vD=zb;this.root=Ka;this.vD&&(this.vD.style.cursor=this.P0c?"move":"grab",ed.a.instance.cX(this.vD,this,!1),this.Xi=!0)}detach(){this.Xi&&this.vD&&(this.vD.style.cursor="",ed.a.instance.O1(this.vD,this),this.Xi=!1)}Kw(){this.P0c||(this.vD.style.cursor="grab")}}Object(h.a)(Za,"FormulaAssistanceDragAdapter",null,
[648]);class Rb{get getPosition(){return this.tBg}get setPosition(){return this.nme}constructor(Ka){this.formulaAssistanceTelemetryManager=Ka;this.Xi=!1;this.gIa=N.EwaSettings.isChangeGateEnabled("OfficeVSO:7376612_argumentAssistanceOrderedActionsTelemetry");this.U1={[rc.Drag]:0,[rc.Move]:0};this.wGb=new af(this);this.Avb=new Za(this)}la(Ka,zb,Yb,oc){this.tBg=Yb;this.nme=oc;this.wGb.la(Ka);this.Avb.la(Ka,zb);this.Xi=!0}detach(){this.Xi&&(this.Avb.detach(),this.wGb.detach(),this.Xi=!1)}clear(){var Ka;
null===(Ka=this.nme)||void 0===Ka?void 0:Ka.call(this,null);this.detach();this.lMb()}BIb(Ka,zb=!1){this.U1[Ka]++;zb&&(this.FRa=document.activeElement)}nrc(Ka=!0){this.FRa&&(Ka&&this.FRa.focus(),this.FRa=null)}lMb(){const Ka=this.formulaAssistanceTelemetryManager.XP,zb=this.U1[rc.Drag],Yb=this.U1[rc.Move];0<zb&&(this.formulaAssistanceTelemetryManager.MJ("d"),this.gIa||(Ka.argumentAssistanceDragTotalCounter+=zb),this.U1[rc.Drag]=0);0<Yb&&(this.formulaAssistanceTelemetryManager.MJ("m"),this.gIa||(Ka.argumentAssistanceMoveTotalCounter+=
Yb),this.U1[rc.Move]=0)}}Object(h.a)(Rb,"FormulaAssistanceDragControl",null,[]);var rc;(function(Ka){Ka.Drag="drag";Ka.Move="move"})(rc||(rc={}));Object(h.b)("FormulaAssistanceDragMode",rc);class Jc extends mb.a{constructor(Ka,zb,Yb){super(Jc.OLa());this.$=Ka;this.formulaAssistanceUIControl=zb;this.formulaAssistanceTelemetryManager=Yb;this.showCollapseText=this.isExpanded=!0;this.naa=0;this.Lma=this.Uo=this.Tq=null;this.sv=!1;this.setPosition=oc=>{this.formulaAssistanceUIControl.setFixedPosition(oc);
this.formulaAssistanceUIControl.updatePosition(0)};this.getPosition=()=>this.formulaAssistanceUIControl.getPosition();this.$c=()=>{this.visible=!1};this.onCardModeChange=oc=>{this.k2d(oc);this.showCollapseText=!1;1===oc?this.formulaAssistanceTelemetryManager.MJ("c"):this.formulaAssistanceTelemetryManager.MJ("e")};this.onIsExpandedChange=oc=>{this.g7j(oc);this.showCollapseText=!1;oc?this.formulaAssistanceTelemetryManager.MJ("e"):this.formulaAssistanceTelemetryManager.MJ("c")};this.kTa=oc=>{O(this.$,
"ArgumentAssistanceCard",oc.functionName);this.formulaAssistanceTelemetryManager.MJ("gf")};this.Vt=()=>{this.a6?this.formulaAssistanceUIControl.updatePosition(0):void 0!==this.Uo&&null!==this.Uo&&this.Uo()};this.Wf=()=>{this.a6?this.Gv.clear():this.Mad.clear()};this.a6=N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaAssistanceUiPosition",!1);this.VTd();this.Tq=new Qd(this.$,this.formulaAssistanceUIControl,0,pc.a.ggd);this.grid=Object(M.h)(Ka);this.grid.view.qt(this.Vt);this.grid.ga.IC(this.$c);
this.a6?this.Gv=new Rb(this.formulaAssistanceTelemetryManager):this.Mad=new Ed(this.formulaAssistanceUIControl,this.formulaAssistanceTelemetryManager);this.grid.cellTextEditBox.Bm(this.Wf);N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaAssistanceNoLayer",!1)&&this.$.domElement.appendChild(this.domElement)}vte(Ka){this.addHandler("FAFunctionNameUpdated",Ka)}d_f(Ka){this.removeHandler("FAFunctionNameUpdated",Ka)}mue(Ka){this.addHandler("FAParameterSelectionChangedOld",Ka)}C_f(Ka){this.removeHandler("FAParameterSelectionChangedOld",
Ka)}lue(Ka){this.addHandler("FAParameterSelectionChanged",Ka)}B_f(Ka){this.removeHandler("FAParameterSelectionChanged",Ka)}get visible(){return this.sv}set visible(Ka){Ka||this.dismiss();this.sv=Ka}dismiss(){this.sv=!1;this.formulaAssistanceUIControl&&(this.Uo=null,this.a6?this.Gv.detach():this.Mad.detach(),this.formulaAssistanceUIControl.dismiss(this.domElement),this.Lma=null,this.Tq.Qf=!1)}bRj(Ka,zb){this.sv=!0;const Yb=this.xuc(Ka);if(this.formulaAssistanceUIControl){this.formulaAssistanceTelemetryManager.gE(["argumentAssistanceRender"]);
Ka={};Ka.zoomLevel=ca(this.$);this.formulaAssistanceUIControl.updateContext(Ka);const oc=()=>{};N.EwaSettings.isChangeGateEnabled("OfficeVSO:5470368_FormulaAssistanceScroll")?(this.Uo=()=>{this.formulaAssistanceUIControl.renderArgumentAssistanceCard(this.domElement,zb,Yb,oc)},this.Uo()):this.formulaAssistanceUIControl.renderArgumentAssistanceCard(this.domElement,zb,Yb,oc);this.Fxc();this.Utc(Yb);this.Mad.la(this.formulaAssistanceUIControl.getCalloutElement(0),this.formulaAssistanceUIControl.getDraggableElement(0),
this.Uo,()=>this.formulaAssistanceUIControl.dismiss(this.domElement));this.Tq.Qf=!0;this.formulaAssistanceTelemetryManager.Hv(["argumentAssistanceRender"]);this.formulaAssistanceTelemetryManager.Cva("argumentAssistanceOverall")}}show(Ka,zb){this.a6?this.cRj(Ka):this.bRj(Ka,zb)}cRj(Ka){this.sv=!0;const zb=this.xuc(Ka);if(this.formulaAssistanceUIControl){this.formulaAssistanceTelemetryManager.gE(["argumentAssistanceRender"]);const Yb=()=>c(this.$);this.Uo=()=>{this.formulaAssistanceUIControl.renderArgumentAssistanceCard(this.domElement,
void 0,zb,Yb)};this.Uo();this.Fxc();this.Utc(zb);this.Gv.la(this.formulaAssistanceUIControl.getCalloutElement(0),this.formulaAssistanceUIControl.getDraggableElement(0),this.getPosition,this.setPosition);this.Tq.Qf=!0;this.formulaAssistanceTelemetryManager.Hv(["argumentAssistanceRender"]);this.formulaAssistanceTelemetryManager.Cva("argumentAssistanceOverall")}}dispose(){this.$&&this.grid&&(this.grid.ga&&this.grid.ga.UB(this.$c),this.grid.view.hr(this.Vt),this.grid.cellTextEditBox.km(this.Wf));Oa.a.Ja(this.Tq);
this.$=null}xuc(Ka){const zb=new me;zb.functionRenderingInfo=Ka;zb.showCollapseText=this.showCollapseText;this.a6?zb.isExpanded=this.isExpanded:zb.cardMode=this.naa;this.cNd(zb);return zb}cNd(Ka){Ka.callbacks=new Ie;Ka.callbacks.onHelpLink=this.Ejd(Ka.functionRenderingInfo);this.a6?Ka.callbacks.onIsExpandedChange=this.onIsExpandedChange:Ka.callbacks.onCardModeChange=this.onCardModeChange;Ka.callbacks.onFeedback=this.kTa}Ejd(Ka){return()=>{I(this.$,Ka.helpID,Ka.isUDF)}}VTd(){const Ka=Nb.a.get(F.a.Uqb);
this.a6?(Ka?(this.isExpanded="false"!==Ka,this.showCollapseText=!1):(this.isExpanded=Jc.moh,this.formulaAssistanceTelemetryManager.s7f()),this.formulaAssistanceTelemetryManager.eDj(this.isExpanded)):(Ka?(this.naa=parseInt(Ka,10),this.showCollapseText=!1):(this.naa=Jc.w$c,this.formulaAssistanceTelemetryManager.s7f()),this.formulaAssistanceTelemetryManager.t7f(this.naa))}Utc(Ka){var zb=Ka.functionRenderingInfo.functionName;this.Lma&&Ha.a.equals(this.Lma,zb,!0)?(zb=Ra.a.map(Ka.functionRenderingInfo.signatures,
Yb=>{let oc="";0<=Yb.signatureParams.activeParam&&Yb.signatureParams.activeParam<Yb.signatureParams.params.length&&(oc=Yb.signatureParams.params[Yb.signatureParams.activeParam]);return oc}),this.raiseEvent("FAParameterSelectionChanged",new lb(zb))):(this.Lma=zb,Ka=Ra.a.map(Ka.functionRenderingInfo.signatures,Yb=>Yb.signatureParams.params.join(", ")),this.raiseEvent("FAFunctionNameUpdated",new gb(zb,Ka)))}k2d(Ka){this.naa=Ka;try{Nb.a.Qs(F.a.Uqb,Ka.toString(),ob.AFrame.hP)}catch(zb){v.ULS.sendTraceTag(537162074,
0,15,`Failed setting ArgumentAssistanceCardCollapseState cookie with error message: ${zb.message}`)}}g7j(Ka){this.isExpanded=Ka;try{Nb.a.Qs(F.a.Uqb,Ka.toString(),ob.AFrame.hP)}catch(zb){v.ULS.sendTraceTag(512267714,0,15,`Failed setting ArgumentAssistanceCardCollapseState cookie with error message: ${zb.message}`)}}static OLa(){return document.createElement("div")}Fxc(){const Ka=this.getPosition().renderDown?"rd":"ru";this.formulaAssistanceTelemetryManager.MJ(Ka)}}Jc.w$c=0;Jc.moh=!0;Object(h.a)(Jc,
"FormulaArgumentAssistanceControl",mb.a,[633]);var Sb;(function(Ka){Ka[Ka.Dismissed=0]="Dismissed";Ka[Ka.Smart=1]="Smart";Ka[Ka.Simple=2]="Simple";Ka[Ka.Mixed=3]="Mixed"})(Sb||(Sb={}));Object(h.b)("UIState",Sb);class Cc extends mb.a{constructor(Ka,zb,Yb){super(Cc.OLa());this.$=Ka;this.formulaAssistanceUIControl=zb;this.formulaAssistanceTelemetryManager=Yb;this.Tq=this.clearContentNotifier=this.Db=this.gridView=null;this.tba=this.Eja=this.pKa=this.oKa=this.qKa=this.sKa=this.rKa=!1;this.Ar=null;this.sX=
0;this.Uo=null;this.xUa=this.Hpa=this.fJ=this.Kga=this.sv=!1;this.ARb=Sb.Dismissed;this.onRestoreFocus=()=>{};this.dismiss=()=>{this.sv=!1;this.K8a&&this.fJ&&this.fOa&&(this.tba=!0);this.Kyd();this.CD&&this.Db.jb&&this.woa();this.Uo=null;this.formulaAssistanceUIControl&&(this.formulaAssistanceUIControl.dismiss(this.domElement),this.Tq.Qf=!1,this.ARb=Sb.Dismissed)};this.Qmd=()=>{this.raiseEvent("FAFocusOnSmartSuggestionsCard",null)};this.FEd=()=>{var oc;const Wc=this.gridView.ga.qa.selectedRanges,
vd=null===(oc=this.formulaAssistanceTelemetryManager.PF)||void 0===oc?void 0:oc.Hk;Wc.some(Dd=>Dd.contains(vd))&&this.formulaAssistanceTelemetryManager.Gxd++};this.Yda=(oc,Wc)=>{0==Wc.er&&(170==Wc.Of.operation.operationName&&this.formulaAssistanceTelemetryManager.REb++,this.$.userOperationManager.ro(this.Yda),this.wlc&&this.clearContentNotifier&&this.clearContentNotifier.YNd(this.FEd))};this.GQa=(oc,Wc)=>{0==Wc.er&&(12==Wc.Of.operation.operationName&&this.$.userOperationManager.tr(this.Yda),this.$.userOperationManager.ro(this.GQa))};
this.SWi=()=>{this.dismiss();this.gridView.Ih.textBox.focus()};this.kTa=()=>{const oc={};oc[F.a.AH]=this.ZNf?"SmartSuggestionsCard":this.hYd?"FunctionAndSmartSuggestionsCard":"SimpleAutoCompleteCard";this.$.Xc(802602464,0,8,oc)};this.Wf=()=>{N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartSuggestionSurvey",!1)&&1===this.formulaAssistanceTelemetryManager.pD.smartSuggestionShownCounter&&this.fJ&&this.$.Xc(1073817162,-1,0,null);this.fOa&&this.vUg()};this.QEd=(oc,Wc)=>{this.cib(Wc);this.sKa=
!0};this.$c=()=>{this.visible=!1};this.PEd=oc=>{this.pKa=!0;this.ntb(oc)};this.Fj=()=>{this.dismiss()};this.Vt=()=>{this.a6?this.formulaAssistanceUIControl.updatePosition(1):void 0!==this.Uo&&null!==this.Uo&&this.Uo()};this.gridView=M.h(this.$);this.Tq=new Qd(this.$,this.formulaAssistanceUIControl,1,pc.a.hgd,this.Qmd);this.gridView.view.qt(this.Vt);this.gridView.ga.IC(this.$c);this.$.ua.kg(this.Fj);this.fOa=N.EwaSettings.isChangeGateEnabled("OfficeVSO:5523443_FormulaSuggestionsCardUserInteractionTelemetry");
this.a6=N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaAssistanceRedesign",!1)&&N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaAssistanceUiPosition",!1);this.K8a=N.EwaSettings.isChangeGateEnabled("OfficeVSO:6650011_LogSuggestionsDismissal");(this.wlc=N.EwaSettings.isChangeGateEnabled("OfficeVSO:7629619_RefiningKeptTelemetry"))&&this.$.da.kb(313,oc=>{this.clearContentNotifier=oc});this.fOa&&this.gridView.cellTextEditBox.Bm(this.Wf);N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaAssistanceNoLayer",
!1)&&this.$.domElement.appendChild(this.domElement)}tte(Ka){this.addHandler("FACardOpened",Ka)}c_f(Ka){this.removeHandler("FACardOpened",Ka)}pte(Ka){this.addHandler("FAFocusOnSmartSuggestionsCard",Ka)}ZZf(Ka){this.removeHandler("FAFocusOnSmartSuggestionsCard",Ka)}ste(Ka){this.addHandler("FormulaAutoCompleteShown",Ka)}b_f(Ka){this.removeHandler("FormulaAutoCompleteShown",Ka)}s_c(Ka){this.addHandler("SelectedRowChanged",Ka)}DOd(Ka){this.removeHandler("SelectedRowChanged",Ka)}H1b(Ka){this.addHandler("ListBoxUpdated",
Ka)}Swc(Ka){this.removeHandler("ListBoxUpdated",Ka)}dispose(){this.$&&(this.$.userOperationManager.ro(this.Yda),this.$.userOperationManager.ro(this.GQa),this.gridView&&(this.gridView.ga&&this.gridView.ga.UB(this.$c),this.gridView.cellTextEditBox&&this.fOa&&this.gridView.cellTextEditBox.km(this.Wf),this.gridView.view.hr(this.Vt)),this.$.ua&&this.$.ua.Gg(this.Fj));this.wlc&&this.clearContentNotifier&&this.clearContentNotifier.YNd(this.FEd);Oa.a.Ja(this.Tq);this.$=null}mQg(Ka){this.addHandler("CVIC",
Ka)}lpj(Ka){this.removeHandler("CVIC",Ka)}get visible(){return this.sv}set visible(Ka){Ka||this.dismiss();this.sv=Ka}get CD(){return this.Kga}get hYd(){var Ka,zb;return 1===(null===(zb=null===(Ka=this.Ar)||void 0===Ka?void 0:Ka.items[0])||void 0===zb?void 0:zb.type)}get ZNf(){return 1===this.Ar.items.length&&this.hYd}ai(Ka,zb){if(!this.visible)return!1;this.ZFc(zb);let Yb;return(Yb=this.Gei(zb)).Jgc?Yb.result:this.OLj(zb)}Fzb(Ka){if(!this.visible)return!1;let zb=!1;switch(Ka){case 1872288872:this.CD&&
this.woa();this.K8a&&this.hYd&&(this.formulaAssistanceTelemetryManager.Hv(["autoCompleteSmartSuggestionActiveDismissing"]),this.Eja=!0);this.visible=!1;zb=!0;break;case -798660877:this.cib(this.ozb(this.sX+1));zb=!0;break;case 137938150:this.cib(this.ozb(this.sX-1));zb=!0;break;case 2091832999:this.cib(this.ozb(this.sX+8));zb=!0;break;case 742457698:this.cib(this.ozb(this.sX-8));zb=!0;break;case 125627505:case 267796030:this.ntb(this.Ar.items[this.sX]),zb=!0}return zb}show(Ka){this.Db=this.gridView.Ih;
this.sv=!0;this.sX=0;this.Ar=Ka;0<this.Ar.items.length&&(this.render(),this.cib(this.ozb(this.sX)),this.K8a?this.fOa&&(1===this.Ar.items[0].type?(this.fJ||this.formulaAssistanceTelemetryManager.gE(["autoCompleteSmartSuggestionActiveDismissing","autoCompleteSmartSuggestionAccepted"]),this.fJ=!0):this.fJ&&(this.tba=!0)):1===this.Ar.items[0].type&&this.fOa&&(this.fJ=!0));this.formulaAssistanceTelemetryManager.G0f(Ka.items)}woa(){this.Kga=!1;this.Db.zPe()}OLj(Ka){return[1872288872,-798660877,137938150,
2091832999,742457698,125627505,267796030].includes(Ka)}Gei(Ka){return this.CD?125627505===Ka||267796030===Ka?(this.ntb(this.Ar.items[this.sX]),{Jgc:!0,result:!1}):!this.ZNf||-798660877!==Ka&&137938150!==Ka?{Jgc:!1}:{Jgc:!0,result:!1}:{Jgc:!1}}render(){this.formulaAssistanceTelemetryManager.gE(["autoCompleteRender"]);if(this.formulaAssistanceUIControl){if(this.a6){const Ka=()=>c(this.$);this.Uo=()=>{this.formulaAssistanceUIControl.renderAutoCompleteMenu(this.domElement,void 0,this.yec(),Ka)}}else{const Ka=
{};Ka.zoomLevel=ca(this.$);this.formulaAssistanceUIControl.updateContext(Ka);this.Uo=()=>{this.formulaAssistanceUIControl.renderAutoCompleteMenu(this.domElement,this.Db.textBox.domElement,this.yec(),()=>{})}}this.Uo();this.Ggj();this.Tq.Qf=!0;this.xwh()}}xwh(){this.formulaAssistanceTelemetryManager.Hv(["autoCompleteRender"]);this.formulaAssistanceTelemetryManager.Cva("autoCompleteOverall");const Ka=this.Ar.items.some(Yb=>1===Yb.type),zb=this.Ar.items.some(Yb=>0===Yb.type);Ka&&zb?this.formulaAssistanceTelemetryManager.Cva("autoCompleteOverallSimpleAndSmart"):
Ka?this.formulaAssistanceTelemetryManager.Cva("autoCompleteOverallSmartOnly"):zb&&this.formulaAssistanceTelemetryManager.Cva("autoCompleteOverallSimpleOnly")}Ggj(){const Ka=this.ARb;this.ARb=this.T$h(this.Ar.items);Ka!==Sb.Dismissed&&Ka!==Sb.Smart||this.ARb!==Sb.Simple&&this.ARb!==Sb.Mixed||this.raiseEvent("FormulaAutoCompleteShown")}ohj(){var Ka;if(0!==this.Ar.items.length){var zb=0<=this.sX?this.sX:0,Yb=this.Ar.items[zb];Yb={nG:Yb.label,description:null!==(Ka=Yb.detail)&&void 0!==Ka?Ka:"",selectedIndex:zb+
1,length:this.Ar.items.length};this.raiseEvent("SelectedRowChanged",Yb)}}ntb(Ka){if(this.Db&&this.visible){var zb=Ka.textEdit;this.Nqd(this.Db.text,zb);this.Db.textBox.caretPosition=zb.range.start.character+zb.newText.length;this.CD&&(this.Kga=!1,this.fOa&&(this.K8a&&this.formulaAssistanceTelemetryManager.Hv(["autoCompleteSmartSuggestionAccepted"]),this.xUa=this.Hpa=!0),this.UFj(),this.gridView.Fba.j7f(),this.Db.endEdit(!0,"FormulaAutoCompleteControl.CommitAutoCompletion",0));this.visible=!1;this.raiseEvent("CVIC",
{shouldRequestAutocompleteOnCommit:Ka.shouldRequestAutocompleteOnCommit});this.formulaAssistanceTelemetryManager.F0f(Ka.kind)}}UFj(){this.formulaAssistanceTelemetryManager.PF={Hk:this.gridView.ga.qa.activeCell,r5b:this.gridView.hc.text,u2a:!0};this.formulaAssistanceTelemetryManager.snc=this.$.ua.na.sheetId;this.formulaAssistanceTelemetryManager.PEb=this.$.ea.Ee;this.$.userOperationManager.tr(this.GQa);this.wlc&&this.clearContentNotifier&&this.clearContentNotifier.Tse(this.FEd)}vUg(){this.K8a&&this.tba&&
!this.Eja&&!this.Hpa&&(this.formulaAssistanceTelemetryManager.UJ.dismissSmartSuggestionImplicitlyCounter++,this.tba=!1);this.fJ&&(this.formulaAssistanceTelemetryManager.pD.smartSuggestionShownCounter++,this.fJ=!1,Object(Qe.b)($e.a));this.Hpa&&(this.formulaAssistanceTelemetryManager.pD.smartSuggestionSelectedCounter++,this.Hpa=!1,Object(Qe.b)($e.c));this.xUa&&(this.formulaAssistanceTelemetryManager.pD.smartSuggestionCommittedCounter++,this.xUa=!1)}yec(){const Ka=new oe;Ka.completionItems=this.Ar.items;
Ka.activeItemIndex=this.sX;this.ZMd(Ka);return Ka}ZMd(Ka){Ka.callbacks=new Kd;Ka.callbacks.onCompletionItemSelected=this.QEd;Ka.callbacks.onCompletionItemCommitted=this.PEd;Ka.callbacks.onFeedback=this.kTa;Ka.callbacks.onDismiss=this.SWi;Ka.callbacks.onRestoreFocus=this.onRestoreFocus}MJd(Ka){this.Kga=!0;const zb=Ka.textEdit.newText;this.Db.zpa(zb.substring(this.Db.text.length-Ka.textEdit.range.start.character,zb.length))}cib(Ka){const zb=this.sX;this.sX=Ka;const Yb=this.Ar.items[Ka];this.CD&&this.woa();
zb!==Ka&&this.render();1===Yb.type&&N.EwaSettings.zb()&&!this.gridView.Ih.text.includes("\n")&&this.MJd(Yb);this.ohj()}ozb(Ka){return 0>Ka?0:Math.min(Ka,this.Ar.items.length-1)}Nqd(Ka,zb){this.Db.text=Ka.substring(0,zb.range.start.character)+zb.newText+Ka.substring(zb.range.end.character,Ka.length);this.gridView.am&&(this.gridView.hc.text=this.Db.text)}Kyd(){this.rKa&&(this.formulaAssistanceTelemetryManager.UJ.selectByArrowKeyCounter++,this.rKa=!1);this.sKa&&(this.formulaAssistanceTelemetryManager.UJ.selectByMouseHoverCounter++,
this.sKa=!1);this.qKa&&(this.formulaAssistanceTelemetryManager.UJ.commitByTabKeyCounter++,this.qKa=!1);this.oKa&&(this.formulaAssistanceTelemetryManager.UJ.commitByEnterKeyCounter++,this.oKa=!1);this.pKa&&(this.formulaAssistanceTelemetryManager.UJ.commitByMouseClickCounter++,this.pKa=!1);this.K8a&&this.Eja&&(this.formulaAssistanceTelemetryManager.UJ.dismissSmartSuggestionExplicitlyCounter++,this.Eja=!1)}ZFc(Ka){switch(Ka){case -798660877:case 137938150:case 2091832999:case 742457698:this.rKa=!0;break;
case 125627505:this.qKa=!0;break;case 267796030:this.oKa=!0}}static OLa(){return document.createElement("div")}T$h(Ka){return Ka.reduce((zb,Yb)=>zb|=0===Yb.type?Sb.Simple:Sb.Smart,Sb.Dismissed)}}Object(h.a)(Cc,"FormulaAutoCompleteControl",mb.a,[632,2,621]);class cd{constructor(Ka,zb){var Yb,oc;this.ih=Ka;this.$=zb;this.TDc=new Map;this.Kgb=null;this.dAa=()=>{this.Wbc.resolve(this.ih.fl);this.rlg()};this.SGf=()=>{this.Wbc.reject(null);this.rlg()};this.Wf=()=>{this.ih.oeb();this.exd=null;this.TDc.clear();
this.Jpe()};this.xFd=(Wc,vd)=>{if(vd!==this.Nsf)v.ULS.sendTraceTag(509678923,0,15,"onGetTableColHeadersSuccess called with a tableName different than the one saved for last request"),this.LCa.reject();else if(Object(mc.a)(Wc))this.LCa.reject();else{var Dd=Wc.Result;Object(ea.b)(Dd)&&0!==Dd.length?(this.TDc.set(vd,Dd),void this.LCa.resolve(Wc.Result)):this.LCa.reject()}};this.wFd=()=>{this.LCa.reject()};null===(oc=null===(Yb=M.h(this.$))||void 0===Yb?void 0:Yb.cellTextEditBox)||void 0===oc?void 0:
oc.Bm(this.Wf);this.wRj=N.EwaSettings.isChangeGateEnabled("OfficeVSO:6476169_skipGetFieldInfoListContextIfContextLoaded")}getRichValueFieldListContext(Ka,zb,Yb,oc){const Wc={Faa:Ka,uQe:zb};var vd;if(vd=Object(ea.b)(this.exd))vd=this.exd,vd=!(Wc.Faa.FirstRow===vd.Faa.FirstRow&&Wc.Faa.FirstColumn===vd.Faa.FirstColumn&&Wc.Faa.LastRow===vd.Faa.LastRow&&Wc.Faa.LastColumn===vd.Faa.LastColumn&&Wc.Faa.SheetName===vd.Faa.SheetName&&Wc.uQe===vd.uQe);vd&&this.ih.oeb();this.exd=Wc;this.wRj&&this.ih.w8a||this.ih.d_(Ka,
Yb,oc,zb);this.Wbc=new ea.a;this.ih.w8a?this.Wbc.resolve(this.ih.fl):this.ulj();return this.Wbc.promise}getTableColHeaders(Ka){if(this.Kgb&&3>=this.Kgb.status&&Ka===this.Nsf)return this.LCa.promise;this.LCa=new ea.a;if(this.TDc.has(Ka))this.LCa.resolve(this.TDc.get(Ka));else{this.Jpe();this.Nsf=Ka;const zb=this.$.Hb.getItemByName(Ka).sj;this.Kgb=Object(Qb.q)(this.$.pa.va,zb,Yb=>this.xFd(Yb,Ka),this.wFd,null,null)}return this.LCa.promise}dispose(){var Ka,zb;null===(zb=null===(Ka=M.h(this.$))||void 0===
Ka?void 0:Ka.cellTextEditBox)||void 0===zb?void 0:zb.km(this.Wf)}ulj(){this.ih.A1b(this.dAa);this.ih.XQg(this.SGf)}rlg(){this.ih.Mwc(this.dAa);this.ih.Rpj(this.SGf)}Jpe(){Object(ea.b)(this.Kgb)&&(Y.AFrameworkApplication.Od.gv(this.Kgb.xu),this.Kgb=null)}}Object(h.a)(cd,"ServerDataProvider",null,[631]);var Wd=a(331),je=a(591),Ee=a(353),Ue=a(953);class gf{constructor(Ka){this.IK=this.JK=this.JF=this.KF=!1;this.N_=Ka}}Object(h.a)(gf,"MarqueeRangeData",null,[]);class rf{constructor(Ka,zb,Yb,oc=!1){this.E_d=
Ka;this.OQb=zb;this.b9a=oc;Yb?(this.N_=Yb.N_,this.KF=Yb.KF,this.JF=Yb.JF,this.JK=Yb.JK,this.IK=Yb.IK):v.ULS.shipAssertTag(510255180,0,!1,"MarqueeMetadata.Ctor: rangeData is null")}}Object(h.a)(rf,"MarqueeMetadata",null,[]);const xf="rgba(95, 140, 237, {0});rgba(235, 94, 96, {0});rgba(141, 97, 194, {0});rgba(45, 150, 57, {0});rgba(191, 76, 145, {0});rgba(227, 130, 34, {0});rgba(55, 127, 158, {0})".split(";");class Vf{constructor(Ka,zb,Yb){this.$=Ka;this.pluginScheduler=zb;this.formulaAssistanceTelemetryManager=
Yb;this.UH=this.Jgb=!1;this.V0=null;this.EOa=N.EwaSettings.EOa();this.k7=()=>{this.UH=!1;this.V0=null};this.gridView=M.h(Ka);this.gridView.hc.Bm(this.k7);this.I9a=N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ParenthesesCoupling",!1);this.elg=N.EwaSettings.isChangeGateEnabled("OfficeVSO:7686593_checkPotentialFormulaBeforeX10HighlightingEnabled")}get coloredReferencesManager(){this.VWa||(this.VWa=this.$.da.Aa(281));return this.VWa}X2j(Ka,zb,Yb){return isNullOrUndefined(this.coloredReferencesManager)?
!1:this.coloredReferencesManager.Ehb(Ka,zb,Yb)}Ehb(Ka,zb,Yb){var oc;Ka.textBox.addEventLogRecord("FormulaHighlightsControl.TryUpdateFormulaHighlights");if(this.Jgb||Ka.CD)return!1;const Wc=isNullOrUndefined(zb)?Ka.text:zb;if(this.elg){if(!Ga.f(Wc))return this.N2d(Ka,Wc,Object(ea.b)(zb))}else if(1>=Wc.length)return this.N2d(Ka,Wc,Object(ea.b)(zb));Yb=this.dai(Ka,zb,Yb);Yb=null===(oc=this.$5a(Wc,Yb))||void 0===oc?void 0:oc.formulaHighlights;if(!Yb)return v.ULS.sendTraceTag(512349465,0,50,"FormulaHighlightsControl.tryUpdateFormulaHighlights: formulaHighlights is null (might be an invalid formula)"),
this.N2d(Ka,Wc,Object(ea.b)(zb));const {aYj:vd,Vhj:Dd,Thj:be,rMi:se}=this.F0h(Yb,Wc);this.MAc(Ka,vd,!!zb);zb=Ka.textBox.text;if(!Ha.a.equals(zb,Wc,!1))return v.ULS.shipAssertTag(38114182,0,!1,`FormulaHighlightsControl.UpdateColoredReferences: The text we created is different from the original text. Setting the original text back. currentTextLength [${zb.length}], updatedTextLength [${Wc.length}]`),zb=Ka.textBox.caretPosition,Ka.textBox.text=Wc,Ka.textBox.caretPosition=zb,!0;this.Iz(Dd,be,se);return this.UH=
!0}yGb(Ka,zb,Yb){if(!Ka||!zb||!Yb)return v.ULS.shipAssertTag(512349463,0,!!Ka,"FormulaHighlightsControl.MoveMarqueeRange: cellContentEditor is null"),v.ULS.shipAssertTag(512349462,0,!!zb,"FormulaHighlightsControl.MoveMarqueeRange: highlightState is null"),v.ULS.shipAssertTag(512349461,0,!!Yb,"FormulaHighlightsControl.MoveMarqueeRange: newRange is null"),!1;const oc=Object(Aa.a)(rf,zb.metadata);if(!oc)return v.ULS.shipAssertTag(512349460,0,!1,"FormulaHighlightsControl.MoveMarqueeRange: marqueeMetadata is null"),
!1;var Wc=oc.E_d,vd=oc.OQb,Dd=this.gridView.wb.xsd(Yb)?Yb.kyb(oc.JF,oc.KF):Yb.uMa(oc.JF,oc.KF,oc.IK,oc.JK);if(!Dd)return v.ULS.shipAssertTag(512349459,0,!1,"FormulaHighlightsControl.MoveMarqueeRange: newText is null"),!1;const be=vd.indexOf("!");-1!==be&&(Dd=vd.substring(0,be+1)+Dd);if(!Ka.textBox.changeTextInExistingTextPart(Wc,vd,Dd))return v.ULS.shipAssertTag(38926105,0,!1,"FormulaHighlightsControl.MoveMarqueeRange: failed to change the text part"),!1;oc.OQb=Dd;Wc=!0;for(vd=1;4>=vd;vd++)(Dd=M.h(this.$).Jb.rD(3,
vd,zb.BU))?(Dd.range=Yb,Dd.metadata=oc):(v.ULS.shipAssertTag(512349458,0,!1,"FormulaHighlightsControl.MoveMarqueeRange: highlightStateInPane is null"),Wc=!1);this.gridView.Jb.update(!1,!1);this.gridView.am&&(this.gridView.cellTextEditBox.textBox.text=Ka.text);this.gridView.cellTextEditBox.MRa(new Wd.a({eCb:!0}));return Wc}wwi(Ka){if(3!==Ka.Vq)return v.ULS.shipAssertTag(512349457,0,!1,"FormulaHighlightsControl.IsMarqueeHighlightDraggable: not HighlightDivIndex.Marquee."),!1;Ka=Object(Aa.a)(rf,Ka.metadata);
return Ka?Ka.N_&&!Ka.b9a:(v.ULS.shipAssertTag(512349456,0,!1,"FormulaHighlightsControl.IsMarqueeHighlightDraggable: marqueeMetadata is null."),!1)}ICa(Ka,zb){v.ULS.sendTraceTag(512349455,0,50,"FormulaHighlightsControl.SuspendResumeColoredReferences: "+(zb?"suspending":"resuming")+" colored references");zb&&this.UH&&(this.UH=!1,this.Iz(null,null),Ka.textBox.mFe());this.Jgb=zb}dispose(){this.gridView&&this.gridView.hc&&this.gridView.hc.km(this.k7)}AAb(Ka){this.formulaAssistanceTelemetryManager.gE(["highlightPreviewRanges"]);
var zb=this.$5a(Ka,Ue.a);if(isNullOrUndefined(zb))this.jjc&&this.Iz(null,null);else{var Yb=this.cla(),oc=[],Wc=new pb.a(!1),vd=[];zb=zb.formulaHighlights;for(const Dd of zb)if(zb=Dd.kind,0===zb||2===zb||1===zb)zb=hb.C(Dd.rangeInfo.sharedRange),Object(ea.b)(zb)&&(oc.push(new Ee.a(zb,Yb)),this.c_(zb,Wc,1),vd.push(new rf(Dd.span.start,Ka.substring(Dd.span.start,Dd.span.end),f(Dd),!0)));this.Iz(oc,Wc,vd);this.formulaAssistanceTelemetryManager.Hv(["highlightPreviewRanges"],!0)}}a7j(Ka,zb){Ka&&this.formulaAssistanceTelemetryManager.$cc.formulaHighlightsCounter++;
zb&&this.formulaAssistanceTelemetryManager.$cc.parenthesesCouplingCounter++}N2d(Ka,zb,Yb){this.elg&&!this.UH||this.Iz(null,null);if(this.UH){this.UH=!1;if(!this.EOa){const oc=Ka.textBox.caretPosition;Ka.textBox.setPlainText(zb);Ka.textBox.caretPosition=Math.min(oc,zb.length)}if(Yb)return!0}return!1}dai(Ka,zb,Yb){let oc=Yb;Object(ea.b)(zb)?Object(ea.b)(Yb)||(oc={index:zb.length,length:0}):oc=Ka.textBox.selection;return oc}$5a(Ka,zb){if(this.I9a&&this.Kyi({content:Ka,selection:zb}))return this.V0.result;
this.formulaAssistanceTelemetryManager.gE(["formulaHighlightsRequest"]);const Yb=this.pluginScheduler.syncRequester().formulaHighlighting({content:Ka,caretPosition:zb.index,selectionLength:zb.length});this.I9a&&(this.V0={content:Ka,selection:zb,result:Yb});this.formulaAssistanceTelemetryManager.Hv(["formulaHighlightsRequest"]);return Yb}c_(Ka,zb,Yb){let oc=zb.getItem(Ka.toString());oc||(oc=xf[zb.count%xf.length],zb.add(Ka.toString(),oc));return String.format(oc,Yb)}KE(Ka,zb,Yb,oc,Wc=null,vd=null){v.ULS.shipAssertTag(512349453,
0,Yb<=oc,"FormulaHighlightsControl.AddTextPart: startIndex cannot be larger than endIndex");Yb<oc&&(zb=zb.substring(Yb,oc),Ka.push(Object(kb.a)(new je.a,{text:zb,color:Wc,backgroundColor:vd})))}Iz(Ka,zb,Yb=null){Ka&&Ka.length?(v.ULS.sendTraceTag(512349452,0,50,"FormulaHighlightsControl.HighlightRanges: number of ranges to highlight: "+Ka.length),Ka.reverse(),Yb.reverse(),this.gridView.Jb.pA(Ka,[3],!0,(oc,Wc)=>{if(oc&&oc.range&&Wc){v.ULS.shipAssertTag(512349448,0,zb.nb(oc.range.toString()),`FormulaHighlightsControl.HighlightRanges: The range '${oc.range.toString()}' doesn't exist in the range to color dictionary`);
var vd=this.c_(oc.range,zb,.1),Dd=this.c_(oc.range,zb,1);this.$.frame&&this.$.frame.xD&&this.$.frame.xD.sN||(Wc.style.background=vd);Wc.style.borderColor=Dd;Yb&&(Wc.setAttribute(F.a.B7a,oc.BU.toString()),oc.metadata=Yb[oc.BU])}else v.ULS.shipAssertTag(512349451,0,!!oc,"FormulaHighlightsControl.HighlightRanges: state is null"),v.ULS.shipAssertTag(512349450,0,!!oc.range,"FormulaHighlightsControl.HighlightRanges: state.Range is null"),v.ULS.shipAssertTag(512349449,0,!!Wc,"FormulaHighlightsControl.HighlightRanges: div is null")})):
(Ka=this.$.Rb.Qc("UserAction","HideRangesHighlightsStopwatch"),this.gridView.Jb.ik([3]),this.gridView.Jb.CTa(new Ee.a(null,this.cla()),[3]),Ka.stop())}MAc(Ka,zb,Yb){const oc=Ka.textBox;oc.DF=!0;var Wc=oc.selection;const vd=Wc.index;Wc=vd+Wc.length;oc.setTextFromTextParts(zb);zb=oc.text.length;oc.selectRange(Math.min(vd,zb),Math.min(Wc,zb));Yb&&Ka.MRa(new Wd.a);oc.DF=!1}gfc(){return this.gridView.fr&&this.gridView.fr.bG?this.gridView.fr.bG:this.$.na}cla(){return this.gfc().sheetId}F0h(Ka,zb){const Yb=
[],oc=new pb.a(!1),Wc=[],vd=[],Dd=[];let be=!1;var se=!1;let Oe=0;const Me=this.cla();for(const Ia of Ka){this.KE(Wc,zb,Oe,Ia.span.start,null);switch(Ia.kind){case 0:case 1:case 2:Ka=hb.C(Ia.rangeInfo.sharedRange);if(isNullOrUndefined(Ka)){v.ULS.sendTraceTag(512349464,0,10,`FormulaHighlightsControl.tryUpdateFormulaHighlights: Received formula highlight with undefined range, HighlightKind:${Ia.kind.toString()}`);this.KE(Wc,zb,Ia.span.start,Ia.span.end,null);break}se=this.c_(Ka,oc,1);this.KE(Wc,zb,
Ia.span.start,Ia.span.end,se);Yb.push(new Ee.a(Ka,Me));vd.push({Start:Ia.span.start,End:Ia.span.end});se=Wc.length-1;Dd.push(new rf(se,Wc[se].text,f(Ia)));se=!0;break;case 3:this.KE(Wc,zb,Ia.span.start,Ia.span.end,null,"rgba(229, 229, 229, 1)"),be=!0}Oe=Ia.span.end}this.KE(Wc,zb,Oe,zb.length);this.a7j(se,be);return{aYj:Wc,Vhj:Yb,Thj:oc,rMi:Dd}}Kyi(Ka){return Object(ea.b)(this.V0)&&this.V0.content===Ka.content&&this.V0.selection.index===Ka.selection.index&&this.V0.selection.length===Ka.selection.length}}
Object(h.a)(Vf,"FormulaHighlightsControl",null,[630,2]);var Bb=a(149);class ac{constructor(Ka,zb,Yb,oc,Wc,vd,Dd){this.$=Ka;this.functionInfoManager=zb;this.calcManager=Yb;this.pluginScheduler=oc;this.formulaAssistanceUIControl=Wc;this.formulaAssistanceTelemetryManager=vd;this.ih=Dd;this.QNa=this.isCellContentOnlyEqualDuringEdit=!1;this.jda=null;this.Mma=-1;this.iea=0;this.kma=N.EwaSettings.isChangeGateEnabled("OfficeVSO:6409372_isGroupwisePluginOperationsUsed");this.tfd=N.EwaSettings.getBooleanFeatureGate("OfficeVSO:7135425_fixSetFunctionsInfoNotification",
!1);this.T2d=N.EwaSettings.isChangeGateEnabled("OfficeVSO:7262196_updateRequestCacheOnAutoCompleteCommit");this.npf=N.EwaSettings.isChangeGateEnabled("OfficeVSO:7395449_isSendingSchedulerWorkbookClosingNotificationEnabled");this.fAi=N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SkipNoFormulaBatchRequest",!1);this.Dc=(be,se)=>{se.Sf||se.vsd||this.pluginScheduler.notifier().notifyWorkbookClosing()};this.Vf=(be,se)=>{this.gridView.jb||this.gridView.ni||this.$Gb(null===se||void 0===se?void 0:
se.cell)};this.onFunctionInfoLoaded=()=>{this.tfd||this.functionInfoManager.Qdb(this.onFunctionInfoLoaded);this.gog();this.Qea()};this.lDf=(be,se)=>{var Oe=this.Db;be=Oe.text;Oe=Oe.textBox.caretPosition;0<this.iea&&this.formulaAssistanceTelemetryManager.UJ.commitWhileRequestPending++;this.formulaAssistanceTelemetryManager.gE(["argumentAssistanceComputation","argumentAssistanceOverall"]);se.shouldRequestAutocompleteOnCommit?this.s6f(be,Oe):this.GPd(be,Oe)};this.Wf=()=>{this.isCellContentOnlyEqualDuringEdit&&
(this.formulaAssistanceTelemetryManager.pD.isCellContentOnlyEqualDuringEditCounter++,this.isCellContentOnlyEqualDuringEdit=!1);this.QNa&&(this.formulaAssistanceTelemetryManager.pD.isCellContentFormulaCounter++,this.QNa=!1);N.EwaSettings.isChangeGateEnabled("OfficeVSO:6103891_dismissControlOnEditEnded")&&this.X9b()};this.l7=(be,se)=>{N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DetachRunMeasurements",!1)?Object(Bb.b)(()=>{this.Dyc(se.newValue)}):this.Dyc(se.newValue)};this.Pj=()=>{this.Zmg()};
this.Zmg=()=>{const be=this.p9b.UNe;this.pluginScheduler.notifier().setDefinedNamesInfo(be);v.ULS.sendTraceTag(512278605,0,50,`FormulaAssistanceManager.updateDefinedNamesList updated defined names info with ${null===be||void 0===be?void 0:be.length} names}`)};this.$5a=(be,se)=>{be=this.pluginScheduler.syncRequester().formulaHighlighting({content:be,caretPosition:null===se||void 0===se?void 0:se.index,selectionLength:null===se||void 0===se?void 0:se.length});if(isNullOrUndefined(be)||isNullOrUndefined(be.formulaHighlights))v.ULS.sendTraceTag(521211933,
0,10,`FormulaAssistanceManager.getFormulaHighlights: formulaHighlightingResult is null or undefined, formulaHighlights array is null:${!isNullOrUndefined(be)}`);else return be};this.functionInfoManager=zb;this.formulaAssistanceUIControl=Wc;this.pluginScheduler=oc;this.gridView=M.h(this.$);this.sDd=N.EwaSettings.isChangeGateEnabled("OfficeVSO:5656143_SendCellFormatOnCellChanged");this.p9b=new $a(Ka);this.gridView.Ca.vw(this.Pj);this.Zmg();this.KXa=new Jc(this.$,this.formulaAssistanceUIControl,this.formulaAssistanceTelemetryManager);
this.Z9=new Cc(this.$,this.formulaAssistanceUIControl,this.formulaAssistanceTelemetryManager);this.Oui=Ca.a.aI(Ka);this.rSj=Ca.a.Nca(Ka);this.nri=N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.AuthoringPerCharExp",!1);this.kAi=N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.x10AutocompleteWrapperPluginIsEnabled",!1);this.Oui&&(this.Kra=new Vf(this.$,this.pluginScheduler,this.formulaAssistanceTelemetryManager));Ka.da.Ha(464,this);this.calcManager=Yb;Ca.a.$V(this.$)&&this.yqd();
this.gridView.cellTextEditBox.Bm(this.Wf);this.tfd&&(this.functionInfoManager.EHa(this.onFunctionInfoLoaded),this.functionInfoManager.aW?this.gog():this.functionInfoManager.NKa({}))}get Aka(){return this.Z9}get o1e(){return this.KXa}get kB(){return this.Kra}get FJb(){return this.Db.ayi?1:0}get Db(){return this.gridView.Ih}get wb(){return this.gridView.wb}dispose(){if(this.$){const Ka=this.gridView;Ka&&(Ka.ga&&Ca.a.$V(this.$)&&Ka.ga.Iea(this.Vf),Ka.Ca&&Ka.Ca.sx(this.Pj));this.npf&&this.$.ll(this.Dc)}this.gridView.cellTextEditBox.km(this.Wf);
this.Z9.lpj(this.lDf);this.functionInfoManager&&this.functionInfoManager.Qdb(this.onFunctionInfoLoaded);Ca.a.kjc&&this.Db&&this.Db.CLb(this.l7);Oa.a.Ja(this.KXa);Oa.a.Ja(this.Z9);this.Z9=this.KXa=this.functionInfoManager=this.$=null}luj(){this.Mma=-1;this.jda=null}X9b(){this.Z9.visible=!1;this.KXa.visible=!1}ai(){this.Qea();return!1}Qea(){if(!this.Db.iL)if(this.formulaAssistanceTelemetryManager.srb.formulaAssistanceRequestAttemptedCounter++,this.FMj()){this.tfd||this.functionInfoManager.aW||(this.functionInfoManager.EHa(this.onFunctionInfoLoaded),
this.functionInfoManager.NKa({}));var Ka=this.Db,zb=Ka.text;Ka=Ka.textBox.caretPosition;zb.startsWith("=")&&(this.QNa=!0,1===zb.length&&(this.isCellContentOnlyEqualDuringEdit=!0));this.formulaAssistanceTelemetryManager.gE("argumentAssistanceComputation autoCompleteComputation argumentAssistanceOverall autoCompleteOverall autoCompleteOverallSmartOnly autoCompleteOverallSimpleOnly autoCompleteOverallSimpleAndSmart".split(" "));this.s6f(zb,Ka);this.nri&&this.Xtj(zb,Ka)}else this.formulaAssistanceTelemetryManager.srb.formulaAssistanceRequestOptimizedCounter++}s6f(Ka,
zb){let Yb;Yb=this.fAi&&!Ga.g(Ka)?Promise.resolve({kind:0,payload:{argumentAssistance:null,functionSuggestion:null,inCellSuggestion:null}}):this.pluginScheduler.batchRequester().functionSuggestionAndArgumentAssistance({functionSuggestion:{content:Ka,caretPosition:zb},argumentAssistance:{content:Ka,caretPosition:zb},inCellSuggestion:{content:Ka,caretPosition:zb}});this.iea+=1;this.T2d&&(this.jda=Ka,this.Mma=zb);Yb.then(oc=>{--this.iea;0===oc.kind&&(this.ccf(oc.payload.argumentAssistance),this.Gdi(oc.payload.functionSuggestion,
Ka));return null})}Xtj(Ka,zb){zb={content:Ka,caretPosition:zb,enableAutocompleteWrapperPlugin:this.kAi&&!this.rSj};this.kma&&(zb=this.pluginScheduler.getRequester().runPerCharacterExperiment(zb,this.FJb),this.iea+=1,zb.then(Yb=>{--this.iea;if(0===Yb.kind)for(const oc of Yb.payload.results)0===oc.kind&&this.gridView.Fba.ZTd(oc.value,Ka);return null}))}GPd(Ka,zb){const Yb={content:Ka,caretPosition:zb};this.T2d&&(this.jda=Ka,this.Mma=zb);Ka=this.kma?this.pluginScheduler.getRequester().argumentAssistance(Yb,
this.FJb):this.pluginScheduler.requester().argumentAssistance(Yb);this.iea+=1;Ka.then(oc=>{--this.iea;0===oc.kind&&this.ccf(oc.payload)})}FMj(){var Ka=this.Db;const zb=Ka.text;Ka=Ka.textBox.caretPosition;if(this.Z9.visible&&Ha.a.equals(zb,this.jda,!0)&&!Ga.e(zb)&&Ka===this.Mma)return!1;this.T2d||(this.jda=zb,this.Mma=Ka);return!0}mRd(){this.kma?this.pluginScheduler.getRequester().runExperiment(new Ce,this.FJb):this.pluginScheduler.requester().runExperiment(new Ce)}ccf(Ka){Ka&&this.Db.jb?(this.formulaAssistanceTelemetryManager.Hv(["argumentAssistanceComputation"]),
this.KXa.show(Ka,this.Db.textBox.domElement)):this.KXa.dismiss()}Gdi(Ka,zb){Ka&&0<Ka.items.length&&this.Db.jb&&this.Db.text===this.jda?this.wb.o6(this.gridView.ga.qa.activeCell)?(this.formulaAssistanceTelemetryManager.pD.smartSuggestionWouldSuggestInsidePivotCounter++,this.Z9.dismiss()):(this.formulaAssistanceTelemetryManager.Hv(["autoCompleteComputation"]),this.Z9.show(Ka)):this.Z9.dismiss();this.gridView.Fba.ZTd(Ka,zb)}Dyc(Ka){Ka={content:Ka,isCellContentOnlyEqualDuringEdit:this.isCellContentOnlyEqualDuringEdit};
this.kma?this.pluginScheduler.getRequester().runAuthoringExperiment(Ka,this.FJb):this.pluginScheduler.requester().runAuthoringExperiment(Ka)}$Gb(Ka){var zb;const Yb=this.gridView.ga.qa.activeCell;if(Yb){var oc=this.calcManager.Ltb(Yb,!1);if(oc){var Wc=this.$.ua,vd=oc.sheet.index;0>=Wc.count||0>vd||vd>=Wc.count?v.ULS.sendTraceTag(512278608,0,50,`FormulaAssistanceManager.NotifyActiveCellChanged invalid sheet index. ewaSheetsCount = ${Wc.count}, currentSheetIndex = ${vd}.`):(vd=Wc=null,this.sDd&&void 0!==
this.calcManager&&null!==this.calcManager&&(Ka=null!==(zb=null===Ka||void 0===Ka?void 0:Ka.cell)&&void 0!==zb?zb:this.gridView.Ca.rs(Yb))&&(zb=this.calcManager.okd(Ka.si),void 0!==zb&&null!==zb&&(Wc=zb.FormatString,vd=zb.Builtin)),this.pluginScheduler.notifier().setActiveCell({colIndex:oc.range.col,rowIndex:oc.range.row,sheetIndex:this.$.ua.getItem(oc.sheet.index).sheetId,docName:oc.sheet.document.name,docPath:oc.sheet.document.path,formatString:Wc,builtIn:vd}),v.ULS.sendTraceTag(512278607,0,50,`FormulaAssistanceManager.NotifyActiveCellChanged sent notification to the scheduler. col: ${oc.range.col}, row: ${oc.range.row}`))}else v.ULS.sendTraceTag(537162002,
0,50,"FormulaAssistanceManager.NotifyActiveCellChanged ISheetGridCell location is null")}else v.ULS.sendTraceTag(512278609,0,50,"FormulaAssistanceManager.NotifyActiveCellChanged activeCell range is null")}gog(){const Ka=this.functionInfoManager.hdc;this.pluginScheduler.notifier().setFunctionsInfo(Ka);v.ULS.sendTraceTag(512278606,0,50,`FormulaAssistanceManager.updateSchedulerFunctionList update functions info with ${null===Ka||void 0===Ka?void 0:Ka.length} functions}`)}yqd(){this.gridView.ga.t3(this.Vf);
const Ka=Ca.a.EBb()?this.gridView.Ob(null):void 0;this.$Gb(Ka);Ca.a.kjc&&this.Db.D_a(this.l7);this.mRd();this.Z9.mQg(this.lDf);this.pluginScheduler.setServerDataProvider(new cd(this.ih,this.$));this.Qea();this.npf&&this.$.wj(this.Dc)}Ehb(Ka,zb,Yb){Yb=Object(ea.b)(zb)?this.$5a(zb,Object(ea.b)(Yb)?Yb:Ue.a):this.$5a(Ka.text,Ka.textBox.selection);return this.Kra.X2j(Ka,zb,Yb)}}Object(h.a)(ac,"FormulaAssistanceManager",null,[617,2]);var tc=a(109);class ub extends jb.a{constructor(Ka){super();this.$=Ka;
this.Mb()}create(){const Ka=Ca.a.$V(this.$),zb=N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.LETAutocomplete",!1),Yb=Ca.a.ZV(this.$),oc=this.$.da,Wc=N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigrateTableManager",!1)?Object(tc.d)(G.a.resolve(H.db,{rb:this.Na})):l.GetServiceTaskFactory.create(oc,134,this.ka,this.Na),vd=Object(of.b)("OfficeVSO:7629428_MigrateSharedUIControlsFactoryService")?Object(tc.d)(G.a.resolve(H.X,{rb:this.Na})):l.GetServiceTaskFactory.Sa(this.$.da,
12,477,this.Na);let Dd;Dd=Ca.a.R5(this.$)?l.GetServiceTaskFactory.create(this.$.da,449,this.$.ka,1):nb.Task.Ua(null);let be;be=Ca.a.$V(this.$)?l.GetServiceTaskFactory.create(this.$.da,414,this.$.ka,1):nb.Task.Ua(null);let se;se=N.EwaSettings.isChangeGateEnabled("OfficeVSO:6296544_ReduceInnerHTMLUsage")&&!Yb?Object(tc.d)(G.a.resolve(H.F,{rb:this.Na})):nb.Task.Ua(null);if(zb||Ka){let Oe;Oe=N.EwaSettings.LF()?Object(tc.d)(G.a.resolve(H.g,{rb:this.Na})):l.GetServiceTaskFactory.Sa(oc,266,265,this.Na);
const Me=Object(of.b)("OfficeVSO:7624477_migratingFormulaAssistanceReadoutHandlerService")?Object(tc.d)(G.a.resolve(H.z,{rb:this.Na})):l.GetServiceTaskFactory.Sa(oc,219,220,this.Na),Ia=l.GetServiceTaskFactory.Sa(oc,491,492,this.Na);u.TaskExtensions.za(u.TaskExtensions.Pd([Oe,be,Dd,Me,Ia,se,Wc,vd],this.ka),()=>{const Jb=oc.Aa(19)||new pd(this.$,be.result),xc=Me.result;if(Yb){var Zc=oc.Aa(464);Zc||(Zc=new ac(this.$,Jb,Oe.result,be.result,Dd.result,Ia.result,vd.result.e8c(this.$,Wc.result)),xc.o1c(Zc.o1e),
xc.p1c(Zc.Aka),xc.q1c(Zc.Aka))}else Zc=oc.Aa(221),Zc||(Zc=new ze(this.$,Jb,Wc.result,Oe.result,null,vd.result,Dd.result,Ia.result,be.result,se.result),xc.o1c(Zc.p1e),xc.q1c(Zc.L1e),xc.p1c(Zc));this.vb(Jb)},this.ka,3)}else{const Oe=Object(of.b)("OfficeVSO:7624477_migratingFormulaAssistanceReadoutHandlerService")?Object(tc.d)(G.a.resolve(H.z,{rb:this.Na})):l.GetServiceTaskFactory.Sa(oc,219,220,this.Na),Me=l.GetServiceTaskFactory.Sa(oc,491,492,this.Na);u.TaskExtensions.za(u.TaskExtensions.Pd([Oe,Dd,
be,se,Wc,vd,Me],this.ka),()=>{const Ia=oc.Aa(19)||new pd(this.$,be.result),Jb=Oe.result;let xc=oc.Aa(221);xc||(xc=new ze(this.$,Ia,Wc.result,null,null,vd.result,Dd.result,Me.result,be.result,se.result),Jb.o1c(xc.p1e),Jb.q1c(xc.L1e),Jb.p1c(xc));this.vb(Ia)},this.ka,3)}}static la(Ka){Ka.da.Ha(153,new ub(Ka))}}Object(h.a)(ub,"FunctionInfoManagerFactory",jb.a,[]);a.d(C,"a",function(){return jc});const jc=()=>{d.a.Fa(Ka=>{va.la(Ka);Object(of.b)("OfficeVSO:7624477_migratingFormulaAssistanceReadoutHandlerService")||
Ea.la(Ka);ub.la(Ka)})};String(e);window.___1680633013101_closurehack=e},1212:function(t,C,a){function c(aa){return R.Range.Lc(aa.row+1,aa.col+1)}t={};a.r(t);a.d(t,"FormulaByExampleTriggersManager",function(){return ma});var b=a(10),f=a(0),e=a(14),d=a(718),h=a(53),r=a(39),l=a(1337),u=a(1),v=a(948),x=a(259),w=a(98);class m extends v.a{constructor(aa){super(aa,m.featureName)}static init(aa){m.Ma?e.ULS.sendTraceTag(509122372,1,15,"FormulaSuggestionUIControl.init: unexpected call after already being inited."):
m.Ma=new m(aa)}static instance(){return m.Ma}get je(){return x.a.w1e}show(aa,ia,ka,Xa,sb,ib=null,Ub=null){this.FWd(Ub,hc=>{appChrome.renderFormulaSuggestionCard(aa,ia,this.domElement,hc.y,hc.x,hc.y+hc.height,hc.x+hc.width,ka,Xa,sb,ib,this.rUd)})}r1(aa,ia,ka){u.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FBECurtainLifterCalloutForTestingOnlyEnabled",!1)&&(this.h3a&&aa.equals(this.$Di)||(this.h3a&&document.body.removeChild(this.h3a),this.$Di=aa,aa=this.grid.Ob(aa),aa=this.grid.getCellBounds(aa.cell,
!0),this.h3a=document.createElement("div"),this.h3a.setAttribute("style",`position:fixed;
        left: ${aa.x+aa.width}px;
        top: ${aa.y+aa.height/2}px`),document.body.appendChild(this.h3a)),aa=new w.a(-847286761,0,this.$.Bc,0,null),this.$.Ia.Nb(aa,{["CalloutName"]:15,["Target"]:this.h3a,["NewState"]:ia,["Reason"]:ka}))}}Object(f.a)(m,"FormulaByExampleCardUIControl",v.a,[618]);var n=a(109),z=a(41),y=a(157);class A extends d.a{constructor(aa){super(aa)}Fd(){e.ULS.sendTraceTag(528758224,0,50,"FormulaByExampleCommandHandlerFactory.CreateCommandHandlersAsync: FormulaByExampleCommandHandler init flow started.");const aa=
h.GetServiceTaskFactory.Sa(this.$.da,453,454,1);let ia;ia=u.EwaSettings.LF()?Object(n.d)(y.a.resolve(z.g,{rb:1})):h.GetServiceTaskFactory.Sa(this.$.da,266,265,1);r.TaskExtensions.za(r.TaskExtensions.Pd([aa,ia],this.ka),()=>{const ka=this.$.da.Aa(328);this.qd([new l.a(this.$,ka,ia.result,aa.result,m.instance())]);e.ULS.sendTraceTag(537161924,0,50,"FormulaByExampleCommandHandlerFactory.CreateCommandHandlersAsync: FormulaByExampleCommandHandler initialized successfully")},this.ka)}static la(aa){d.a.Yd(455,
new A(aa))}}Object(f.a)(A,"FormulaByExampleCommandHandlerFactory",d.a,[]);var F=a(60);v=a(228);var D=a(2),B=a(867),M=a(7),R=a(25),P=a(33),E=a(9);class H{constructor(aa,ia,ka){this.kind=aa;this.value=ia;this.formatted=ka}get displayText(){var aa;return null!==(aa=this.formatted)&&void 0!==aa?aa:this.value}}Object(f.a)(H,"CloneEvaluatedEdit",null,[]);class G{constructor(aa,ia=null,ka){this.status=aa;this.Ecd=ia;this.Luc=ka}}Object(f.a)(G,"FormulaByExampleFormulaEvalResult",null,[]);var N=a(23),I=a(21),
O=a(882),U=a(62),ca=a(297);class Q{constructor(aa,ia,ka,Xa){this.Qag=this.Xlf=this.ZB=!1;this.$=aa;this.calcManager=ia;this.ZB=Xa;this.eg=ka;this.fk=O.a.getInstance(this.$);this.gridView=I.h(this.$);this.Xlf=u.EwaSettings.isChangeGateEnabled("OfficeVSO:6327953_FormatOutputResultsOfFBE_V2");this.Qag=u.EwaSettings.isChangeGateEnabled("OfficeVSO:7549840_DontShowFBESuggestionsWithErrorInTriggerCell")}fFj(aa,ia,ka=null,Xa=!1,sb){ia=aa.range.ze(ia);return ia?this.ETe(aa,ia,ka).then(ib=>{this.ZB&&!Xa&&aa.flowId&&
Object(B.f)("CALCULATIONED",aa.flowId,sb);if(2===ib.status)return ib;e.ULS.sendTraceTag(537161881,0,50,"FormulaByExampleModelUpdater:setFormulaPreviewOnRangeModel: evalFormulaRangeOnClone CSE: Result received from calc.");return this.O6j(ib,Xa,aa.flowId,sb)}).catch(ib=>{Object(B.h)(aa,`failed to setFormulaPreviewOnRangeModel, error in calc API: ${ib.toString()}`,this.fk,8);return Promise.reject(`FormulaByExampleModelUpdater:setFormulaPreviewOnRangeModel: Unable to EvalFormulaRange, e: ${ib.toString()}`)}):
(Object(B.h)(aa,"Annotation range does not intersect loaded range",this.fk,6),Promise.reject("FormulaByExampleModelUpdater:setFormulaPreviewOnRangeModel: Annotation range does not intersect loaded range."))}ETe(aa,ia,ka=null){ka=Q.JOh(ka);this.fk.Ep(aa.flowId,7);return this.calcManager.r4a(ka,ia,aa.originCell,aa.formula,void 0).then(Xa=>{if(!this.Nui(Xa))return Object(B.h)(aa,"Result object from EvalOnClone API is empty or null.",this.fk,8),new G(2);if(!this.KUg(Xa,aa))return e.ULS.sendTraceTag(527005663,
0,50,"FormulaByExampleModelUpdater:EvalFormulaRangeOnClone: Formula results from Calc.ts had errors."),new G(2);const sb=this.jak(Xa,aa);if(!sb.success)return Object(B.h)(aa,`Evaluated results from calc do not match the user data in the grid or had errors from calc. reason: ${sb.reason}`,this.fk,8),e.ULS.sendTraceTag(537161880,0,50,"FormulaByExampleModelUpdater:EvalFormulaRangeOnClone:Formula results from Calc.ts do not match grid data."),new G(2);this.fk.Ep(aa.flowId,11);e.ULS.sendTraceTag(537161879,
0,50,"FormulaByExampleModelUpdater:EvalFormulaRangeOnClone: EvalFormulaRange CSE: Result received from calc.");return new G(0,Xa.results,sb.Luc)}).catch(Xa=>{Object(B.h)(aa,`failed to EvalFormulaRangeOnClone, error in calc API: ${Xa.toString()}`,this.fk,8);return Promise.reject(`FormulaByExampleModelUpdater:EvalFormulaOnRange: Unable to EvalFormulaRange, e: ${Xa.toString()}`)})}BWg(aa,ia){if(aa)for(const Xa of aa)if(excelOnlineCalc.util.isSuccess(Xa)){aa=Xa;var ka=c(aa.value[0]);if(ka=this.gridView.Ob(ka))ka=
ka.cell,ka.text=this.Oid(aa).displayText,ka.formulaBarText=ia}}static JOh(aa){const ia=ka=>({row:ka.cell.lR,column:ka.cell.kR,Xr:ka.Xr,formulaBarText:ka.Xr.value,text:ka.cell.text,si:ka.cell.si});return aa?aa.map(ia):null}KUg(aa,ia){if(u.EwaSettings.isChangeGateEnabled("OfficeVSO:6669310_FBEShowsSuggestionsWithCalcFailures"))return!0;for(const ka of aa.results){const {isSuccess:Xa,scd:sb,reason:ib}=this.$Oh(ka);if(!Xa)return Object(B.h)(ia,`Calc failed to evaluate formula. reason json: ${ib} did result in error for formula output (#VALUE, #REF etc..): ${sb}`,
this.fk,8),!1}return!0}Nui(aa){return(aa=aa.results)&&aa.length?!0:!1}$Oh(aa){if(excelOnlineCalc.util.isSuccess(aa)){const ia=aa.value[1];return 8===ia.kind?(aa=c(aa.value[0]),(aa=this.gridView.Ob(aa))&&aa.cell.text&&e.ULS.shipAssertTag(537161878,0,!1,"FormulaByExampleModelUpdater:FormulaCalculationSucceeded: formula evaluation failed, bad formula provided"),{isSuccess:!1,scd:!0,reason:JSON.stringify(ia.type)}):{isSuccess:!0,scd:!1,reason:null}}return{isSuccess:!1,scd:!1,reason:JSON.stringify(aa.reason)}}O6j(aa,
ia,ka,Xa){var sb=aa.Ecd;for(const ib of sb)excelOnlineCalc.util.isSuccess(ib)?(sb=ib.value[0])?(sb=c(sb),(sb=this.gridView.Ob(sb))?(sb.cell.Ccb=this.Oid(ib).displayText,aa.status|=1):aa.status|=2):aa.status|=2:"Unavailable"!==ib.reason.kind&&(aa.status|=2);this.ZB&&!ia&&ka&&Object(B.f)("MODELUPDATED",ka,Xa);return aa}jak(aa,ia){let ka=null,Xa=!1,sb=!1,ib=!1,Ub=!1,hc=!1,yb=!1;aa=aa.results;var Gb=aa.entries();for(const fb of Gb){Gb=fb[0];var Sa=fb[1];const ab=this.kak(Sa,ia);if(Object(ca.b)(Sa))Sa=
!0;else{var db=Sa.value[0];if(db="row"in db&&"col"in db)Sa=Sa.value[1],db="kind"in Sa&&("value"in Sa||"_valueXL"in Sa)&&"formattedText"in Sa;Sa=db}Sa||e.ULS.sendTraceTag(509216720,0,10,"FormulaByExampleModelUpdater:validateCalcResultMatchModelData: evalOnCloneCellResult should be kind of EvalOnCloneSuccesResultDeprecated.");ab.G9a&&(Xa=ab.N9b);ab.Yvd&&(sb=!0,ib||(ib=ab.isInViewport),hc||(hc=ab.isInViewport&&!ab.JCb));Ub||(Ub=ab.JCb);yb||(yb=ab.Zdf);ka=null!==ka&&void 0!==ka?ka:ab.WIa;(ab.Yvd||ab.JCb)&&
aa.splice(Gb,1)}Xa?this.fk.Ep(ia.flowId,10):this.fk.Ep(ia.flowId,9);return ka?{success:!1,reason:ka}:{success:!0,Luc:{["hasUnavailableCells"]:sb,["hasUnexpectedUnavailableCellsInViewport"]:hc,["hasHiddenRows"]:Ub,["hasUnavailableCellsInViewport"]:ib,["hasErrorCells"]:yb}}}kak(aa,ia){var ka;const Xa={G9a:!1,Yvd:!1,isInViewport:!1,JCb:!1,WIa:null,Zdf:!1,N9b:!1};if(!excelOnlineCalc.util.isSuccess(aa)){var sb=aa.reason;aa=R.Range.Lc(sb.cell.row+1,sb.cell.col+1);Xa.G9a=aa.equals(ia.originCell);this.WZe(Xa,
aa);if(u.EwaSettings.isChangeGateEnabled("OfficeVSO:6669310_FBEShowsSuggestionsWithCalcFailures")){if("Unavailable"===sb.kind)return Xa.Yvd=!0,Xa;Xa.WIa=JSON.stringify({kind:sb.kind,innerKind:sb.innerKind})}Xa.WIa=null!==(ka=Xa.WIa)&&void 0!==ka?ka:"failure in calc";return Xa}sb=c(aa.value[0]);Xa.G9a=sb.equals(ia.originCell);this.WZe(Xa,sb);ka=this.gridView.Ob(sb);if(!ka){if(Xa.isInViewport&&!Xa.JCb)return Xa.WIa="formatted grid cell is null",Xa;e.ULS.sendTraceTag(509682371,0,50,"FormulaByExampleModelUpdater:validateCalcResultMatchesCellData: did not fail suggestion when a formatted grid cell is null as this cell is hidden or not in view.");
return Xa}var ib=this.Oid(aa,this.Xlf?ka:null,ia.RNe);if(8===ib.kind)return Xa.Zdf=!0,this.Qag&&Xa.G9a&&(Xa.WIa=`suggestion has error of kind ${ib.value} in cell.`),Xa;aa=ka.text;if(!aa)return Xa.N9b=!0,Xa;ib=ib.displayText;Xa.N9b=N.a.equals(aa,ib,!1);Xa.N9b||(sb=ia.ulf(sb)?Xa.G9a?"MODIFIEDEXAMPLE":"EXAMPLE":Xa.G9a?"MODIFIEDRESTOFRANGE":"RESTOFRANGE",Object(B.g)(aa,ib.toString(),ka.cell.si,"evalFormulaOnCloneToShowPreview",ia,sb),Xa.WIa="data strings do not match");return Xa}WZe(aa,ia){aa.isInViewport=
this.gridView.wN(ia);const ka=this.gridView.Lj("FormulaByExample");Object(U.a)(ka);aa.JCb=ka.value.dDb(ia)}AOh(aa,ia,ka){aa=this.eg.k1e(aa,ia.cell.si,0===ia.cell.oz?ka:ia.cell.oz,ia.cell.QCa,ia.cell.rja);if(aa.success)return aa.iB;e.ULS.sendTraceTag(509694294,0,50,"FormulaByExampleModelUpdater:formatCloneResult: formatCellsAction failed to format clone result according to cell format.");return null}Oid(aa,ia,ka){aa=aa.value[1];var Xa=1===aa.kind?aa._valueXL.toString():8===aa.kind?E.a.tcd[aa.type-
1]:aa.value;ia&&!aa.formattedText&&(aa.formattedText=this.AOh(Xa,ia,ka));return new H(aa.kind,Xa,aa.formattedText)}}Object(f.a)(Q,"FormulaByExampleModelUpdater",null,[]);var Y=a(276),la=a(1131),ea=a(73),ha=a(149),X=a(184),T=a(1130);class ua extends T.a{constructor(aa,ia,ka,Xa){super(aa,ia,ka,Xa);this.kind="Table"}get table(){void 0===this.JZa&&(this.JZa=Object(I.h)(this.$).wb.mh(this.originCell,!1));return this.JZa}set table(aa){this.JZa=aa}get tA(){return this.table?Object(X.a)(this.table):null}}
Object(f.a)(ua,"FormulaByExampleTableSuggestion",T.a,[]);var Ha=a(955),Ca=a(128),Ga=a(986),sa=a(956),bb=a(1133),Ba=a(936),qa=a(430),pa=a(1287);class ya{constructor(aa){this.Zbf=!1;this.$=aa}ALg(aa){u.EwaSettings.isChangeGateEnabled("OfficeVSO:7632318_FormulaByExampleSurvey")&&("ACCEPT"===aa?this.$.Xc(-458824895,-1,0,null):"DECLINE"===aa?this.$.Xc(-1726708382,-1,0,null):"IGNORE"===aa&&(this.Zbf?this.$.Xc(-1227021552,-1,0,null):this.Zbf=!0))}}Object(f.a)(ya,"FormulaByExampleSurveyManager",null,[]);
var za=a(783);T=a(1474);const cb=[Object(T.b)("featureNameField","FormulaByExample"),Object(T.b)("ver","1.0.0")],Pa={eventName:"Office.Excel.FormulaByExample.Seen",eventFlags:za.a,dataFields:[...cb,Object(T.a)("isFeatureSeen",!0)]},nb={eventName:"Office.Excel.FormulaByExample.Tried",eventFlags:za.a,dataFields:[...cb,Object(T.a)("isFeatureTried",!0)]},Ma={eventName:"Office.Excel.FormulaByExample.Succeeded",eventFlags:za.a,dataFields:[...cb,Object(T.a)("isFeatureSucceeded",!0)]};class Oa{constructor(aa,
ia,ka,Xa,sb,ib){this.PF=this.jB=this.QUa=this.ypc=null;this.KOa=this.ZB=!1;this.DRa=null;this.YWd=!1;this.cxb=null;this.Pbg=!1;this.Eyf=2E3;this.x1e=null;this.xVi=Ub=>{e.ULS.sendTraceTag(520987789,306,50,`FormulaByExampleManager.onCloseCallback: closeReason = ${Ba.a[Ub]}`)};this.ZOh=(Ub,hc)=>{var yb,Gb;e.ULS.sendTraceTag(528758222,306,50,"FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation received.");if(Ub=hc.jH){if(hc=parseInt(Ub.guid,10),!u.EwaSettings.isChangeGateEnabled("OfficeVSO:7417755_FormulaByExampleVerifyDuplicatedAnnotation")||
this.fk.Olf(hc))e.ULS.sendTraceTag(526984792,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: received annotation's flowId: ${hc}, containsRowPlaceholder: ${null===(Gb=null===(yb=Ub.generatedFormula)||void 0===yb?void 0:yb.formula)||void 0===Gb?void 0:Gb.includes(Ha.b)}`),this.fk.Ep(hc,14),yb=this.$,Gb=this.Raj(hc),yb=Gb.f6?new ua(yb,Ub,hc,Gb):new Ha.a(yb,Ub,hc,Gb),Object(pa.b)(yb)||P.a.hkc(this.$)?(this.ZB&&!this.KOa&&Object(B.f)("ANNOTATIONRECEIVED",yb.flowId),null!=yb.errorMessage?
(e.ULS.sendTraceTag(527005666,306,10,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation arrived with error message: ${yb.errorMessage}, flowId: ${yb.flowId}`),this.fk.Ep(yb.flowId,15,{reason:"Annotation arrived with error message"})):yb.formula?(e.ULS.sendTraceTag(509679808,306,20,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation with a formula suggestion arrived. flowId: ${yb.flowId} isTableSuggestion: ${Object(pa.b)(yb)}}`),this.fk.Ep(yb.flowId,16,{aqc:yb.formula}),
this.PF=yb,(Gb=this.QUa.P3(yb))?this.Pbg||1!==yb.invocationMethod?yb.py<sa.a?e.ULS.sendTraceTag(528758220,306,50,"FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation does not have enough examples to prompt a suggestion."):(e.ULS.sendTraceTag(527005665,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation with formula suggestion arrived. trying to suggest/apply it. flowID: ${yb.flowId}`),0===yb.invocationMethod?this.eFj(Gb):(Ub=Object(B.c)(yb.flowId),Ub>this.Eyf?
(e.ULS.sendTraceTag(509636688,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation arrived after the maximal wait time for suggestions. flowId: ${yb.flowId}, duration: ${Ub}`),this.fk.Ep(yb.flowId,6,{reason:"annotation arrived after the maximal wait time for suggestions"})):(Ub=this.Nbg(Gb),Ub.value?this.skg(Gb,!1,"UponAnnotationReceived"):(e.ULS.sendTraceTag(509636687,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: shouldShowPreview returned false for suggestion with flowId: ${yb.flowId}, reason: ${Ub.reason}`),
this.fk.Ep(yb.flowId,6,{reason:Ub.reason}))))):e.ULS.sendTraceTag(523850754,306,50,"FormulaByExampleManager.formulaByExampleAnnotationHandler: session supports suggestions from cache only. returning early after caching suggestion."):e.ULS.sendTraceTag(509678998,306,15,`FormulaByExampleManager.formulaByExampleAnnotationHandler: failed to cache suggestion for flowId: ${yb.flowId}.`)):(e.ULS.sendTraceTag(528758221,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation does not have any formula suggestions. deleting existing entry, if any. flowId: ${yb.flowId}`),
this.QUa.u3a(yb),this.jB.r1(yb.originCell,2),this.fk.Ep(yb.flowId,15))):e.ULS.sendTraceTag(509204251,306,10,"FormulaByExampleManager.formulaByExampleAnnotationHandler: range table suggestions should not be created in this session.")}else e.ULS.sendTraceTag(537161922,306,15,"FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation is null.")};this.$Aj=()=>{e.ULS.sendTraceTag(537161889,306,50,"FormulaByExampleManager.SendByExampleFeedback: opening send feedback dialog after click on card.");
const Ub={};Ub[M.a.AH]="FormulaByExampleCard";this.$.Xc(802602464,0,8,Ub)};this.U4i=Ub=>{this.YWd=!0;e.ULS.sendTraceTag(537161888,306,50,`FormulaByExampleManager.OnShowFormula: user clicked ShowFormula button in the card for flow ${Ub}`)};this.sei=Ub=>{e.ULS.sendTraceTag(528758219,306,50,"FormulaByExampleManager.HandleNewBlocksDuringPreview: new block arrived during preview mode.");var hc=Ub.hd.block,yb=this.PF.tA;const Gb=this.PF.range.ze(hc.Ge);yb=(new R.Range(yb.top,yb.left,yb.bottom,yb.right,
!0,!0)).ze(hc.Ge);hc=Array.from(this.gridView.Xka(yb,hc));e.ULS.sendTraceTag(537161886,306,50,`FormulaByExampleManager.HandleNewBlocksDuringPreview: putting skeleton for preview cells in new block ${Ub.hd.hash}.`);this.b3d(Gb,!0);this.FTe(this.PF,yb,hc).then(Sa=>{e.ULS.sendTraceTag(537161885,306,50,`FormulaByExampleManager.HandleNewBlocksDuringPreview: putting calculated data into model and demanding re-render for block ${Ub.hd.hash}.`);this.b3d(Gb,!1);this.jO.Wxf(Ub.hd.block);e.ULS.sendTraceTag(512508567,
306,50,`FormulaByExampleManager.handleNewBlocksDuringPreview: new FormulaByExample suggestion block rendered during preview. results: ${JSON.stringify({["flowId"]:this.PF.flowId,["originalFlowId"]:this.PF.A0.flowId,["formulaAnonymized"]:this.PF.anonymizedFormula,["originalFormulaAnonymized"]:this.PF.A0.anonymizedFormula,["annotationRange"]:this.PF.range.toString(),["previewCellsMetadata"]:Sa.Luc})}`);return!0}).catch(Sa=>{Object(B.h)(this.PF,`Exception when rendering new block during preview. ${Sa}`);
e.ULS.sendTraceTag(537161884,306,50,`FormulaByExampleManager.HandleNewBlocksDuringPreview: caught exception: ${Sa}.`)})};this.cZf=()=>{this.$.userOperationManager.ro(this.sGd);this.sGd=null};this.FQa=(Ub,hc)=>{0==hc.er&&(this.KOa&&this.DRa.Hla(`UserOperation: ${Ca.a(hc.Of.operation.operationName)}`),this.$.userOperationManager.ro(this.FQa))};this.N_i=Ub=>{e.ULS.sendTraceTag(528023709,306,20,`FormulaByExampleManager.onImmediateUndo: undo operation queued following a formula by example suggestion application. flowId=${Ub.suggestion.flowId} originalFlowId=${Ub.suggestion.A0.flowId} isTableSuggestion=${Object(pa.b)(Ub.suggestion)}`);
this.QUa.f$f(Ub,"UNDO")};this.$=aa;this.Pbg=u.EwaSettings.isChangeGateEnabled("OfficeVSO:6169955_ShowFormulaByExampleSuggestionsUponArrivalFromServer");this.Eyf=u.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleMaximalWaitingTimeForSuggestionsMs",2E3);this.augmentationLoopManager=ia;this.calcManager=ka;this.eg=Xa;this.tableIntelligenceManager=ib;this.cxb=new Map;this.gridView=Object(I.h)(this.$);this.jB=sb;this.fk=O.a.getInstance(this.$);this.jO=this.gridView.jO;this.PJd=!1;
P.a.gkc(this.$)?this.init():e.ULS.sendTraceTag(537161923,306,10,"FormulaByExampleManager.Ctor: not expected to be constructed when FG is off.")}E6i(aa,ia,ka){const Xa=ka.vHd;this.cxb.set(aa,ka);this.PJd=!1;if(ka=this.QUa.eai(ka,aa)){this.fk.Ep(aa,4);ka.suggestion.flowId=aa;ka.suggestion.originCell=Xa;var sb=this.Nbg(ka);sb.value?(e.ULS.sendTraceTag(529109774,306,50,"FormulaByExampleManager.onUserInput: A cached formula suggestion found for current input."),this.skg(ka,!0,Object(qa.a)(ia))):(this.fk.Ep(aa,
6,{reason:sb.reason}),this.Tak(aa,ka.suggestion,Xa))}else this.fk.Ep(aa,5)}Tak(aa,ia,ka){u.EwaSettings.isChangeGateEnabled("OfficeVSO:7041480_FormulaByExampleFlowAggregatorFixed")&&this.calcManager.evalFormula(ia.formula,ka,ea.d(this.$.na),excelOnlineCalc.calc.evalFormulaFormatOrigin()).then(Xa=>{var sb=this.gridView.Ob(ka);const ib=sb.text;sb=sb.cell.si;Xa=Xa.value.value.toString();N.a.equals(ib,Xa,!1)?this.fk.Ep(aa,10):(Object(B.g)(ib,Xa,sb,"evalFormulaToVeriySuggestionWithoutShowingPreview",ia,
ia.ulf(ka)?"MODIFIEDEXAMPLE":"MODIFIEDRESTOFRANGE"),this.fk.Ep(aa,9))}).catch(Xa=>{Xa=`Failed to evalFormula, error in calc API: ${Xa.toString()}`;e.ULS.sendTraceTag(512341207,306,50,`FormulaByExampleMangaer.verifySuggestionOnEditedCell: ${Xa}`);this.fk.Ep(aa,9,{reason:Xa})})}dispose(){this.$.userOperationManager.ro(this.FQa);this.cZf();this.augmentationLoopManager.unregister("FormulaByExample")}init(){const {FormulaByExampleAutoSuggestActor:aa}=a(1390);this.augmentationLoopManager.register(this.augmentationLoopManager.l5().B8("FormulaByExample").A8(this.xVi).activateAnnotation({annotationType:la.a.getTypeName(),
Ay:!1,TR:this.ZOh}).build());this.ZB=Object(B.a)(this.$);new aa(this.$,this.calcManager,this.tableIntelligenceManager,this.ZB);this.QUa=new pa.a(this.jB,this.fk,this.gridView,this.calcManager);this.ypc=new Q(this.$,this.calcManager,this.eg,this.ZB);this.x1e=new ya(this.$);e.ULS.sendTraceTag(528758223,306,50,"FormulaByExampleManager.init: init complete.")}Raj(aa){if(!this.cxb.has(aa))return null;const ia=this.cxb.get(aa);this.cxb.delete(aa);return ia}eFj(aa){const ia=aa.suggestion;this.ypc.ETe(ia,
ia.range,null).then(ka=>{this.C0c(aa,1===ka.status?ka.Ecd:null);return null}).catch(()=>{e.ULS.sendTraceTag(537161921,306,50,"FormulaByExampleManager.setFormulaOnRangeExplicit: client estimation failed for explicit by example flow.");this.C0c(aa,null)})}skg(aa,ia,ka){e.ULS.sendTraceTag(527713160,306,20,`FormulaByExampleManager.tryDisplayFormulaSuggestionPreview: starting flow to show a formula suggestion. isFromCache: ${ia} isTableSuggestion: ${Object(pa.b)(aa.suggestion)} flowId: ${aa.suggestion.flowId})}`);
const Xa=aa.suggestion;this.ZB&&!this.KOa&&Object(B.f)("CALCULATIONSTART",Xa.flowId,ia);var sb=u.EwaSettings.isChangeGateEnabled("OfficeVSO:7189977_SendCloneUpdatesOnPreview")?this.e6e(Xa.tA):null;sb=this.FTe(Xa,this.gridView.Ej,sb,ia);const ib=sb.then(()=>this.jO.zpa(Xa.range,this.sei).then(Ub=>{this.KOa=!0;this.DRa=Ub;this.$.userOperationManager.tr(this.FQa);this.jB.show(Xa.formula,Xa.range.toString(),()=>Ub.j0b("CardUI"),()=>Ub.b9b("CardUI"),this.$Aj,()=>this.U4i(Xa.flowId),Xa.originCell);this.jB.r1(Xa.originCell,
0);this.ZB&&ha.a(()=>{Object(B.f)("PREVIEWRENDERED",Xa.flowId,ia);const hc=Object(B.e)(ia,Xa.flowId);e.ULS.sendTraceTag(529109772,306,50,`FormulaByExampleManager.TryDisplayFormulaSuggestionPreview: durations for preview shown flow: ${JSON.stringify(hc)}`)},this.$.ka);return Ub.O2f}));Promise.all([sb,ib]).then(Ub=>{this.PJd=!0;this.Hei(Ub[0],Ub[1],aa,ia,ka)}).catch(Ub=>{Object(B.h)(Xa,`Failed to show formula preview due to a promise (model update or preview render) rejection. rejection reason: ${Ub}`);
e.ULS.sendTraceTag(537161920,306,15,`FormulaByExampleManager.TryDisplayFormulaSuggestionPreview: failed to show formula preview due to promise rejection. rejection reason: ${Ub}`);this.jB.r1(Xa.originCell,5,Ub);aa.state=Ga.b.ignore})}FTe(aa,ia,ka=null,Xa){return this.ypc.fFj(aa,ia,ka,this.KOa,Xa).then(sb=>{e.ULS.sendTraceTag(537161887,306,50,`FormulaByExampleManager.EvaluateFormulaAndUpdateModel: model update completed. result: ${sb.status}.`);switch(sb.status){case 3:case 1:return 3===sb.status&&
Object(B.h)(aa,"Preview shown, but only partially. some cells failed to evaluate."),Promise.resolve(sb);case 2:return Promise.reject("Calc estimation or model update failed");default:return Promise.reject("Calc estimation failed")}})}Hei(aa,ia,ka,Xa,sb){const ib=this.YWd;this.Cuj();const Ub=ka.suggestion;this.ZB&&Object(B.f)("USERINPUTARRIVED",Ub.flowId,Xa);this.b3d(Ub.range,!1);this.jB.hide();ha.a(()=>{this.ZB&&Object(B.f)("PREVIEWREMOVEDWITHCSE",Ub.flowId,Xa);const hc={["flowId"]:Ub.flowId,["originalFlowId"]:Ub.A0.flowId,
["caller"]:ia.pCe,["displayTrigger"]:sb,["formulaAnonymized"]:Ub.anonymizedFormula,["originalFormulaAnonymized"]:Ub.A0.anonymizedFormula,["suggestionOutcome"]:ia.YJb,["annotationRange"]:Ub.range.toString(),["isFullyInViewport"]:this.gridView.wN(Ub.range),["isCachedSuggestion"]:Xa,["showFormulaClicked"]:ib,["exampleCount"]:Ub.py,["originalExampleCount"]:Ub.A0.py,["seenCount"]:ka.vNb,["previewCellsMetadata"]:aa.Luc,["previewShownDurations"]:this.ZB?Object(B.e)(Xa,Ub.flowId):"none",["previewRemovedDurations"]:this.ZB?
Object(B.d)(Xa,Ub.flowId):"none",["isSuggestionOnTable"]:Object(pa.b)(Ub),["isNewRowPrediction"]:!Object(pa.b)(Ub)&&Ub.Tkc,["sheetId"]:Ub.sheetId};e.ULS.sendTraceTag(388780100,306,50,`FormulaByExampleManager.handlePreviewResult: FormulaByExample flow results: ${JSON.stringify(hc)}`);u.EwaSettings.isChangeGateEnabled("OfficeVSO:7705932_FBESendsOtelEvents")&&Object(za.b)(Pa);Object(B.b)(Ub.flowId)},this.$.ka);e.ULS.sendTraceTag(523842074,306,50,`FormulaByExampleManager.handlePreviewResult: User ${ia.YJb} the formula via ${ia.pCe}`);
this.QUa.f$f(ka,ia.YJb);"ACCEPT"===ia.YJb&&(this.C0c(ka,aa.Ecd),u.EwaSettings.isChangeGateEnabled("OfficeVSO:7705932_FBESendsOtelEvents")&&Object(za.b)(nb));this.x1e.ALg(ia.YJb);this.$.userOperationManager.ro(this.FQa)}Cuj(){this.KOa=!1;this.DRa=null;this.YWd=!1}C0c(aa,ia){let ka=aa.suggestion;const Xa=Object(D.a)(new Y.a,{Text:ka.formula});this.gridView.setCell(Xa,ka.originCell,1,127,null,0,{range:ka.range,origin:ka.originCell},2);this.ypc.BWg(ia,ka.formula);e.ULS.sendTraceTag(537161883,306,50,`FormulaByExampleManager.applyFormulaSuggestionOnRange: applied formula on table, range: ${ka.range}`);
this.sGd=(sb,ib)=>{0==ib.er&&(170==ib.Of.operation.operationName?this.N_i(aa):u.EwaSettings.isChangeGateEnabled("OfficeVSO:7705932_FBESendsOtelEvents")&&Object(za.b)(Ma),this.cZf())};this.$.userOperationManager.tr(this.sGd)}Nbg(aa){const ia=aa.suggestion,ka=this.rsi(ia.flowId);return ka.value?aa.state===Ga.b.decline?(this.jB.r1(aa.suggestion.originCell,6,bb.a.Sug),e.ULS.sendTraceTag(528758217,306,50,`FormulaByExampleManager.shouldShowPreview: user declined this suggestion before, not showing again. flowId: ${ia.flowId}`),
{value:!1,reason:"User declined this suggestion before."}):ia.py<sa.a?(this.jB.r1(aa.suggestion.originCell,6,bb.a.kug),e.ULS.sendTraceTag(528758215,306,50,`FormulaByExampleManager.shouldShowPreview: cached suggestion does not have enough examples. not showing preview. flowId: ${ia.flowId}`),{value:!1,reason:"Cached suggestion does not have enough examples."}):aa.state===Ga.b.ignore&&2<=aa.vNb?(this.jB.r1(aa.suggestion.originCell,6,bb.a.Rug),e.ULS.sendTraceTag(528758216,306,50,`FormulaByExampleManager.shouldShowPreview: user saw suggestion at least twice and ignored last time. not showing again. flowId: ${ia.flowId}`),
{value:!1,reason:"User saw suggestion at least twice and ignored last time"}):u.EwaSettings.isChangeGateEnabled("OfficeVSO:7654591_FormulaByExampleForbiddenFormulas")&&this.QUa.Rui(ia)?(e.ULS.sendTraceTag(509195993,306,50,`FormulaByExampleManager.shouldShowPreview: suggestion is forbidden. not showing preview. flowId: ${ia.flowId}`),{value:!1,reason:"Cached suggestion is forbidden as it wasn't wanted before."}):u.EwaSettings.isChangeGateEnabled("OfficeVSO:7300192_FBETextCellsUnsupported")&&this.e6e(ia.range).some(Xa=>
this.calcManager.eBi(Xa.cell.si))?{value:!1,reason:"At least 1 cell in the loaded suggestion range is formatted as Text"}:u.EwaSettings.isChangeGateEnabled("OfficeVSO:7464540_FBENoneValueTypesUnsupported")&&0===ia.RNe?{value:!1,reason:"suggestion's default value type cannot be none."}:u.EwaSettings.isChangeGateEnabled("OfficeVSO:7669810_ValidateRangeIsInsideTableUponShowingSuggestion")&&Object(pa.b)(ia)&&!ia.table?{value:!1,reason:"table suggestion's table object is null."}:{value:!0}:(this.jB.r1(aa.suggestion.originCell,
6,bb.a.Usg),{value:!1,reason:ka.reason})}b3d(aa,ia){for(let Xa=aa.top;Xa<=aa.bottom;Xa++)for(let sb=aa.left;sb<=aa.right;sb++){var ka=R.Range.Lc(Xa,sb);if(ka=this.gridView.Ob(ka))ka.cell.tdg=ia&&!ka.cell.Ccb}}rsi(aa){return this.PJd?(e.ULS.sendTraceTag(528758218,306,50,`FormulaByExampleManager.shouldShowPreview: can't show preview again as preview already was shown for the current edit. flowId: ${aa}`),{value:!1,reason:"Preview already shown for the latest edit."}):this.KOa?(e.ULS.sendTraceTag(527005664,
306,50,`FormulaByExampleManager.shouldShowPreview: can't show preview for this suggestion as preview is already showing. flowId: ${aa}`),{value:!1,reason:"Preview is already showing."}):this.gridView.jb?(e.ULS.sendTraceTag(524813027,306,50,`FormulaByExampleManager.shouldShowPreview: can't show preview for this suggestion as user is editing. flowId: ${aa}`),{value:!1,reason:"User is editing."}):{value:!0}}e6e(aa){let ia=[];const ka=this.gridView.Ca.gca(aa,this.gridView.$.activeItemName);for(const Xa of ka)ia.push(...this.gridView.Xka(aa.ze(Xa.Ge),
Xa));return ia}}Object(f.a)(Oa,"FormulaByExampleManager",null,[619,2]);class La extends v.a{constructor(aa){super();this.$=aa;this.Mb()}create(){e.ULS.sendTraceTag(528758214,0,50,"FormulaByExampleManagerFactory.Create: starting service creation flow.");const aa=h.GetServiceTaskFactory.Sa(this.$.da,328,327,this.Na);let ia;ia=u.EwaSettings.LF()?Object(n.d)(y.a.resolve(z.g,{rb:this.Na})):h.GetServiceTaskFactory.Sa(this.$.da,266,265,this.Na);let ka=F.Task.Ua(null);u.EwaSettings.isChangeGateEnabled("OfficeVSO:6327953_FormatOutputResultsOfFBE_V2")&&
(ka=u.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormatCellsActionNewService",!1)?Object(n.d)(y.a.resolve(z.x,{rb:this.Na})):h.GetServiceTaskFactory.create(this.$.da,18,this.$.ka,this.Na));const Xa=P.a.hkc?h.GetServiceTaskFactory.Sa(this.$.da,20,404,this.Na):F.Task.Ua(null),sb=[aa,ia,ka,Xa];m.init(this.$);if(u.EwaSettings.isChangeGateEnabled("OfficeVSO:7676712_FormulaByExampleTriggersService")){const ib=Object(n.d)(y.a.resolve(z.A,{rb:this.Na}));sb.push(ib)}r.TaskExtensions.za(r.TaskExtensions.Pd(sb,
this.ka),()=>{e.ULS.sendTraceTag(528758213,0,50,"FormulaByExampleManagerFactory.Create: augmentationLoopManager and calcManager creation tasks resolved.");const ib=new Oa(this.$,aa.result,ia.result,ka.result,m.instance(),Xa.result);this.vb(this.$.da.Aa(453)||this.$.da.Ha(453,ib));e.ULS.sendTraceTag(537161882,0,50,"FormulaByExampleManagerFactory.Create: FormulaByExampleManager initialized successfully")},this.ka)}static la(aa){aa.da.Ha(454,new La(aa))}}Object(f.a)(La,"FormulaByExampleManagerFactory",
v.a,[]);v=a(159);var ra=a(6),V=a(1132);let ma=class{constructor(aa,ia){this.sRe=new Set;this.q7=(ka,Xa)=>{if(ka=this.gridView.wb.mh(Xa.Hk,!1))if(Xa=Object(V.a)(ka,Xa.Hk.left,this.calcManager))this.sRe.has(Xa)?(this.BLg(),this.gridView.hc.eOd(this.q7)):this.sRe.add(Xa)};this.BLg=()=>{ra.AFrameworkApplication.Fs("XLS-FormulaByExample-Treatment;XLS-FormulaByExample-Control")};this.gridView=I.h(aa);this.calcManager=ia;this.gridView.hc.y1b(this.q7)}};ma=Object(v.b)([Object(y.d)(z.A),Object(v.c)(0,Object(z.u)()),
Object(v.c)(1,Object(z.g)())],ma);Object(f.a)(ma,"FormulaByExampleTriggersManager",null,[]);a.d(C,"a",function(){return W});const W=()=>{b.a.Fa(aa=>{La.la(aa);A.la(aa)})};String(t);window.___1680633013769_closurehack=t},1213:function(t,C,a){function c(Ba,qa){if(Ba===qa)return!0;if(!Ba||!qa||Ba.kind!==qa.kind||Ba.FQ!==qa.FQ||Ba.S4d!==qa.S4d||Ba.source.trigger!==qa.source.trigger)return!1;switch(Ba.kind){case "Success":case "Error":return Ba.text===qa.text&&Ba.start===qa.start&&Ba.length===qa.length&&
Ba.color===qa.color;case "Loading":return Ba.start===qa.start&&Ba.length===qa.length;default:return Ba}}function b({x:Ba,y:qa},pa,ya=document){let za=-1,cb=null;void 0!==ya.caretPositionFromPoint?(Ba=ya.caretPositionFromPoint(Ba,qa),null!==Ba&&(za=Ba.offset,cb=Ba.offsetNode)):void 0!==ya.caretRangeFromPoint&&(Ba=ya.caretRangeFromPoint(Ba,qa),null!==Ba&&(za=Ba.startOffset,cb=Ba.startContainer));return null===cb||-1===za?(D.ULS.sendTraceTag(521446491,0,15,"getEditorCaretPositionFromPoint - failed to get relevant range"),
-1):pa.contains(cb)?f(pa,cb,za):(D.ULS.sendTraceTag(521446490,0,15,"getEditorCaretPositionFromPoint - relavant node not inside root"),-1)}function f(Ba,qa,pa){if(Ba===qa)return pa;if(qa.textContent!==qa.parentElement.textContent)for(;null!==qa.previousSibling;)qa=qa.previousSibling,pa+=qa.textContent.length,"div"===qa.nodeName.toLowerCase()&&(pa+=1);return f(Ba,qa.parentElement,pa)}function e(Ba,qa){return Ba.text===qa.text&&Ba.start===qa.start&&Ba.length===qa.length}function d(Ba,qa,pa){if(Ba.has(qa))return Ba.get(qa);
pa=pa();Ba.set(qa,pa);return pa}function h(Ba){return JSON.stringify({text:Ba.text,start:Ba.start,length:Ba.length})}function r(Ba){return Object(x.c)(Ba)?"Undefined text":""===Ba?"Empty text":null}var l=a(10);t=a(0);var u=a(228),v=a(159),x=a(564),w=a(21),m=a(12),n=a(23),z=a(15),y=a(222),A=a(36),F=a(33),D=a(14),B=a(1129);class M{constructor(Ba){this.$=Ba;this.wja=this.g3a=null;this.usage={};this.dyc={};this.performance={};this.details={};this.yJb=-1;this.Dc=(qa,pa)=>{pa.Sf||pa.vsd||this.$.sendBeaconTraceTag(388818255,
50,!1,this.$_d())};this.editBox=Object(w.h)(this.$).hc;Ba.wj(this.Dc)}static getInstance(Ba){return M.instance||(M.instance=new M(Ba))}set trigger(Ba){this.g3a=Ba;this.yJb=B.a.K_d}set N2f(Ba){this.wja=Ba}hMb(Ba){Object(x.c)(this.details.color)&&(this.details.color={});Object(x.c)(this.details.color[Ba])&&(this.details.color[Ba]=0);this.details.color[Ba]++}setResult(Ba,qa){if(Object(x.c)(this.g3a))D.ULS.sendTraceTag(512258439,0,15,"ValuePreviewTelemetry.setResult - currentTrigger undefined");else if("Failure"!==
Ba.kind||Ba.timeout){var pa=qa===this.editBox?"cellEditor":"formulaBar",ya=this.g3a;qa=this.wja;var za=this.yJb;Object(x.c)(this.usage[pa])&&(this.usage[pa]={});Object(x.c)(this.usage[pa][ya])&&(this.usage[pa][ya]={success:0,error:0,loading:0,timeout:0});pa=this.usage[pa][ya];switch(Ba.kind){case "Success":this.ikj(Ba.text);pa.success++;this.g3a=this.wja=null;this.yJb=-1;this.Hv(qa,za);break;case "Error":pa.error++;this.g3a=this.wja=null;this.yJb=-1;this.Hv(qa,za);break;case "Loading":pa.loading++;
break;case "Failure":this.g3a=this.wja=null,this.yJb=-1,Ba.timeout&&pa.timeout++}}}ikj(Ba){if(!Object(x.c)(this.wja)){Object(x.c)(this.dyc[this.wja])&&(this.dyc[this.wja]=[]);var qa=this.dyc[this.wja];1E3>qa.length&&qa.push(Ba.length)}}Hv(Ba,qa){if(-1!==qa){Ba=null!==Ba&&void 0!==Ba?Ba:"cache";this.C8e(`${Ba}_request`).P4(!0,qa);var pa=this.C8e(`${Ba}_overall`);window.requestAnimationFrame(()=>{pa.P4(!0,qa)})}}C8e(Ba){return this.performance[Ba]=this.performance[Ba]||new B.a(R)}$_d(){const Ba={};
Object.keys(this.performance).forEach(qa=>{this.performance[qa].j_e();var pa=this.performance[qa];Ba[qa]={metrics:pa.LW,durations:pa.Ivb}});return`{"usage":${JSON.stringify(this.usage)},"resultLengths":${JSON.stringify(this.dyc)},"performance":${JSON.stringify(Ba)},"details":${JSON.stringify(this.details)}}}`}}Object(t.a)(M,"ValuePreviewTelemetry",null,[]);const R=[50,80,100,130,150,170,200];class P{constructor(Ba,qa,pa){this.$=Ba;this.BLa=qa;this.ariaLiveNotifier=pa;this.Hli();this.editBox=Object(w.h)(this.$).hc;
this.GMj=F.a.aI(this.$)}get telemetry(){return M.getInstance(this.$)}get zoomManager(){this.Epe||(this.Epe=Object(A.a)(this.$));return this.Epe}dispose(){this.hide()}show(Ba,qa,pa,ya){ya=Object.assign(Object.assign({},qa),{FQ:Ba,S4d:pa,source:ya});this.Rfb(ya)&&(this.tpa(ya)&&this.hide(),this.fD=ya,this.telemetry.setResult(qa,Ba),this.dJ(),pa&&this.vii())}hide(){if(this.fD){var Ba=this.fD.S4d;this.Mrh();Ba&&this.coj();this.fD=void 0}}Rfb(Ba){return!this.fD||!c(this.fD,Ba)}tpa(Ba){var qa;if(qa=this.fD)qa=
this.fD,qa=!(qa.FQ===Ba.FQ&&qa.start===Ba.start&&qa.length===Ba.length);return qa}vii(){const Ba=this.fD.length;0!==Ba&&this.fD.FQ.textBox.formatText(this.fD.start,Ba,{background:"rgba(202,234,216,0.6)"})}coj(){const Ba=this.fD.FQ;Ba.textBox.formatText(0,Ba.text.length,{background:!1});this.GMj&&Ba.kE(null)}dJ(){let Ba;switch(this.fD.kind){case "Success":case "Error":Ba={isLoaded:!0,value:this.fD.text,textColor:this.fD.color};break;case "Loading":Ba={isLoaded:!1,value:null,textColor:null};break;default:return}this.c9j();
this.BLa.renderValuePreview(this.Ts,this.iRb,Ba);this.G$i(Ba)}Mrh(){this.BLa.dismiss(this.Ts)}Hli(){this.Ts=document.createElement("div");this.iRb=document.createElement("div");this.iRb.style.position="absolute";this.iRb.style.visibility="hidden";this.$.domElement.appendChild(this.iRb)}c9j(){const Ba=this.fD.FQ,qa=this.fD.start,pa=this.fD.length;var ya=this.fD.source;let za;switch(ya.trigger){case "hover":za=excelOnline.utils.getBoundingRectForText(Ba.textBox.Ke,ya.index,ya.index+1,!1);break;case "shortcut":za=
excelOnline.utils.getBoundingRectForText(Ba.textBox.Ke,ya.index,ya.index,!1);break;case "selection":ya=n.a.contains(Ba.text.substring(qa,qa+pa),"\n",!0),za=excelOnline.utils.getBoundingRectForText(Ba.textBox.Ke,qa,ya?qa:qa+pa,!1)}this.b9j(za)}b9j(Ba){const qa=new y.a(this.iRb.style);qa.aC.left=this.tCc(Ba.left);qa.aC.top=this.tCc(Ba.top);qa.aC.width=this.tCc(Ba.width);qa.aC.height=this.tCc(Ba.height);qa.y3()}tCc(Ba){var qa=this.fD.FQ;qa=Object(x.b)(this.zoomManager)&&qa===this.editBox;return m.HelperMethods.Ic(qa?
this.zoomManager.Ph(Ba):Ba)}G$i({isLoaded:Ba,value:qa}){Ba?this.ariaLiveNotifier.readText(String.format(z.a.instance.qb(179),qa)):this.ariaLiveNotifier.readText(z.a.instance.ha(866))}}Object(t.a)(P,"FormulaAssistanceValuePreviewControl",null,[2]);var E=a(119);class H{constructor(Ba){this.cache=Ba}clearCache(){this.cache=void 0}}Object(t.a)(H,"Cacheable",null,[]);class G extends H{constructor(Ba,qa){super();this.$=Ba;this.callbacks=qa;this.OFf=(pa,ya)=>{const za=this.gridView.Ih;if(!(0<(za.jb?za.textBox.selection:
{index:0,length:0}).length))switch(ya.state){case 0:this.onHoverEnter(pa,ya.event);break;case 1:this.onHoverLeave(pa);break;default:return D.ULS.shipAssertTag(521446489,0,!1,"FormulaAssistanceValuePreviewHandler.onHoverChange unxpected HoverState"),ya}};this.MFf=(pa,ya)=>{const za=ya.selection;ya={source:"selection",text:ya.text,start:za.index,length:za.length};if(0<za.length)this.onSelectionChange(pa,ya);else this.ELf(pa,ya)};this.gridView=Object(w.h)(this.$);this.editBox=this.gridView.cellTextEditBox;
this.Mi(this.editBox);this.formulaBar=Object(E.a)(this.$);Object(x.b)(this.formulaBar)?this.Mi(this.formulaBar):Object(E.b)(this.$,pa=>{this.formulaBar=pa;this.Mi(this.formulaBar);D.ULS.sendTraceTag(509870663,1,50,"FormulaAssistanceValuePreviewHandler: formulaBar async")})}get telemetry(){return M.getInstance(this.$)}dispose(){this.Oi(this.editBox);this.Oi(this.formulaBar)}trigger(){const Ba=this.gridView.Ih,qa=Ba.textBox.selection;this.onSelectionChange(Ba,{source:"shortcut",text:Ba.text,start:qa.index,
length:qa.length})}Mi(Ba){Ba.ZZc(this.OFf);Ba.lte(this.MFf)}Oi(Ba){null===Ba||void 0===Ba?void 0:Ba.lOd(this.OFf);null===Ba||void 0===Ba?void 0:Ba.WZf(this.MFf)}onHoverEnter(Ba,qa){qa=new Sys.UI.Point(qa.clientX,qa.clientY);qa=b(qa,Ba.textBox.Ke);if(-1!==qa)this.onSelectionChange(Ba,{source:"hover",text:Ba.text,start:qa,length:0})}onHoverLeave(Ba){this.ELf(Ba)}onSelectionChange(Ba,qa){this.QLj(qa)&&!Ba.CD&&(this.cache=qa,this.callbacks.GGd(Ba,{index:qa.start,length:qa.length,trigger:qa.source}),this.telemetry.trigger=
qa.source)}ELf(Ba,qa){this.MLj(qa)&&(this.clearCache(),this.callbacks.Kda(Ba))}QLj(Ba){return!this.cache||!e(this.cache,Ba)}MLj(Ba){return this.cache&&Ba?"shortcut"!==this.cache.source||!e(this.cache,Ba):!0}}Object(t.a)(G,"FormulaAssistanceValuePreviewHandler",H,[2]);var N;(function(Ba){Ba[Ba.Failure=0]="Failure";Ba[Ba.Success=1]="Success";Ba[Ba.Error=2]="Error";Ba[Ba.Unavailable=3]="Unavailable"})(N||(N={}));Object(t.b)("ValuePreviewResultKind",N);var I=a(45),O=a(207);const U=Ba=>{const qa=M.instance;
if(Object(x.c)(Ba))return qa.hMb("none"),null;if("string"==typeof Ba){Ba=O.a.Rpc[Ba.toLowerCase()];if(Object(x.c)(Ba))return qa.hMb("badString"),null;qa.hMb("string");return Ba}if("number"==typeof Ba)return qa.hMb("number"),null;qa.hMb("other");return null};var ca=a(65);const Q=(Ba,qa,pa,ya,za,cb,Pa=null)=>{Pa=Ba.Oa(1,Pa);Pa.getPartialCalcResultsParameters=qa;return ca.g(Ba,"GetPartialCalcResults",Pa,pa,ya,za,cb,4)};class Y{constructor(Ba,qa){this.$=Ba;this.pluginScheduler=qa;this.V0=new la(h);this.$6f=
new la(h);this.w4i=(pa,ya)=>za=>{if(Object(x.c)(za.Result))ya("No result");else if(za=JSON.parse(za.Result),Object(x.c)(za))ya("Failed to deserialize");else if(1!==Object.keys(za).length)ya("Invalid response");else{for(var cb in za)var Pa=za[cb];cb=r(Pa);Object(x.b)(cb)?ya(cb):pa(Pa)}};this.v4i=pa=>()=>{pa("Request failed")};this.gridView=Object(w.h)(this.$);if(this.qxb=F.a.ZV(this.$))this.formulaAssistanceManager=Ba.da.Aa(464)}get telemetry(){return M.getInstance(this.$)}clearCache(){this.V0.clear();
this.$6f.clear()}euj(Ba,qa){return Object(v.a)(this,void 0,void 0,function*(){const pa=this.request(Ba);let ya;const za=new Promise(cb=>{ya=window.setTimeout(()=>{cb({kind:"Failure",timeout:!0})},qa)});return Promise.race([pa,za]).finally(()=>{window.clearTimeout(ya)})})}request(Ba){return Object(v.a)(this,void 0,void 0,function*(){return d(this.V0,Ba,()=>Object(v.a)(this,void 0,void 0,function*(){const {kind:qa,payload:pa}=yield this.pluginScheduler.getRequester().valuePreview(Ba,this.formulaAssistanceManager?
this.formulaAssistanceManager.FJb:0);if(0!==qa)return null;if(Object(x.c)(pa))return{kind:"Failure"};this.telemetry.N2f="client";switch(pa.kind){case 0:return{kind:"Failure"};case 1:case 2:var ya=this.nak;a:{var za=U(pa.color);switch(pa.kind){case 1:za=Object.assign(Object.assign({},pa),{kind:"Success",color:za});break a;case 2:za=Object.assign(Object.assign({},pa),{kind:"Error",color:za});break a}za=void 0}return ya.call(this,za);case 3:return this.Stj({text:Ba.text,start:pa.start,length:pa.length},
Ba,Ba.text,pa.text)}}))})}nak(Ba){const qa=r(Ba.text);return Object(x.b)(qa)?(D.ULS.sendTraceTag(509871621,1,15,`FormulaAssistanceValuePreviewRequester.validateClientSuccessResult: formula failure:${qa}, kind:${N[Ba.kind]}`),{kind:"Failure"}):Ba}Stj(Ba,qa,pa,ya){return Object(v.a)(this,void 0,void 0,function*(){return d(this.$6f,Ba,()=>{const za=new Promise(cb=>Object(v.a)(this,void 0,void 0,function*(){try{const Pa=yield this.D4h(pa,ya);this.telemetry.N2f="server";cb({kind:"Success",text:Pa,start:Ba.start,
length:Ba.length,color:null})}catch(Pa){D.ULS.sendTraceTag(520495426,1,50,`FormulaAssistanceValuePreviewRequester.requestFromServer: getPartialCalcResults failed, ${Pa}`),cb({kind:"Failure"})}}));za.then(()=>{this.V0.set(Ba,za);this.V0.set(qa,za)}).catch(cb=>{D.ULS.sendTraceTag(520495425,1,15,`FormulaAssistanceValuePreviewRequester.requestFromServer: serverPromise failed, ${cb}`)});return za})})}D4h(Ba,qa){return Object(v.a)(this,void 0,void 0,function*(){return new Promise((pa,ya)=>{const za={Formula:Ba,
PartialFormula:qa,SourceRange:Object(I.v)(this.gridView.ga.qa.activeCell,this.$)};Q(this.$.pa.va,za,this.w4i(pa,ya),this.v4i(ya),null,null)})})}}Object(t.a)(Y,"FormulaAssistanceValuePreviewRequester",null,[]);class la{constructor(Ba){this.a0d=Ba;this.map=new Map}has(Ba){Ba=this.a0d(Ba);return this.map.has(Ba)}get(Ba){Ba=this.a0d(Ba);return this.map.get(Ba)}set(Ba,qa){Ba=this.a0d(Ba);this.map.set(Ba,qa);return this}clear(){this.map.clear()}}Object(t.a)(la,"RequestMap",null,[]);class ea{constructor(Ba,
qa,pa,ya){this.$=Ba;this.GPj=200;this.H1f=3E3;this.GGd=(za,cb)=>Object(v.a)(this,void 0,void 0,function*(){const Pa={text:za.text,start:cb.index,length:cb.length};void this.kTf(Pa,this.duj(Pa),za,0===Pa.length,cb.trigger)});this.Kda=()=>{this.hide()};this.reset=()=>{this.handler.clearCache();this.requester.clearCache();this.hide()};this.IB=()=>{this.handler.clearCache();this.requester.clearCache()};this.gridView=Object(w.h)(this.$);this.control=new P(this.$,pa,ya);this.requester=new Y(this.$,qa);
this.handler=new G(this.$,{GGd:this.GGd,Kda:this.Kda});this.Mi()}get telemetry(){return M.getInstance(this.$)}trigger(){this.handler.trigger()}dispose(){this.Oi();this.handler.dispose();this.control.dispose()}Mi(){this.gridView.hc.Bm(this.reset);this.gridView.ga.t3(this.reset);this.$.ea.HC(this.IB)}Oi(){this.gridView.hc.km(this.reset);this.gridView.ga.Iea(this.reset);this.$.ea.YD(this.IB)}kTf(Ba,qa,pa,ya,za){return Object(v.a)(this,void 0,void 0,function*(){const cb=Object.assign(Object.assign({},
Ba),{FQ:pa,uBc:ya,trigger:za});this.zZ=cb;const Pa=yield qa;Object(x.c)(Pa)||this.Oyi(cb)&&void this.efi(Pa)})}efi(Ba){return Object(v.a)(this,void 0,void 0,function*(){const qa=this.zZ.text,pa=this.zZ.FQ,ya=this.zZ.uBc,za=this.zZ.trigger;switch(Ba.kind){case "Failure":this.telemetry.setResult(Ba,pa);this.hide();break;case "Success":case "Error":this.show(Ba);break;case "Loading":this.show(Ba);void this.kTf({text:qa,start:Ba.start,length:Ba.length},Ba.promise,pa,ya,za);break;default:return Ba}})}duj(Ba){const qa=
this.requester.euj(Ba,this.H1f);let pa;const ya=new Promise(za=>{pa=window.setTimeout(()=>{za(Object.assign(Object.assign({},Ba),{kind:"Loading",promise:qa}))},this.GPj)});return Promise.race([qa,ya]).finally(()=>{window.clearTimeout(pa)})}show(Ba){const qa=this.zZ.start,pa=this.zZ.FQ,ya=this.zZ.uBc,za=this.zZ.trigger;this.zZ=void 0;this.Wyi(Ba)&&this.control.show(pa,Ba,ya,{trigger:za,index:qa})}hide(){this.control.hide();this.zZ=void 0}Oyi(Ba){var qa;if(qa=this.zZ)qa=this.zZ,qa=qa.text===Ba.text&&
qa.start===Ba.start&&qa.length===Ba.length&&qa.FQ===Ba.FQ&&qa.uBc===Ba.uBc;return qa}Wyi(Ba){switch(Ba.kind){case "Success":case "Error":return Object(x.b)(Ba.text)&&""!==Ba.text;case "Loading":return!0;default:return Ba}}}Object(t.a)(ea,"FormulaAssistanceValuePreview",null,[332,2]);var ha=a(53),X=a(39);class T extends u.a{constructor(Ba){super();this.$=Ba;this.Mb()}static la(Ba){Ba.da.Ha(497,new T(Ba))}create(){let Ba=this.$.da.Aa(496);Ba&&this.vb(Ba);const qa=ha.GetServiceTaskFactory.Sa(this.$.da,
413,414,this.Na),pa=ha.GetServiceTaskFactory.Sa(this.$.da,448,449,this.Na),ya=ha.GetServiceTaskFactory.Sa(this.$.da,19,153,this.Na),za=ha.GetServiceTaskFactory.Sa(this.$.da,211,212,this.Na);X.TaskExtensions.za(X.TaskExtensions.Pd([qa,pa,ya,za],this.ka),()=>{Ba=this.$.da.Aa(496);Ba||(Ba=new ea(this.$,qa.result,pa.result,za.result),this.$.da.Ha(496,Ba));this.vb(Ba)},this.ka,3)}}Object(t.a)(T,"FormulaAssistanceValuePreviewFactory",u.a,[]);var ua=a(718),Ha=a(197),Ca=a(60);class Ga{constructor(Ba,qa){this.formulaAssistanceValuePreview=
qa;this.gridView=Object(w.h)(Ba)}Oc(){return!1}executeCommand(Ba,qa){Ba=!1;qa=qa.command;switch(qa){case -46938080:this.formulaAssistanceValuePreview.trigger(),Ba=!0}return Ba?Ca.Task.Ua(!0):Ha.a(qa)}Ac(Ba,qa){return-46938080===qa.command}Vc(){return!1}}Object(t.a)(Ga,"FormulaAssistanceValuePreviewCommandHandler",null,[233]);class sa extends ua.a{constructor(Ba){super(Ba)}Fd(){const Ba=ha.GetServiceTaskFactory.Sa(this.$.da,496,497,this.Na);X.TaskExtensions.za(Ba,()=>{this.qd([new Ga(this.$,Ba.result)])},
this.ka)}static la(Ba){ua.a.Yd(515,new sa(Ba))}}Object(t.a)(sa,"FormulaAssistanceValuePreviewCommandHandlerFactory",ua.a,[]);a.d(C,"a",function(){return bb});const bb=()=>{l.a.Fa(Ba=>{T.la(Ba);sa.la(Ba)})}},1229:function(t,C,a){t={};a.r(t);a.d(t,"CellAutoCompleteControl",function(){return Ha});var c={};a.r(c);a.d(c,"CellAutoCompleteReadoutHandler",function(){return Ba});var b=a(0),f=a(228),e=a(159),d=a(14),h=a(92),r=a(1126),l=a(9),u=a(804);class v{}v.yZd="suggested_cells_list_box";Object(b.a)(v,"CssElementIds",
null,[]);var x=a(7),w=a(1127);class m{constructor(za,cb){this.pxg=za;this.oxg=cb}get pia(){return this.pxg}get A1c(){return this.oxg}}Object(b.a)(m,"CellAutoCompleteItem",null,[557]);var n=a(6),z=a(950),y=a(391),A=a(45),F=a(1),D=a(23),B=a(21);class M extends z.a{constructor(za,cb,Pa){super(za,cb);this.cellAutoCompleteControl=null;this.$mc=0;this.D1=this.p$a=null;this.l7=(nb,Ma)=>{if(nb=this.cellAutoCompleteControl.items)if(1===nb.length&&this.cellAutoCompleteControl.X2a.length<nb[0].pia.length&&this.cellAutoCompleteControl.Dxa&&
D.a.rG(nb[0].pia,this.cellAutoCompleteControl.X2a)&&(Ma.newValue=nb[0].pia),this.Db&&F.EwaSettings.ya(128)){let Oa=-1;1<nb.length?Oa=this.cellAutoCompleteControl.Dfc(this.Db.text,!0):1===nb.length&&(this.cellAutoCompleteControl.Dxa||this.cellAutoCompleteControl.Ahc)&&(Oa=0);if(0<=Oa&&nb.length>Oa&&nb[Oa].A1c){const La=A.D(nb[Oa].A1c);La&&B.h(this.$).wb.Cya(La)&&(Ma.ckf=!0,Ma.FDe=nb[Oa].A1c)}}};this.EIb=()=>{this.cellAutoCompleteControl.Dxa=!1};this.Db.D_a(this.l7);this.cellAutoCompleteControl=Pa;
this.D1=this.De.ke(this.Db.textBox.domElement);this.D1.la("mousedown",this.EIb)}get bCb(){return!1}get KK(){return this.cellAutoCompleteControl.Ae}set KK(za){this.cellAutoCompleteControl.Ae=za}get z7a(){return!1}get key(){return y.a.g4c}dispose(){this.Db.CLb(this.l7);super.dispose()}jZ(za){za&&!this.cellAutoCompleteControl.Ae||super.jZ(za)}ai(za,cb){this.cellAutoCompleteControl.Db=this.Db;this.$mc=za.keyCode;if(this.Db.jb){const Pa=this.Db.text;D.a.equals(this.p$a,Pa,!1)||(this.p$a=Pa)}else this.p$a=
null;if(237279923===cb)return this.cellAutoCompleteControl.Ae=!1;F.EwaSettings.ya(128)&&17===this.$mc&&this.cellAutoCompleteControl.Dxa&&(this.cellAutoCompleteControl.Ahc=!0);return super.ai(za,cb)}nEd(){var za;if(!F.EwaSettings.isChangeGateEnabled("OfficeVSO:5172529_CheckForShuttingDownInAutocompletionTimedCallback")||!n.AFrameworkApplication.ug)if(this.cellAutoCompleteControl.Db=this.Db,this.cellAutoCompleteControl.Dxa=!1,this.Db.jb){const cb=!D.a.equals(this.p$a,this.Db.text,!0),Pa=this.Db.usd;
Pa||!cb&&229!==this.$mc?Pa&&(this.cellAutoCompleteControl.Ae&&(this.cellAutoCompleteControl.Ae=!1),null===(za=this.cellAutoCompleteControl.sPa)||void 0===za?void 0:za.cancel()):this.cellAutoCompleteControl.PXg(this.$mc)}else this.p$a=null}Ki(){}Wf(){this.KK=!1;this.cellAutoCompleteControl.set_visible(!1);this.p$a=null;this.cellAutoCompleteControl.Dxa=!1;this.cellAutoCompleteControl.Ahc=!1;this.cellAutoCompleteControl.sPa&&this.cellAutoCompleteControl.sPa.cancel()}MKd(za,cb){return this.cellAutoCompleteControl.ai(za,
cb)}}Object(b.a)(M,"CellAutoCompleteListAutoCompleteBehavior",z.a,[]);z=a(1128);var R=a(13),P=a(12),E=a(122);class H extends z.a{constructor(za,cb,Pa,nb){super(za,cb);this.Osa=this.cellAutoCompleteControl=null;this.Sb=Pa;this.cellAutoCompleteControl=nb;this.Sq=[]}get Tj(){return this.Osa}set Tj(za){this.bDa(this.Tj);this.Osa=za;const cb=this.bDa(this.Tj);this.qe=za?cb.innerText:null;this.fzc(za)}get Ae(){return super.Ae}set Ae(za){super.Ae=za;za||(this.Tj=null)}get nVa(){return null}get nIa(){return this.cellAutoCompleteControl}dispose(){super.dispose();
this.Osa=null}ODc(za){this.U8(!1);const cb=document.createElement("table");cb.classList.add(this.pda);cb.Hek=x.a.Rta;const Pa=document.createElement("tbody");for(let nb=0,Ma=this.Sq.length;nb<Ma;nb++){const Oa=document.createElement("tr"),La=document.createElement("td");La.classList.add(this.a0);const ra=document.createElement("span");ra.classList.add(H.h4c);ra.setAttribute(x.a.Kve,za[this.Sq[nb]].pia);ra.innerText=za[this.Sq[nb]].pia;La.appendChild(ra);Oa.appendChild(La);Pa.appendChild(Oa)}cb.appendChild(Pa);
this.Sb.cF(this.fg);this.fg.appendChild(cb);this.Sn=R.DOMElementExtensions.sk(this.domElement,this.pda);this.U8(!0);this.Cta()}rLa(za,cb){if(za&&za.length){var Pa=[];if(cb)for(let nb=0,Ma=za.length;nb<Ma;nb++)D.a.rG(za[nb].pia,cb)&&Pa.push(nb);this.Sq=Pa;this.ODc(za)}else this.Ae=!1,this.Osa=null}Fza(){}m4g(za,cb,Pa){let nb=Math.min(za,Math.max(200,Pa));cb&&za<Pa&&(nb+=E.a.Xu);R.DOMElementExtensions.iw(this.fg,nb);cb&&(nb-=E.a.Xu);return nb}Cta(){super.Cta();var za=R.DOMElementExtensions.sk(this.get_element(),
this.pda),cb=this.Sq.length>this.rI,Pa=B.h(this.$);if(Pa=Pa.Ob(Pa.ga.qa.activeCell))for(za=this.m4g(za.offsetWidth,cb,Pa.width),cb=this.fg.getElementsByClassName(H.h4c),Pa=0;Pa<cb.length;Pa++)cb[Pa].style.maxWidth=P.HelperMethods.Ic(za);else d.ULS.sendTraceTag(537167964,0,15,"CellAutoCompleteListBox.AdjustHeightAndWidth: Can't retrive FormattedCell of the Current Active Cell.")}onItemClick(za){if(za=super.onItemClick(za)){const cb=B.h(this.$);cb.Xo(!1);cb.focus()}return za}}H.h4c=u.a.TDh;Object(b.a)(H,
"CellAutoCompleteListBox",z.a,[]);var G=a(25),N=a(73),I=a(119),O=a(171),U=a(47),ca=a(37),Q=a(263),Y=a(19),la=a(157),ea=a(41),ha=a(70),X=a(109),T=a(53);const ua=`<div id='${v.yZd}' class='${u.a.Rac} ${Y.a.ms}' ></div>`;Object(la.b)(ea.i)(za=>Object(e.a)(void 0,void 0,void 0,function*(){var cb;const Pa=yield la.a.resolve(ea.u,za),nb=yield F.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigrateTableManager",!1)?la.a.resolve(ea.db,za):Object(X.e)(T.GetServiceTaskFactory.create(Pa.da,134,Pa.da.ka,
null!==(cb=null===za||void 0===za?void 0:za.rb)&&void 0!==cb?cb:0));cb=yield la.a.resolve(ea.j,za);const Ma=yield la.a.resolve(ea.F,za);return new Ha(Pa,nb,Ma,cb)}));class Ha extends r.a{constructor(za,cb,Pa,nb){super(za);this.MEa=null;this.f4c=[];this.f$d=null;this.Ahc=this.Dxa=!1;this.$fe=this.Cq=null;this.UQe=()=>{this.fZ.rLa(this.items,this.MEa);this.raiseEvent("ACLBUpdated",new w.a(this.items.length));this.show()};this.tableManager=cb;this.domElement.className=u.a.VTe;F.EwaSettings.isChangeGateEnabled("OfficeVSO:6296544_ReduceInnerHTMLUsage")&&
F.EwaSettings.isChangeGateEnabled("OfficeVSO:7141407_FilterDialog_InnerHtml_CleanUp")?(cb=document.createElement("div"),cb.classList.add(u.a.Rac),cb.classList.add(Y.a.ms),cb.id=v.yZd,this.domElement.appendChild(cb)):this.domElement.innerHTML=ua;R.DOMElementExtensions.setVisible(this.domElement,!1);Q.d(this.style,this.$.isChromeRtl);this.EDe=$get(v.yZd,this.domElement);this.fZ=new H(this.$,this.EDe,Pa,this);this.NUa(!0);this.$.domElement.appendChild(this.domElement);F.EwaSettings.isChangeGateEnabled("OfficeVSO:7616781_GetFormulaBarControlAsync")?
I.b(this.$,Ma=>{this.D0a(za,Ma)}):this.D0a(za,I.a(za));this.D0a(za,B.h(za).hc);this.hsi=F.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ChangeHandleKeyDownConditionOrder",!1);Object(ha.b)("OfficeVSO:7617240_migrate-CellAutoCompleteControl-new-service")&&nb.la(this)}H1b(za){this.addHandler("ACLBUpdated",za)}Swc(za){this.removeHandler("ACLBUpdated",za)}UY(za){this.addHandler("ACLBSelectionChanged",za)}h8(za){this.removeHandler("ACLBSelectionChanged",za)}sRg(za){this.addHandler("ACLBMatchedItem",
za)}eqj(za){this.removeHandler("ACLBMatchedItem",za)}get yu(){return this.fZ}get X2a(){return this.MEa}get qe(){return this.fZ.qe}get items(){return this.Cq}get sPa(){return this.$fe}get activeCell(){return B.h(this.$).ga.qa.activeCell}get dataValidationControl(){return this.f$d||(this.f$d=this.$.da.Aa(14))}Tfg(za){for(let cb=0;cb<za.length;cb++)if(D.a.isLetter(za.charCodeAt(cb)))return!0;return!1}oya(){return!this.items}dispose(){if(this.$){this.NUa(!1);const za=B.h(this.$);za&&za.view.hr(this.Crc)}h.a.wc([this.fZ,
this.sPa]);h.a.wc(this.f4c);this.f4c=this.EDe=this.fZ=this.Db=null;super.dispose()}ai(za,cb){let Pa=!1;if(this.NLj())switch(cb){case -798660877:if(1===this.items.length&&this.qe)break;this.yu.EB(1);this.raiseEvent("ACLBSelectionChanged",new w.a(this.items.length,this.Dfc(this.qe),this.qe));Pa=this.mz(!1);break;case 137938150:if(1===this.items.length&&this.qe)break;this.yu.EB(-1);this.raiseEvent("ACLBSelectionChanged",new w.a(this.items.length,this.Dfc(this.qe),this.qe));Pa=this.mz(!1);break;case 2091832999:this.yu.EB(this.rI-
1);Pa=this.mz(!1);break;case 742457698:this.yu.EB(-(this.rI-1));Pa=this.mz(!1);break;case 125627505:this.Db.textBox.caretPosition=this.Db.text.length;this.Ae=!1;Pa=!0;break;case 267796030:this.mz(!0);break;default:Pa=super.ai(za,cb)}return Pa}show(){this.items&&this.items.length&&(this.fZ.Tj=this.qe?this.yu.Sn.rows[this.Dfc(this.qe)]:null,this.Ae=0<this.fZ.Sq.length,this.uDa(!0),this.fZ.Fza())}PXg(za){const cb=!!this.Db&&!N.f(this.$.na);this.Ahc=this.Dxa=!1;this.Db&&!this.Db.jb?this.set_visible(!1):
cb&&!this.wnh(this.activeCell)&&this.DPj(za)}wnh(za){return!!this.dataValidationControl&&this.dataValidationControl.Gad(za)}mz(za){if(!this.Db||!this.Ae)return!1;const cb=this.MEa;if(this.qe){var Pa=R.DOMElementExtensions.$Z(R.DOMElementExtensions.sk(this.fZ.Tj,H.h4c),x.a.Kve,"");const nb=Pa.substring(cb.length,Pa.length);za?this.Db.text=Pa:this.Db.insertTextAt(nb,cb.length,this.Db.text.length)}Pa=B.h(this.$);Pa.am&&(Pa=Pa.hc,Pa.text=this.Db.text,Pa.setCaretPosition(this.Db.textBox.caretPosition));
za?this.Ae=!1:this.Db.textBox.selectRange(cb.length,this.Db.text.length);return!0}Dfc(za,cb=!1){if(!this.fZ.Sn)return-1;const Pa=this.fZ.Sn.children[0],nb=Pa.children.length;let Ma;for(let Oa=0;Oa<nb;++Oa)if(Ma=Pa.children[Oa],D.a.equals(Ma.innerText.trim(),za,cb))return Oa;return-1}uMg(za,cb,Pa,nb,Ma,Oa,La){const ra=Pa.originalText.replace(Ha.$Af,String.fromCharCode(32)),V=new G.Range(za.top-1,za.left,za.bottom-1,za.right,!1,!1),ma=La?La.aq(Pa.range):null;(!Pa.dI||Pa.range.left===za.left)&&1<ra.length&&
!nb.nb(ra.toUpperCase())&&D.a.rG(ra,cb)&&!D.a.equals(ra,cb,!0)&&!Ha.T_e(cb)&&this.Tfg(ra)&&(!Ma&&!ma||!Ma&&ma.equals(La.aq(V))||Ma&&Pa.range.xd(Oa)&&Pa.range.top!==Oa.top)&&(za=Pa.formulaBarText,D.a.equals(za,Pa.text,!1)||!za)&&(za={},za.FirstRow=Pa.range.top-1,za.FirstColumn=Pa.range.left-1,Pa=new m(ra,za),nb.add(ra.toUpperCase(),Pa))}DPj(za){this.Cq=this.v9h();this.sPa&&this.sPa.cancel();0<this.Db.text.length&&0!==za?this.items&&((1<this.items.length||this.Ae)&&this.buh(),8!==za&&127!==za&&46!==
za&&(1===this.items.length?this.Hpd(!1):this.fZ.Tj&&this.mz(!1))):this.Ae=!1}buh(){this.Ae?this.UQe():this.$fe=O.AsyncMethodContext.Oq(this.UQe,500,U.a.F6g,this.sPa)}Hpd(za){d.ULS.shipAssertTag(537167966,0,!this.oya()&&1===this.items.length,"Invalid Items");let cb=this.items[0].pia,Pa=this.Db.text,nb=cb.substring(Pa.length,cb.length);if(za&&!nb.length)this.Db.text=cb;else if(!za&&0<nb.length)this.Db.appendText(nb),this.Db.textBox.selectRange(Pa.length,this.Db.text.length);else return;this.raiseEvent("ACLBMatchedItem",
new w.a(this.items.length,0,cb));this.Dxa=!0}v9h(){this.Cq=null;const za=new ca.a(!1);var cb=this.activeCell;this.MEa=this.Db.text.replace(Ha.$Af,String.fromCharCode(32));const Pa=this.tableManager.aq(cb),nb=cb.xd(Pa);if(Ha.T_e(this.MEa)||!this.Tfg(this.MEa))return this.items;const Ma=new G.Range(1,cb.left,cb.top-1,cb.left,!1,!1);var Oa=new G.Range(cb.top+1,cb.left,l.a.Fg,cb.left,!1,!1);let La;const ra=B.h(this.$);Oa=ra.dk("CellAutoCompleteControl.GetSuggestedCells",Oa);try{const V=ra.dk("CellAutoCompleteControl.GetSuggestedCells2",
Ma);try{for(const ma of[V,Oa])for(;ma.$$mn();)La=ma.$$cu(),this.uMg(cb,this.MEa,La,za,nb,Pa,this.tableManager)}finally{V&&V.dispose()}}finally{Oa&&Oa.dispose()}this.Cq=Array(za.values.length);for(cb=0;cb<this.items.length;cb++)this.items[cb]=za.values[cb];this.items.sort((V,ma)=>V.pia.localeCompare(ma.pia));return this.items}D0a(za,cb){za&&cb&&this.f4c.push(new M(za,cb,this))}NLj(){return this.hsi?this.X2a&&!this.oya()&&this.Ae?this.get_visible():!1:this.X2a&&!this.oya()&&this.get_visible()&&this.Ae}static get $Af(){return Ha.Khe||
(Ha.Khe=new RegExp(String.fromCharCode(160),"g"))}static T_e(za){za=0<za.length?za.charCodeAt(0):-1;return 35===za||61===za||43===za||45===za||64===za}}Ha.Khe=null;Object(b.a)(Ha,"CellAutoCompleteControl",r.a,[530,531,532,2]);var Ca=a(39),Ga=a(721);class sa extends f.a{constructor(za){super();this.$=za;this.Mb()}create(){const za=this.$.da,cb=F.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigrateTableManager",!1)?Object(X.d)(la.a.resolve(ea.db,{rb:this.Na})):T.GetServiceTaskFactory.create(za,
134,this.ka,this.Na),Pa=T.GetServiceTaskFactory.Sa(za,213,214,this.Na),nb=Object(X.d)(la.a.resolve(ea.F,{rb:this.Na}));Ca.TaskExtensions.za(Ca.TaskExtensions.Pd([cb,Pa,nb],this.ka),()=>{this.vb(Object(Ga.a)(this.$.da,1,()=>{const Ma=new Ha(this.$,cb.result,nb.result,void 0);Pa.result.la(Ma);return Ma}))},this.ka,3)}static la(za){za.da.Ha(151,new sa(za))}}Object(b.a)(sa,"CellAutoCompleteControlFactory",f.a,[]);var bb=a(15);r=a(472);let Ba=class{constructor(za){this.L0a=null;this.pKf=(cb,Pa)=>{1<Pa.length&&
(cb=bb.a.instance.ha(858),this.ariaLiveNotifier.RVf(cb,Pa.length))};this.qKf=(cb,Pa)=>{d.ULS.shipAssertTag(537167961,0,0<=Pa.selectedIndex&&0<=Pa.length&&Pa.selectedIndex<Pa.length,"Invalid ListEventArgs: SelectedIndex/Length");d.ULS.shipAssertTag(537167960,0,!!Pa.nG,"ListEventArgs: SelectedValue should not be null");this.ariaLiveNotifier.Yij(Pa.nG,Pa.selectedIndex+1,Pa.length)};this.rKf=(cb,Pa)=>{this.ariaLiveNotifier.QRa(Pa.nG)};this.ariaLiveNotifier=za}dispose(){this.Q1d();this.L0a=null}la(za){za&&
(this.L0a=za,za.H1b(this.pKf),za.UY(this.qKf),za.sRg(this.rKf))}Q1d(){this.L0a&&(this.L0a.Swc(this.pKf),this.L0a.h8(this.qKf),this.L0a.eqj(this.rKf))}};Ba=Object(e.b)([Object(la.d)(ea.j),Object(e.c)(0,Object(r.AriaLiveNotifierService)())],Ba);Object(b.a)(Ba,"CellAutoCompleteReadoutHandler",null,[528,2]);class qa extends f.a{constructor(za){super();this.$=za;this.Mb()}create(){const za=this.$.da;Ca.TaskExtensions.za(T.GetServiceTaskFactory.Sa(za,211,212,this.Na),cb=>{this.vb(Object(Ga.a)(za,213,()=>
new Ba(cb.result)))},this.ka,3)}static la(za){za.da.Ha(214,new qa(za))}}Object(b.a)(qa,"CellAutoCompleteReadoutHandlerFactory",f.a,[]);var pa=a(10);a.d(C,"a",function(){return ya});const ya=()=>{Object(ha.b)("OfficeVSO:7617240_migrate-CellAutoCompleteControl-new-service")||(pa.a.Fa(sa.la),pa.a.Fa(qa.la))};String(t);String(c);window.___1680632999835_closurehack=t;window.___1680632999835_closurehack=c},1258:function(t,C,a){var c=a(10);t=a(0);var b=a(228),f=a(14),e=a(198);const d={selectByArrowKeyCounter:0,
selectByMouseHoverCounter:0,commitByTabKeyCounter:0,commitByEnterKeyCounter:0,commitByMouseClickCounter:0,commitWhileRequestPending:0,dismissSmartSuggestionExplicitlyCounter:0,dismissSmartSuggestionImplicitlyCounter:0},h={formulaAssistanceRequestAttemptedCounter:0,formulaAssistanceRequestOptimizedCounter:0},r={argumentAssistanceCardInitialMode:void 0,argumentAssistanceCollapseCounter:0,argumentAssistanceExpandCounter:0,argumentAssistanceLearnMoreCounter:0,argumentAssistanceDragCounter:0,argumentAssistanceDragTotalCounter:0,
argumentAssistanceMoveCounter:0,argumentAssistanceMoveTotalCounter:0,argumentAssistanceCardIsInitialModeDefault:!1},l={smartSuggestionShownCounter:0,smartSuggestionSelectedCounter:0,smartSuggestionCommittedCounter:0,smartSuggestionKeptCounter:0,smartSuggestionChangedCounter:0,smartSuggestionDeletedCounter:0,isCellContentOnlyEqualDuringEditCounter:0,isCellContentFormulaCounter:0,smartSuggestionWouldSuggestInsidePivotCounter:0},u={parenthesesCouplingCounter:0,formulaHighlightsCounter:0},v={dialogCommitedCounter:0,
dialogShownCounter:0,argsDialogOpenedByRibbonCounter:0,argsDialogOpenedByDialogCounter:0,argsDialogCommitedCounter:0},x={argumentAssistanceFlight:void 0,autoCompleteUIFlight:void 0,smartFormulaBarAutoCompletePluginFlight:void 0,anyPluginInitialized:void 0,formulaAssistanceRedesignFlight:void 0,NewInsertFunctionDialogFlight:void 0,smartFormulaSuggestionsFeatureEnabled:void 0,parenthesesCouplingFlight:void 0,coloredReferencesFlight:void 0,uILocale:void 0,dataLocale:void 0,country:void 0,FormulaAssistanceUiPositionFlight:void 0,
FormulaAssistanceIndentedRenderFlight:void 0,FormulaAssistanceDragCursorFlight:void 0};var w;(function(I){I.RenderDown="rd";I.RenderUp="ru";I.Expand="e";I.Collapse="c";I.Drag="d";I.Move="m";I.GiveFeedback="gf";I.InitialModeExpanded="ie";I.InitialModeCollapsed="ic";I.LearnMore="lm"})(w||(w={}));Object(t.b)("argumentAssistanceUsageActions",w);var m=a(59),n=a(1129),z=a(1),y=a(23),A=a(42),F=a(21),D=a(105),B;(function(I){I[I.function=3]="function";I[I.namedRange=100]="namedRange";I[I.tableHeader=101]=
"tableHeader";I[I.letVariable=102]="letVariable";I[I.richEntity=103]="richEntity";I[I.lambda=104]="lambda";I[I.customFunction=105]="customFunction";I[I.table=106]="table";I[I.tableSpecialStructRef=107]="tableSpecialStructRef";I[I.richEntityEmptyCellRef=108]="richEntityEmptyCellRef";I[I.rangeRef=109]="rangeRef"})(B||(B={}));Object(t.b)("CompletionItemKind",B);var M=a(33),R=a(783),P=a(954);const E={["argumentAssistanceOverall"]:[50,80,100,130,150,170,200],["autoCompleteOverall"]:[50,80,100,130,150,
170,200],["autoCompleteOverallSimpleAndSmart"]:[50,80,100,130,150,170,200],["autoCompleteOverallSmartOnly"]:[50,80,100,130,150,170,200],["autoCompleteOverallSimpleOnly"]:[50,80,100,130,150,170,200],["tryUpdateHighlightsFromCellContentEditor"]:[50,80,100,130,150,170,200]};class H{constructor(I){this.$=I;this.PF=null;this.PEb=-1;this.snc=null;this.Gxd=this.REb=0;this.XP=Object.assign({},r);this.pD=Object.assign({},l);this.UJ=Object.assign({},d);this.srb=Object.assign({},h);this.$cc=Object.assign({},
u);this.YI=Object.assign({},x);this.trb={};this.n5a=Object.assign(Object.assign({},v),{isReactDialog:M.a.Ptd()});this.Vqb=[];this.gIa=z.EwaSettings.isChangeGateEnabled("OfficeVSO:7376612_argumentAssistanceOrderedActionsTelemetry");this.QJa={};this.Wf=(O,U)=>{null!=this.PF&&(1==Math.abs(this.PEb-this.$.ea.Ee)&&(O=this.$.ua.na.sheetId,U.u2a&&U.Hk.equals(this.PF.Hk)&&this.snc===O&&this.PF.r5b!==U.r5b&&this.REb++),1<=Math.abs(this.PEb-this.$.ea.Ee)&&(this.PF=null,this.PEb=-1,this.snc=null));0<Object.keys(this.QJa).length&&
(f.ULS.sendTraceTag(509658956,0,50,`FormulaAssistanceTelemetryManager.onEditEnded: current edit's completion items data: ${JSON.stringify(this.QJa)}`),this.QJa={})};this.Dc=(O,U)=>{U.Sf||U.vsd||(this.X9f(),this.VHj(),this.$.sendBeaconTraceTag(88392384,50,!1,"{0}",this.getJsonForLogging()))};this.hcb=new D.a;I.wj(this.Dc);F.h(this.$).Ih.Bm(this.Wf);z.EwaSettings.isChangeGateEnabled("OfficeVSO:7694120_FormulaAssistanceTelemetrySessionDetails")&&this.X9f();this.LJi()}dispose(){this.$&&F.h(this.$).Ih.km(this.Wf)}gE(I){I.forEach(O=>
{this.hcb.nb(O)||this.hcb.ia(O,new n.a(E[O]));this.hcb.ma(O).EUa()})}Hv(I,O=!0){I.forEach(U=>{this.hcb.nb(U)&&this.hcb.ma(U).P4(O)})}t7f(I){this.MJ(0===I?"ie":"ic")}eDj(I){this.MJ(I?"ie":"ic")}s7f(){this.XP.argumentAssistanceCardIsInitialModeDefault=!0}Cva(I){window.requestAnimationFrame(()=>{this.Hv([I])})}G0f(I){I.forEach(O=>{O=B[O.kind];this.hqg(O);this.trb[O].shownCounter++;this.QJa[O].shownCounter++})}F0f(I){I=B[I];this.hqg(I);this.trb[I].committedCounter++;this.QJa[I].committedCounter++}MJ(I){if(this.gIa){const O=
this.Vqb.length;0===O||this.Vqb[O-1][0]!==I?this.Vqb.push([I,1]):this.Vqb[O-1][1]++}else switch(I){case "e":this.XP.argumentAssistanceExpandCounter++;break;case "c":this.XP.argumentAssistanceCollapseCounter++;break;case "d":this.XP.argumentAssistanceDragCounter++;break;case "m":this.XP.argumentAssistanceMoveCounter++;break;case "lm":this.XP.argumentAssistanceLearnMoreCounter++;break;case "ie":this.XP.argumentAssistanceCardInitialMode="Expanded";break;case "ic":this.XP.argumentAssistanceCardInitialMode=
"Collapsed"}}LJi(){z.EwaSettings.isChangeGateEnabled("OfficeVSO:7694120_FormulaAssistanceTelemetrySessionDetails")&&f.ULS.sendTraceTag(509140996,0,50,`FormulaAssistanceTelemetryManager.SessionDetails: ${m.a.Fc(this.YI)}`)}getJsonForLogging(){return"{"+this.IM("SessionDetails",this.YI)+","+this.IM("ArgumentAssistanceUsage",this.XP)+","+this.IM("argumentAssistanceOrderedActions",this.Vqb)+","+this.IM("FormulaSuggestionsUsage",this.pD)+","+this.IM("FunctionDialogUsage",this.n5a)+","+this.IM("AutocompleteCardInteraction",
this.UJ)+","+this.IM("AutocompleteRenderOptimization",this.srb)+","+this.IM("AutocompleteUsageByKind",this.trb)+","+this.IM("FormulaHighlightsUsage",this.$cc)+","+this.a8h()+"}"}VHj(){this.pD.smartSuggestionChangedCounter=this.REb;this.pD.smartSuggestionDeletedCounter=this.Gxd;this.pD.smartSuggestionKeptCounter=this.pD.smartSuggestionCommittedCounter-this.REb-this.Gxd;for(let I=0;I<this.pD.smartSuggestionKeptCounter;I++)Object(R.b)(P.b)}X9f(){this.YI.argumentAssistanceFlight=this.fca("Microsoft.Office.ExcelOnline.",
"ArgumentAssistancePlugin");this.YI.autoCompleteUIFlight=this.fca("Microsoft.Office.Excel.","AutoCompleteNewUI");this.YI.smartFormulaBarAutoCompletePluginFlight=this.fca("Microsoft.Office.Excel.","SmartFormulaBarAutocompleteIsEnabled");this.YI.formulaAssistanceRedesignFlight=this.fca("Microsoft.Office.Excel.","FormulaAssistanceRedesign");this.YI.NewInsertFunctionDialogFlight=this.fca("Microsoft.Office.Excel.","NewInsertFunctionDialog");this.YI.coloredReferencesFlight=this.fca("Microsoft.Office.Excel.",
"ColoredReferences");this.YI.parenthesesCouplingFlight=this.fca("Microsoft.Office.Excel.","ParenthesesCoupling");this.YI.FormulaAssistanceUiPositionFlight=this.fca("Microsoft.Office.Excel.","FormulaAssistanceUiPosition");this.YI.FormulaAssistanceIndentedRenderFlight=this.fca("Microsoft.Office.Excel.","FormulaAssistanceIndentedRender");this.YI.FormulaAssistanceDragCursorFlight=this.fca("Microsoft.Office.Excel.","ChangeArgumentAssistanceDragCursorToMove");this.YI.smartFormulaSuggestionsFeatureEnabled=
M.a.Nca(this.$);this.YI.uILocale=this.$.pDa;this.YI.dataLocale=this.$.dataCultureTag;this.YI.country=JSON.parse(this.$.xa.SessionStartInfoJson).LocationCountry}a8h(){const I=new e.a;for(let O of this.hcb)O.value.j_e(),I.add(`"${O.key}":${m.a.Fc(O.value.LW)}`);return`"PerfMeasurements": {${I.toArray().join(",")}}`}fca(I,O){return y.a.contains(this.$.xa.FlightHolder.FlightId,O,!0)?z.EwaSettings.getBooleanFeatureGate(I+O,!1)?"T":"C":"None"}IM(I,O){return`"${I.toString()}":${A.c(O)}`}hqg(I){this.trb[I]||
(this.trb[I]={shownCounter:0,committedCounter:0});this.QJa[I]||(this.QJa[I]={shownCounter:0,committedCounter:0})}}Object(t.a)(H,"FormulaAssistanceTelemetryManager",null,[535]);class G extends b.a{constructor(I){super();this.$=I;this.Mb()}static la(I){I.da.Ha(492,new G(I))}create(){var I;this.vb(null!==(I=this.$.da.Aa(491))&&void 0!==I?I:this.$.da.Ha(491,new H(this.$)))}}Object(t.a)(G,"FormulaAssistanceTelemetryManagerFactory",b.a,[]);a.d(C,"a",function(){return N});const N=()=>{c.a.Fa(I=>{G.la(I)})}},
1274:function(t,C,a){function c(ca){if(ca){var Q=new u(ca.IsRangeRef);Q.KF=ca.IsAbsoluteFirstRow;Q.JF=ca.IsAbsoluteFirstColumn;Q.JK=ca.IsAbsoluteSecondRow;Q.IK=ca.IsAbsoluteSecondColumn;return Q}}function b(ca){var Q;if(ca){var Y=new u(0===ca.kind);ca=null===(Q=null===ca||void 0===ca?void 0:ca.rangeInfo)||void 0===Q?void 0:Q.positionKindInfo;if(!ca)return Y;Y.KF=0===ca.firstRow;Y.JF=0===ca.firstColumn;Y.JK=0===ca.secondRow;Y.IK=0===ca.secondColumn;return Y}}t=a(0);var f=a(228),e=a(2),d=a(14),h=a(89),
r=a(7),l=a(331);class u{constructor(ca){this.IK=this.JK=this.JF=this.KF=!1;this.N_=ca}}Object(t.a)(u,"MarqueeRangeData",null,[]);class v{constructor(ca,Q,Y,la=!1){this.E_d=ca;this.OQb=Q;this.b9a=la;Y?(this.N_=Y.N_,this.KF=Y.KF,this.JF=Y.JF,this.JK=Y.JK,this.IK=Y.IK):d.ULS.shipAssertTag(524039642,0,!1,"MarqueeMetadata.Ctor: rangeData is null")}}Object(t.a)(v,"MarqueeMetadata",null,[]);var x=a(45),w=a(150),m=a(37),n=a(1),z=a(23),y=a(591),A=a(21),F=a(186),D=a(353),B=a(33),M=a(564),R=a(953);const P="rgba(95, 140, 237, {0});rgba(235, 94, 96, {0});rgba(141, 97, 194, {0});rgba(45, 150, 57, {0});rgba(191, 76, 145, {0});rgba(227, 130, 34, {0});rgba(55, 127, 158, {0})".split(";");
class E{constructor(ca,Q){this.UH=this.Jgb=this.Uvf=!1;this.Y9=null;this.EOa=n.EwaSettings.EOa();this.k7=()=>{this.UH=!1};this.kd=ca;this.gridView=A.h(ca);this.calcManager=Q;this.xjf=n.EwaSettings.ya(595);this.aI=B.a.aI(ca);this.gridView.hc.Bm(this.k7)}get formulaAssistanceManager(){this.Y9||(this.Y9=this.kd.da.Aa(464));return this.Y9}get formulaAssistanceTelemetryManager(){this.nFa||(this.nFa=this.kd.da.Aa(491));return this.nFa}kE(ca,Q){ca.textBox.addEventLogRecord("ColoredReferencesManager.TryUpdateColoredReferences");
if(this.Jgb||ca.CD)return!1;const Y=void 0===Q||null===Q?ca.text:Q;if(this.calcManager&&1<Y.length&&F.f(Y)){var la=this.cla(),ea=this.E8e(),ha=this.kd.workbookContext.WorkbookFileName;let X=!1;const T=.01>Math.random()?Object(h.a)(w.a,this.kd.Rb.Qc("LoadingUIShown","ColoredReferencesManager")):null;try{const ua=this.calcManager.extractReferences(Y,ea,ha,!this.xjf);if(!ua)return d.ULS.sendTraceTag(524039689,0,50,"ColoredReferencesManager.UpdateColoredReferences: extractReferences is null (might be an invalid formula)"),
!1;ea=[];ha=[];const Ha=[],Ca=[];let Ga=0,sa=0;const bb=new m.a(!1);let Ba="";for(const pa of ua.Items)if(X=pa.IsStructRef||X,pa.IsBoolean||pa.IsNumber||pa.IsString){const ya=pa.IsBoolean?"rgba(0, 0, 255, 1)":pa.IsNumber?"rgba(9, 134, 88, 1)":"rgba(163, 21, 21, 1)";this.KE(ha,Y,Ga,pa.Span.Start,null);this.KE(ha,Y,pa.Span.Start,pa.Span.End,ya);Ga=pa.Span.End}else if(n.EwaSettings.ya(512)){if(pa.Range||pa.LetName&&0<=pa.LetNumber){let ya=null;if(pa.Range){let cb=x.E(pa.Range);ya=this.c_(cb,bb,1);ea.push(new D.a(cb,
la))}else pa.LetName&&0<=pa.LetNumber&&(ya=Ba=this.qWh(pa.LetName,pa.LetNumber,bb,Ba),sa!==bb.count&&ca.colors.add(pa.Span.Start+"-"+pa.Span.End,P[(bb.count-1)%P.length]));this.KE(ha,Y,Ga,pa.Span.Start,null);this.KE(ha,Y,pa.Span.Start,pa.Span.End,ya);Ga=pa.Span.End;Ha.push(pa.Span);let za=ha.length-1;Ca.push(new v(za,ha[za].text,c(pa)));sa=bb.count}}else if(pa.Range){let ya=x.E(pa.Range),za=this.c_(ya,bb,1);this.KE(ha,Y,Ga,pa.Span.Start,null);this.KE(ha,Y,pa.Span.Start,pa.Span.End,za);ea.push(new D.a(ya,
la));Ga=pa.Span.End;Ha.push(pa.Span);let cb=ha.length-1;Ca.push(new v(cb,ha[cb].text,c(pa)))}this.formulaAssistanceTelemetryManager?0<ua.Items.length&&this.formulaAssistanceTelemetryManager.$cc.formulaHighlightsCounter++:this.loc("ColoredReferencesManager.tryUpdateColoredReferences: FormulaAssistanceTelemetryManager unavailable");this.KE(ha,Y,Ga,Y.length,null);this.MAc(ca,ha,!!Q);const qa=ca.textBox.text;if(!z.a.equals(qa,Y,!1)){d.ULS.shipAssertTag(38114182,0,!1,`ColoredReferencesManager.UpdateColoredReferences: The text we created is different from the original text. Setting the original text back. currentTextLength [${qa.length}], originalTextLength [${Y.length}]`);
let pa=ca.textBox.caretPosition;ca.textBox.text=Y;ca.textBox.caretPosition=pa;return!0}this.Iz(ea,bb,Ca);n.EwaSettings.ya(512)&&0<ea.length&&d.ULS.sendTraceTag(524039688,0,50,"ColoredReferencesManager.UpdateColoredReferences: Cell reference(s) colored");n.EwaSettings.ya(512)&&0<ca.colors.count&&d.ULS.sendTraceTag(524039687,0,50,"ColoredReferencesManager.UpdateColoredReferences: Let name(s) colored");return this.UH=!0}finally{T&&T.DCa(()=>{X&&d.ULS.sendTraceTag(524039686,0,50,`ColoredReferencesManager.UpdateColoredReferences: Formula with structured reference is highlighted in ${T.Jc} ms`)})}}else return this.Iz(null,
null),this.UH&&(this.UH=!1,this.EOa||(la=ca.textBox.caretPosition,ca.textBox.setPlainText(Y),ca.textBox.caretPosition=Math.min(la,Y.length)),Q)?!0:!1}Ehb(ca,Q,Y){if(this.Jgb||ca.CD)return!1;const la=isNullOrUndefined(Q)?ca.text:Q;var ea=[];const ha=new m.a(!1);if(1<la.length&&Object(M.b)(Y)){const T=[],ua=[],Ha=[];var X=0;const Ca=this.cla();for(const Ga of Y.formulaHighlights){this.KE(T,la,X,Ga.span.start,null);switch(Ga.kind){case 0:case 1:case 2:Y=x.C(Ga.rangeInfo.sharedRange);if(isNullOrUndefined(Y)){d.ULS.sendTraceTag(521211937,
0,10,`ColoredReferencesManager.tryUpdateFormulaHighlights: Received formula highlight with undefined range, HighlightKind:${Ga.kind.toString()},`);this.KE(T,la,Ga.span.start,Ga.span.end,null);break}X=this.c_(Y,ha,1);this.KE(T,la,Ga.span.start,Ga.span.end,X);ea.push(new D.a(Y,Ca));ua.push({Start:Ga.span.start,End:Ga.span.end});Y=T.length-1;Ha.push(new v(Y,T[Y].text,b(Ga)));break;case 3:this.KE(T,la,Ga.span.start,Ga.span.end,null,"rgba(229, 229, 229, 1)")}X=Ga.span.end}this.KE(T,la,X,la.length);this.MAc(ca,
T,!!Q);Q=ca.textBox.text;if(!z.a.equals(Q,la,!1))return d.ULS.shipAssertTag(521211936,0,!1,`ColoredReferencesManager.UpdateFormulaHighlights: The text we created is different from the original text. Setting the original text back. currentTextLength [${Q.length}], originalTextLength [${la.length}]`),Q=ca.textBox.caretPosition,ca.textBox.text=la,ca.textBox.caretPosition=Q,!0;this.Iz(ea,ha,Ha);return this.UH=!0}this.Iz(null,null);return this.UH&&(this.UH=!1,this.EOa||(ea=ca.textBox.caretPosition,ca.textBox.setPlainText(la),
ca.textBox.caretPosition=Math.min(ea,la.length)),Q)?!0:!1}yGb(ca,Q,Y){if(!ca||!Q||!Y)return d.ULS.shipAssertTag(524039685,0,!!ca,"ColoredReferencesManager.MoveMarqueeRange: cellContentEditor is null"),d.ULS.shipAssertTag(524039684,0,!!Q,"ColoredReferencesManager.MoveMarqueeRange: highlightState is null"),d.ULS.shipAssertTag(524039683,0,!!Y,"ColoredReferencesManager.MoveMarqueeRange: newRange is null"),!1;const la=Object(h.a)(v,Q.metadata);if(!la)return d.ULS.shipAssertTag(524039682,0,!1,"ColoredReferencesManager.MoveMarqueeRange: marqueeMetadata is null"),
!1;var ea=la.E_d,ha=la.OQb,X=this.gridView.wb.xsd(Y)?Y.kyb(la.JF,la.KF):Y.uMa(la.JF,la.KF,la.IK,la.JK);if(!X)return d.ULS.shipAssertTag(524039681,0,!1,"ColoredReferencesManager.MoveMarqueeRange: newText is null"),!1;const T=ha.indexOf("!");-1!==T&&(X=ha.substring(0,T+1)+X);if(!ca.textBox.changeTextInExistingTextPart(ea,ha,X))return d.ULS.shipAssertTag(38926105,0,!1,"ColoredReferencesManager.MoveMarqueeRange: failed to change the text part"),!1;la.OQb=X;ea=!0;for(ha=1;4>=ha;ha++)(X=A.h(this.kd).Jb.rD(3,
ha,Q.BU))?(X.range=Y,X.metadata=la):(d.ULS.shipAssertTag(524039680,0,!1,"ColoredReferencesManager.MoveMarqueeRange: highlightStateInPane is null"),ea=!1);this.gridView.Jb.update(!1,!1);this.gridView.am&&(this.gridView.cellTextEditBox.textBox.text=ca.text);this.gridView.cellTextEditBox.MRa(new l.a({eCb:!0}));return ea}vwi(ca){if(3!==ca.Vq)return d.ULS.shipAssertTag(524039651,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: not HighlightDivIndex.Marquee."),!1;ca=Object(h.a)(v,ca.metadata);
return ca?ca.N_&&!ca.b9a:(d.ULS.shipAssertTag(524039650,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: marqueeMetadata is null."),!1)}ICa(ca,Q){d.ULS.sendTraceTag(524039649,0,50,"ColoredReferencesManager.SuspendResumeColoredReferences: "+(Q?"suspending":"resuming")+" colored references");Q&&this.UH&&(this.UH=!1,this.Iz(null,null),ca.textBox.mFe());this.Jgb=Q}dispose(){this.gridView&&this.gridView.hc&&this.gridView.hc.km(this.k7)}AAb(ca){const Q=this.formulaAssistanceTelemetryManager;Q||
this.loc("ColoredReferencesManager.highlightPreviewRanges: Failed to log highlightPreviewRanges measurement, FormulaAssistanceTelemetryManager unavailable");null===Q||void 0===Q?void 0:Q.gE(["highlightPreviewRanges"]);this.aI?this.rii(ca):this.qii(ca);null===Q||void 0===Q?void 0:Q.Hv(["highlightPreviewRanges"],!0)}rii(ca){var Q=this.formulaAssistanceManager.$5a(ca,R.a);if(isNullOrUndefined(Q))this.Iz(null,null);else{var Y=this.cla(),la=[],ea=new m.a(!1),ha=[];Q=Q.formulaHighlights;for(const X of Q)if(Q=
X.kind,0===Q||2===Q||1===Q)Q=x.C(X.rangeInfo.sharedRange),Object(M.b)(Q)&&(la.push(new D.a(Q,Y)),this.c_(Q,ea,1),ha.push(new v(X.span.start,ca.substring(X.span.start,X.span.end),b(X),!0)));this.Iz(la,ea,ha)}}qii(ca){const Q=this.cla();var Y=this.E8e();const la=this.kd.workbookContext.WorkbookFileName,ea=[],ha=new m.a(!1),X=[];if(Y=this.calcManager.extractReferences(ca,Y,la,!this.xjf)){for(const T of Y.Items)T.Range&&(Y=x.E(T.Range),ea.push(new D.a(Y,Q)),this.c_(Y,ha,1),X.push(new v(T.Span.Start,ca.substring(T.Span.Start,
T.Span.End),c(T),!0)));this.Iz(ea,ha,X)}else this.Iz(null,null)}c_(ca,Q,Y){let la=Q.getItem(ca.toString());la||(la=P[Q.count%P.length],Q.add(ca.toString(),la));return String.format(la,Y)}qWh(ca,Q,Y,la){ca="["+ca+", "+Q+"]";Q=Y.getItem(ca);Q||(Q=Y.count%P.length,Q=P[Q],la===String.format(Q,1)&&(Y.add("skip-"+ca,Q),Q=Y.count%P.length,Q=P[Q]),Y.add(ca,Q));return String.format(Q,1)}KE(ca,Q,Y,la,ea=null,ha=null){d.ULS.shipAssertTag(524039648,0,Y<=la,"ColoredReferencesManager.AddTextPart: startIndex cannot be larger than endIndex");
Y<la&&(Q=Q.substring(Y,la),ca.push(Object(e.a)(new y.a,{text:Q,color:ea,backgroundColor:ha})))}Iz(ca,Q,Y=null){ca&&ca.length?(d.ULS.sendTraceTag(524039647,0,50,"ColoredReferencesManager.HighlightRanges: number of ranges to highlight: "+ca.length),ca.reverse(),Y.reverse(),this.gridView.Jb.pA(ca,[3],!0,(la,ea)=>{if(la&&la.range&&ea){d.ULS.shipAssertTag(524039643,0,Q.nb(la.range.toString()),`ColoredReferencesManager.HighlightRanges: The range '${la.range.toString()}' doesn't exist in the range to color dictionary`);
var ha=this.c_(la.range,Q,.1),X=this.c_(la.range,Q,1);this.kd.frame&&this.kd.frame.xD&&this.kd.frame.xD.sN||(ea.style.background=ha);ea.style.borderColor=X;Y&&(ea.setAttribute(r.a.B7a,la.BU.toString()),la.metadata=Y[la.BU])}else d.ULS.shipAssertTag(524039646,0,!!la,"ColoredReferencesManager.HighlightRanges: state is null"),d.ULS.shipAssertTag(524039645,0,!!la.range,"ColoredReferencesManager.HighlightRanges: state.Range is null"),d.ULS.shipAssertTag(524039644,0,!!ea,"ColoredReferencesManager.HighlightRanges: div is null")})):
(ca=this.kd.Rb.Qc("UserAction","HideRangesHighlightsStopwatch"),this.gridView.Jb.ik([3]),this.gridView.Jb.CTa(new D.a(null,this.cla()),[3]),ca.stop())}MAc(ca,Q,Y){const la=ca.textBox;la.DF=!0;var ea=la.selection;const ha=ea.index;ea=ha+ea.length;la.setTextFromTextParts(Q);Q=la.text.length;la.selectRange(Math.min(ha,Q),Math.min(ea,Q));Y&&ca.MRa(new l.a);la.DF=!1}loc(ca){this.Uvf||(d.ULS.sendTraceTag(521211935,0,50,ca),this.Uvf=!0)}cla(){return this.gfc().sheetId}E8e(){return this.gfc().sheetName}gfc(){return this.gridView.fr&&
this.gridView.fr.bG?this.gridView.fr.bG:this.kd.na}}Object(t.a)(E,"ColoredReferencesManager",null,[542,2]);var H=a(157),G=a(41),N=a(721);class I extends f.a{constructor(ca){super();this.$=ca;this.Mb()}create(){n.EwaSettings.LF()?void H.a.resolve(G.g,{rb:this.Na}).then(ca=>{const Q=Object(N.a)(this.$.da,281,()=>new E(this.$,ca));this.vb(Q)}):this.$.da.kb(266,ca=>{ca=this.$.da.Aa(281)||this.$.da.Ha(281,new E(this.$,ca));this.vb(ca)})}static la(ca){ca.da.Ha(282,new I(ca))}}Object(t.a)(I,"ColoredReferencesManagerFactory",
f.a,[]);var O=a(10);a.d(C,"a",function(){return U});const U=()=>{O.a.Fa(I.la)}},1287:function(t,C,a){t=a(0);var c=a(353),b=a(986),f=a(14);class e{constructor(m){this.jB=m;this.I4b=new Map}P3(m){return this.h4h(m.sheetId).P3(m)}Mec(m){const n=this.I4b.get(m.sheetId);return n?n.Mec(m.range):null}oph(m){const n=this.I4b.get(m.sheetId);return n?n.u3a(m):!1}h4h(m){let n=this.I4b.get(m);n||(n=new d(this.jB),this.I4b.set(m,n));return n}}Object(t.a)(e,"FormulaByExampleRangeSuggestionsCache",null,[]);class d extends b.c{constructor(m){super();
this.jB=m}P3(m){const n=this.Eng(m);if(n)return n;this.u3a(m);this.jB.r1(m.originCell,3);return super.P3(m)}Kyb(m){return this.Mec(m.range)}Mec(m){var n;f.ULS.shipAssertTag(509383498,306,m.jW,"FormulaByExampleRangeSuggestionsCache.getIntersectingSuggestion: lookup range must be of single column width.");return null===(n=this.get(m.left))||void 0===n?void 0:n.find(z=>z.suggestion.range.xd(m))}Owa(m){return m.range.left}Eng(m){const n=this.Kyb(m);return n&&n.suggestion.y1e===m.y1e?this.e3d(n,m):null}}
Object(t.a)(d,"ColumnBasedRangeSuggestionsCache",b.c,[]);var h=a(1132);class r extends b.a{constructor(m,n){super();this.calcManager=m;this.jB=n}P3(m){var n;let z=!1;const y=super.Kyb(m);if(!y||(z=y.suggestion.formula!==m.formula))return z&&f.ULS.sendTraceTag(523842004,306,20,`FormulaByExampleSuggestionsCache.cacheSuggestion: formula changed from last cache entry, overriding cache entry.
           Last example count: ${y.suggestion.py}, current: ${m.py}, oldFormula: ${y.suggestion.anonymizedFormula}, newFormula:${m.anonymizedFormula}`),f.ULS.sendTraceTag(537161877,306,20,`FormulaByExampleSuggestionsCache.cacheSuggestion: saving suggestion for table range. tableRange: ${null===(n=m.table)||void 0===n?void 0:n.usedRange}, columnNumber: ${m.column}, examplesCount ${m.py}, hasPreviousSuggestion: ${this.has(this.Owa(m))}`),(n=super.P3(m))||f.ULS.sendTraceTag(528889932,306,15,"SuggestionsCache.cacheSuggestion: failed to cache table suggestion due to getTableColumnKey failure."),
this.jB.r1(m.originCell,3),n;y.suggestion.py!==m.py&&(f.ULS.sendTraceTag(523842003,306,50,`FormulaByExampleSuggestionsCache.cacheSuggestion: formula didn't change from the last cache entry, but number of examples changed. Last example ${y.suggestion.py}, current: ${m.py}`),this.jB.r1(m.originCell,4),m.A0.py=y.suggestion.A0.py);y.suggestion.py!==m.py&&(f.ULS.sendTraceTag(523842003,306,50,`FormulaByExampleSuggestionsCache.cacheSuggestion: formula didn't change from the last cache entry, but number of examples changed. Last example ${y.suggestion.py}, current: ${m.py}`),
this.jB.r1(m.originCell,4),m.A0.py=y.suggestion.A0.py);return this.e3d(y,m)}H9h(m,n){m=Object(h.a)(m,n,this.calcManager);return m?this.kZh(m):(f.ULS.sendTraceTag(528889931,306,15,"FormulaByExampleSuggestionsCache.getTableCachedSuggestion: failed to get cached table suggestion due to getTableColumnKey failure."),null)}Owa(m){return Object(h.a)(m.table,m.column,this.calcManager)}}Object(t.a)(r,"FormulaByExampleTableSuggestionsCache",b.a,[]);class l extends Set{constructor(m){super();this.Bza=m}add(m){if(this.has(m))return this;
if(this.size>=this.Bza){const n=this.entries().next().value[0];this.delete(n)}return super.add(m)}has(m){const n=super.has(m);return n?(this.delete(m),super.add(m),!0):n}}Object(t.a)(l,"LimitedSizeSet",Set,[]);var u=a(1),v=a(25);a.d(C,"b",function(){return x});a.d(C,"a",function(){return w});const x=m=>"Table"===m.kind;class w{constructor(m,n,z,y){this.jB=m;this.fk=n;this.gridView=z;this.DLd=new e(m);this.ZDc=new r(y,m);u.EwaSettings.isChangeGateEnabled("OfficeVSO:7654591_FormulaByExampleForbiddenFormulas")&&
(this.mxb=new Map,this.pOh=u.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleForbiddenFormulasSetSize",5))}eai(m,n){let z;const y=m.vHd;var A=m.tA;if(m.f6){m=this.gridView.wb.mh(y,!1);if(!m)return f.ULS.sendTraceTag(509649310,306,10,`FormulaByExampleManager.onUserInput: getTableContainingRange returned null. flowId: ${n}, editedCellRange: ${y}`),null;if(A=this.ZDc.H9h(m,y.left))A.suggestion.table=m,z=A}else if(n=new v.Range(A.top,y.left,A.bottom,y.right,!0,!0),n=this.DLd.Mec(new c.a(n,
m.sheetId)))n.suggestion.tA=A,n.suggestion.Tkc=m.L_,z=n;return z}P3(m){return"Table"===m.kind?this.ZDc.P3(m):this.DLd.P3(m)}u3a(m){return"Table"===m.kind?this.ZDc.u3a(m):this.DLd.oph(m)}f$f(m,n){m.state=n;m.jki();u.EwaSettings.isChangeGateEnabled("OfficeVSO:7654591_FormulaByExampleForbiddenFormulas")&&this.Dch(m)}Rui(m){const n=this.gaf(m);return this.mxb.has(n)?this.mxb.get(n).has(m.formula):!1}Dch(m){switch(m.state){case "DECLINE":case "UNDO":this.a1e(m.suggestion);break;case "IGNORE":1<m.vNb&&
this.a1e(m.suggestion)}}a1e(m){let n,z=this.gaf(m);this.mxb.has(z)||(n=new l(this.pOh),this.mxb.set(z,n));n=this.mxb.get(z);n.add(m.formula)}gaf(m){return"Table"===m.kind?this.ZDc.Owa(m):this.fk.vhd(m.tA,m.tA.left-m.originCell.left,m.sheetId)}}Object(t.a)(w,"FormulaByExampleSuggestionCache",null,[])},1298:function(t,C,a){var c=a(10);t=a(0);var b=a(2),f=a(228),e=a(53),d=a(39),h=a(1);class r{constructor(){this.isFeedbackAllowed=!1;this.zoomLevel=0}}Object(t.a)(r,"FormulaAssistanceUIContext",null,[]);
var l=a(109),u=a(157),v=a(41);class x extends f.a{constructor(m){super();this.vzj="formulaAssistance";this.$=m;this.Mb()}create(){let m=this.$.da.Aa(448);if(m)this.vb(m);else{var n=h.EwaSettings.isChangeGateEnabled("OfficeVSO:7457857_DynamicScriptLoaderNewService")?l.d(u.a.resolve(v.s,{rb:this.Na})):e.GetServiceTaskFactory.Sa(this.$.da,283,284,this.Na);d.TaskExtensions.za(n,()=>{d.TaskExtensions.za(l.d(n.result.ol.loadScript(this.vzj)),()=>{m=this.$.da.Aa(448);if(!m){const z=Object(b.a)(new r,{isFeedbackAllowed:this.$.isFeedbackEnabled});
m=this.$.da.Ha(448,formulaAssistance.FormulaAssistanceUIFactoryGlobal.create(z));this.$.zEe(()=>{const y={};y.isFeedbackAllowed=this.$.isFeedbackEnabled;m.updateContext(y)})}this.vb(m)},this.$.ka,3)},this.$.ka,3)}}static la(m){m.da.Ha(449,new x(m))}}Object(t.a)(x,"FormulaAssistanceUIControlFactory",f.a,[]);a.d(C,"a",function(){return w});const w=()=>{c.a.Fa(m=>{x.la(m)})}},1322:function(t,C,a){t=a(0);var c=a(228),b=a(838),f=a(1),e=a(157),d=a(41);class h extends c.a{constructor(u){super();this.$=u;
this.Mb()}create(){(f.EwaSettings.LF()?u=>e.a.resolve(d.g).then(v=>setTimeout(()=>u(v),0)):u=>this.$.da.kb(266,u))(u=>{u=this.$.da.Aa(294)||this.$.da.Ha(294,new b.RelativeAndAbsoluteReferencesManager(u));this.vb(u)})}static la(u){u.da.Ha(295,new h(u))}}Object(t.a)(h,"RelativeAndAbsoluteReferencesManagerFactory",c.a,[]);var r=a(10);a.d(C,"a",function(){return l});const l=()=>{r.a.Fa(h.la)}},1323:function(t,C,a){var c=a(10);t=a(0);var b=a(14),f=a(901),e=a(29),d=a(205),h=a(228),r=a(233),l=a(1),u=a(55),
v=a(60),x=a(109),w=a(33),m=a(157),n=a(41);class z extends h.a{constructor(A){super();this.$=A;this.e8b=null;this.Mb()}create(){b.ULS.sendTraceTag(537154643,0,50,"PluginSchedulerFactory.Create: Loading scheduler slice");f.a.then(this.Ujh(),A=>{this.vb(A)})}Ujh(){if(this.e8b)return this.e8b;const A=r.a.T2a(u.b(),d.a.none,"LoadResource","x10Scheduler loading");if(l.EwaSettings.isChangeGateEnabled("OfficeVSO:5789323_disableSchedulerForIE")&&e.a.Ww){const F=excelOnlineCalc.PluginSchedulerSingletonGlobal.instance();
this.$.da.Ha(413,F);A.setResult(F);return this.e8b=A.task}(l.EwaSettings.LF()?F=>m.a.resolve(n.g,{rb:this.Na}).then(D=>setTimeout(()=>F(D),0)):F=>this.$.da.kb(266,F))(()=>{this.aGi(F=>{const D=excelOnlineCalc.PluginSchedulerSingletonGlobal.instance();F=x.c(v.Task.Ua(F.ol));Promise.all([excelOnlineCalc.x10.ensureGroupAttached(F,0),w.a.Nca(this.$)?excelOnlineCalc.x10.ensureGroupAttached(F,2):0]).then(B=>B.some(M=>0<M)).then(B=>{this.$.da.Ha(413,D);A.setResult(D);l.EwaSettings.isChangeGateEnabled("OfficeVSO:7445021_LogAnyPluginInitialized")&&
this.$.da.kb(491,M=>{M.YI.anyPluginInitialized=B})})})});return this.e8b=A.task}aGi(A){l.EwaSettings.isChangeGateEnabled("OfficeVSO:7457857_DynamicScriptLoaderNewService")?void m.a.resolve(n.s,{rb:this.Na}).then(F=>A(F)):this.$.da.kb(283,A)}static la(A){A.da.Ha(414,new z(A))}}Object(t.a)(z,"PluginSchedulerFactory",h.a,[]);a.d(C,"a",function(){return y});const y=()=>{c.a.Fa(A=>{z.la(A)})}},1324:function(t,C,a){var c=a(10);t=a(0);var b=a(228),f=a(721),e=a(53),d=a(39),h=a(157),r=a(1),l=a(41);class u extends b.a{constructor(x){super();
this.$=x;this.Mb()}static la(x){x.da.Ha(521,new u(x))}create(){const x=()=>excelOnlineCalc.FormulaAuthoringHelperSingletonGlobal.instance();r.EwaSettings.LF()?void h.a.resolve(l.v).then(()=>{this.vb(x())}):d.TaskExtensions.za(e.GetServiceTaskFactory.Sa(this.$.da,266,265,0),()=>{this.vb(Object(f.a)(this.$.da,520,x))},this.$.ka,3)}}Object(t.a)(u,"FormulaAuthoringHelperFactory",b.a,[]);a.d(C,"a",function(){return v});const v=()=>{c.a.Fa(x=>{u.la(x)})}},1325:function(t,C,a){t={};a.r(t);a.d(t,"GotoCtrlClick",
function(){return l});var c=a(14),b=a(159),f=a(0),e=a(157),d=a(41),h=a(472),r=a(21);let l=class{constructor(v,x){this.$=v;this.pluginScheduler=x;this.gridView=Object(r.h)(this.$)}dispose(){}};l=Object(b.b)([Object(e.d)(d.D),Object(b.c)(0,Object(d.u)()),Object(b.c)(1,Object(h.PluginSchedulerService)())],l);Object(f.a)(l,"GotoCtrlClick",null,[2]);a.d(C,"a",function(){return u});const u=()=>{c.ULS.sendTraceTag(509147148,0,50,"GotoCtrlClickBootstrapper.main: called")};String(t);window.___1680633014253_closurehack=
t},1337:function(t,C,a){t=a(0);var c=a(2),b=a(14),f=a(25),e=a(33),d=a(184),h=a(197),r=a(21),l=a(852),u=a(722);class v extends l.a{constructor(){super();this.formulasCount=this.columnNames=this.additionalInputs=this.examples=null;this.invocationMethod=this.stateID=0;this.guid=this.supportedFunctions=null;this.H_=Object.assign(new u.a,{T_:v.getTypeName(),B_:v.Td()})}static getTypeName(){return"AugLoop_FormulaByExample_FormulaByExampleSignal"}static Td(){return["AugLoop_Signals_Signal"]}}Object(t.a)(v,
"FormulaByExampleSignal",l.a,[]);var x=a(1346),w=a(60),m=a(867),n=a(1),z=a(297),y=a(882),A=a(45),F=a(106),D=a(956),B=a(955),M=a(73);a.d(C,"b",function(){return P});a.d(C,"a",function(){return E});const R={TEXTSPLIT:!1,TEXTSLICE:!1,FINDN:!1,TEXTAFTER:!1,TEXTBEFORE:!1},P={rbd:"editRange",uhb:"triggerCommand",U0d:"triggerKind",v0e:"flowId",Amf:"isInExplicitTable",jhg:"tableInnerRange",znf:"isNewRowPrediction"};class E{constructor(H,G,N,I,O){this.ZB=!1;this.$=H;this.gridView=Object(r.h)(H);this.augmentationLoopManager=
G;this.calcManager=N;this.formulaByExampleManager=I;this.l6g=O;this.fk=y.a.getInstance(this.$);this.ZB=Object(m.a)(this.$);this.yNi=n.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleMaximalNumberOfAdditionalInputRows",30);b.ULS.sendTraceTag(528758226,306,50,"FormulaByExampleCommandHandler.ctor: FBE command handler created")}Oc(){return!1}executeCommand(H,G,N){var I,O;H=!1;G=G.command;switch(G){case 1928326585:H=N&&N[P.U0d]?N[P.U0d]:0;const U=N[P.v0e];if(0===H)return b.ULS.sendTraceTag(524940245,
306,15,"FormulaByExampleManager.executeCommand: triggerFormulaByExample command called for execution with NoTrigger value."),this.fk.Ep(U,1),w.Task.Ua(!0);const ca=!N||!N[P.rbd],Q=this.ZYh(N,ca),Y=N[P.jhg],la=N[P.Amf],ea=N[P.uhb];N=N[P.znf];const ha=null===(I=this.gridView.Ob(Q))||void 0===I?void 0:I.cell.oz;ca||2!==H||this.formulaByExampleManager.E6i(U,ea,{vHd:Q,f6:la,valueType:ha,tA:Y,sheetId:Object(M.d)(null===(O=this.$.ua)||void 0===O?void 0:O.na),L_:N});H=this.triggerFormulaByExample(Q,Y,ca,
U,la)}return H?w.Task.Ua(!0):Object(h.a)(G)}Ac(H,G){switch(G.command){case 1928326585:return e.a.gkc(this.$);default:return!1}}Vc(){return!1}ZYh(H,G){b.ULS.sendTraceTag(537161928,306,50,`FormulaByExampleCommandHandler.getEditedRange: flow triggered from: ${G?"Ribbon":"AutoDetect"}`);return G?this.gridView.ga.qa.activeCell:H[P.rbd]}triggerFormulaByExample(H,G,N,I,O){if(!this.augmentationLoopManager)return b.ULS.sendTraceTag(537161927,306,10,"FormulaByExampleCommandHandler.TriggerFormulaByExample: augmentationLoopManager instance is null"),
this.fk.Ep(I,13,{reason:"AugmentationLoopManager instance is null"}),!1;G=this.I_h(H,G,N,I,O);if(!G)return this.fk.Ep(I,13,{reason:"Signal is null"}),!0;b.ULS.sendTraceTag(537161926,306,50,`FormulaByExampleCommandHandler.TriggerFormulaByExample: calling SubmitOperationSignal for flowId: ${I}, isInExplicitTable: ${O}.`);this.augmentationLoopManager.gQb(G);this.fk.Ep(I,12);this.l6g.r1(H,1);this.ZB&&Object(m.f)("SIGNALSENT",I);return!0}I_h(H,G,N,I,O){const U=this.dVh(G,H,I);if(!U)return null;let ca;
if(O){H=this.gridView.wb.mh(H,!1);if(!H)return b.ULS.sendTraceTag(537161925,306,15,"FormulaByExampleCommandHandler.TriggerFormulaByExample: table returned null for given edit range."),this.fk.Ep(I,13,{reason:"Table returned null for given edit range"}),null;ca=this.vWh(H)}else e.a.hkc(this.$)&&(ca=this.uWh(G,H));if(!ca)return null;N=Object(c.a)(new v,{formulasCount:1,examples:U.examples,additionalInputs:U.additionalInputs,columnNames:ca,stateID:this.$.ea.QEb,invocationMethod:N?0:1,guid:I.toString(),
supportedFunctions:R});b.ULS.sendTraceTag(528758225,306,50,"FormulaByExampleCommandHandler.getFormulaByExampleSignalFromTable: signal generated.");return N}dVh(H,G,N){return this.eVh(H,G,N)}vWh(H){const G=[],N=H.name;var I=Object(d.a)(H);H=this.calcManager.Hfc(H);if(I&&H){I=I.left;for(let O of H)G.push({column:I,name:N+"[@["+O+"]]"}),I++;return G}b.ULS.sendTraceTag(524940244,306,15,`FormulaByExampleCommandHandler.getColumnNamesMapFromTable: failed to generate columnNames. is tableRange null: ${!I}, is colNamesCurrentTable null: ${!H}`);
return null}uWh(H,G){const N=[];G=new f.Range(G.top,H.left,G.top,H.right,!0,!0);H=this.gridView.dk("FormulaByExample.getColumnNamesMapFromInputRange",G);for(G=G.left;H.$$mn();){const I={column:G++,name:`${f.Range.HM(H.$$cu().range.left)+B.b}`};N.push(I)}return N}eVh(H,G,N){G=G.left;let I=new Set;n.EwaSettings.isChangeGateEnabled("OfficeVSO:7126337_FBECellCycleFix")&&(I=this.B_h(H,G,N));return this.hmh(H,G,I)}B_h(H,G,N){const I=new Set,O=this.gridView.dk("FormulaByExample.getForbiddenColumnsFromRange",
H);try{for(;O.$$mn();){const U=O.$$cu(),ca=U.range,Q=ca.left;if(Q!==G&&!I.has(Q)){const Y=new f.Range(ca.top,G,ca.top,G,!1,!1);this.oti(U,Y)&&(I.add(Q),this.fk.Qqc(N,Q-(this.$.na.displayRtl?H.right:H.left)))}}}finally{O&&O.dispose()}return I}hmh(H,G,N){const I=[],O=[],U=H.right,ca=new Set;let Q=[],Y=!1,la=null;H=this.gridView.dk("FormulaByExample.createValidExamplesFromRange",H);try{for(;H.$$mn();){const ea=H.$$cu(),ha=ea.range.left,X=ha===G;X&&ea.text?la=this.RJe(ea):X||N.has(ha)||(ea.text&&(Y=!0),
Q.push(this.RJe(ea)));ha===U&&(Y&&(la?(I.push({output:la,inputs:Q}),ca.add(la.rawValueJson)):O.length<this.yNi&&O.push({output:null,inputs:Q})),Q=[],Y=!1,la=null)}}finally{H&&H.dispose()}return ca.size<D.a?(b.ULS.sendTraceTag(509683013,306,50,"FormulaByExampleCommandHandler.createValidExamplesFromRange: column does not have enough distinct examples with inputs."),null):{examples:I,additionalInputs:O}}oti(H,G){const N=H.LL,I=H.range,O=this.$.workbookContext.WorkbookFileName,U=this.$.na;if(!U)return b.ULS.sendTraceTag(509743199,
306,50,"FormulaByExampleCommandHandler.isDependingOn: this.ewaControl.activeItem returned null. Expected to be an object of type Sheet."),!1;if(!(n.EwaSettings.isChangeGateEnabled("OfficeVSO:7251463_FBEFixJsCrashOnNullActiveSheet")||U instanceof F.a))return b.ULS.sendTraceTag(509743198,306,50,"FormulaByExampleCommandHandler.isDependingOn: this.ewaControl.activeItem returned object of type other then Sheet. Expected to be an object of type Sheet."),!1;if(!this.calcManager.$lf(H.cell.si,N))return!1;
if(H=this.calcManager.extractReferences(N,U.name,O,!0,I))for(const ca of H.Items)if(Object(A.E)(ca.Range).equals(G))return!0;return!1}RJe(H){let G;if(1===H.Xr.type){G=parseFloat(H.Xr.value);var N=this.calcManager.rMa(H.cell.si);Object(z.c)(N)?N=N.value.isDate?4:N.value.isTime?5:1:(b.ULS.sendTraceTag(522840207,0,10,`FormulaByExampleCommandHandler.createAugLoopCell: CalcManager's getNumberFormat method failed on the given cell, falling back to number format. failureReason: ${N.reason}`),N=1)}else G=
H.text,N=0;return Object.assign(new x.a,{row:H.range.top,column:H.range.left,displayText:H.text,rawValueJson:JSON.stringify(G),numberFormatCategory:N.toString()})}}Object(t.a)(E,"FormulaByExampleCommandHandler",null,[233])},1390:function(t,C,a){a.r(C);a.d(C,"FormulaByExampleAutoSuggestActor",function(){return n});t=a(0);var c=a(14),b=a(25),f=a(184),e=a(98),d=a(21),h=a(867),r=a(1337),l=a(33),u=a(956),v=a(882),x=a(1),w=a(353),m=a(73);class n{constructor(z,y,A,F){this.O0c=this.ZB=!1;this.q7=(D,B)=>{D=
B.Hk;if(B.u2a){var {tA:M,f6:R,L_:P}=this.haf(D);M&&D.xd(M)?(this.qhf(D,324156914,M,R),this.esi(D)?this.BGf(D,D,M,324156914,R,P):this.ABa()):this.ABa()}else this.ABa()};this.iGd=(D,B)=>{D=B.destinationRange;if(1804571062===B.command||D.left!==D.right)this.ABa();else{var M=new b.Range(D.top,D.right,D.top,D.right,!1,!1),{tA:R,f6:P,L_:E}=this.haf(M);R?(this.qhf(M,B.command,R,P),this.BGf(M,D,R,B.command,P,E)):this.ABa()}};this.z5i=(D,B)=>{D=this.Zya.Z6g;B=B.Hk.toString();D.has(B)&&(D.delete(B),0===D.size&&
this.FPe())};this.$=z;this.gridView=d.h(z);this.calcManager=y;this.ZB=F;this.ABa();x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DetachEndEditFormulaByExampleAutoSuggestActorListener",!1)?this.gridView.hc.y1b(this.q7):this.gridView.hc.Bm(this.q7);this.calcManager.CQg(this.z5i);x.EwaSettings.isChangeGateEnabled("OfficeVSO:7395435_FormulaByExampleTriggerOnCSEPaste")&&this.gridView.due(this.iGd);this.fk=v.a.getInstance(z);if(this.O0c=l.a.hkc(this.$))this.VDc=A.cxa(),this.hxj=x.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleRowsBelowRangeTableToQuery",
1)}haf(z){const y=this.gridView.wb.mh(z,!1);if(y)return{tA:f.a(y),f6:!0,L_:!1};if(this.O0c){const {jVf:A,L_:F}=this.f6h(z);if(A)return{tA:A,f6:!1,L_:F}}return{tA:null,f6:!1,L_:!1}}f6h(z){const y=new b.Range(z.top-this.hxj,z.left,z.bottom,z.right,!0,!0),A=this.VDc.s6a(new w.a(y,Object(m.d)(this.$.na)),6);if(!A)return null;for(const F of A)for(const D of F.table.interpretations)if(2===D.orientation&&.5<D.confidence)return{jVf:new b.Range(D.fw.top+D.headerRowCount,D.fw.left+D.headerColumnCount,Math.max(D.fw.bottom,
y.bottom),D.fw.right,!0,!0),L_:!D.fw.xd(z)};return{jVf:null,L_:!1}}BGf(z,y,A,F,D,B){this.g9f(z,y,A,F,D,B);-185374993===F&&this.FPe()}qhf(z,y,A,F){var D;F?(F=this.gridView.wb.mh(z,!1),this.fk.EFf(y,F.name,z.left-(this.gridView.rtl?A.right:A.left),z.top-A.top)):this.fk.FFf(y,A,z.left-(this.gridView.rtl?A.right:A.left),z.top-A.top,Object(m.d)(null===(D=this.$.ua)||void 0===D?void 0:D.na))}esi(z){var y=this.gridView.Ob(z);if(!y)return c.ULS.sendTraceTag(524120778,306,15,`FormulaByExampleAutoSuggestActor.isCellValidForTriggeringFormulaByExample: formattedCell is null. investigation hints: is cell null = ${!z}`),
this.fk.Ep(v.b,1,{reason:"Didn't trigger since the formattedCell is null."}),!1;z=this.calcManager.$lf(y.cell.si,y.LL);(y=null!==z&&!z)||this.fk.Ep(v.b,1,{reason:`Didn't trigger since edited cell content is a formula or isFormulaCell returned null. isFormulaText is null:${null==z}`});return y}FPe(){const z=this.Qzj(this.Zya.originCell,this.Zya.tA);if(0===z)this.ABa(),this.fk.Ep(v.b,1);else{var y=this.fk.Z7e();this.fk.Ep(y,3);c.ULS.sendTraceTag(537161929,306,50,`FormulaByExampleAutoSuggestActor.tryTriggeringFormulaByExample: triggering FormulaByExample for cell edit. Trigger kind: ${z}, FlowId: ${y}`);
this.ZB&&Object(h.f)("EDITCOMMIT",y);var A=new e.a(1928326585,1,2,6,null);this.$.Ia.Nb(A,{[r.b.rbd]:this.Zya.originCell,[r.b.uhb]:this.Zya.uhb,[r.b.U0d]:z,[r.b.v0e]:y,[r.b.jhg]:this.Zya.tA,[r.b.Amf]:this.Zya.f6,[r.b.znf]:this.Zya.L_});this.ABa()}}Qzj(z,y){z=z.left;y=new b.Range(y.top,z,y.bottom,z,!0,!0);return this.Pzj(y)}Pzj(z){var y;let A=new Set,F=0;z=this.gridView.dk("FormulaByExampleAutoSuggestActor:Table",z);try{for(;z.$$mn();){const D=z.$$cu();if(null===(y=D.Xr)||void 0===y?0:y.value)if(A.add(D.Xr.value),
F++,A.size>=u.a)return 2}}finally{z&&z.dispose()}F>=u.a?(c.ULS.sendTraceTag(523368219,306,50,"FormulaByExampleAutoSuggestActor.searchForSufficientExamplesInOutputColumn: Table has sufficient example amount - but not enough distinct examples."),this.fk.Ep(v.b,1,{reason:"Didn't trigger since there aren't enough distinct outputs"})):this.fk.Ep(v.b,1,{reason:"Didn't trigger since there aren't enough examples"});return 0}ABa(){this.g9f(null,null,null,null,null,null)}g9f(z,y,A,F,D,B){this.Zya={originCell:z,
Z6g:new Set(null===y||void 0===y?void 0:y.jye(y.Cw).map(M=>M.toString())),uhb:F,tA:A,f6:D,L_:B}}}Object(t.a)(n,"FormulaByExampleAutoSuggestActor",null,[])},1474:function(t,C,a){function c(f,e,d){return{name:f,dataType:1,value:e,classification:d?d:4}}function b(f,e,d){return{name:f,dataType:0,value:e,classification:d?d:4}}a.d(C,"a",function(){return c});a.d(C,"b",function(){return b})},1531:function(t,C,a){a.r(C);t={};a.r(t);a.d(t,"DatePickerControl",function(){return I});C={};a.r(C);a.d(C,"DatePickerCommandHandler",
function(){return Q});var c=a(1125),b=a(1274),f=a(1322),e=a(1298),d=a(1229),h=a(1184),r=a(1323),l=a(1258),u=a(1212),v=a(1213),x=a(1324),w=a(1325),m=a(159),n=a(0),z=a(102),y=a(273),A=a(21),F=a(13),D=a(95),B=a(948),M=a(259),R=a(80),P=a(157),E=a(41),H=a(14),G=a(617),N;let I=N=class extends B.a{constructor(Y,la){var ea,ha;super(Y,N.featureName);this.Yza=(X,T)=>{Object(G.b)(T,this.$)&&(H.ULS.sendTraceTag(509147206,0,50,"DatePickerControl.onCellEditStarted: Encountered Date in cell, Date Picker service already available, showing date picker"),
this.TWd())};this.k7=()=>{this.Sub&&this.WOd(null,!1)};this.wDj=X=>{const T=this.gridView.hc;if(this.gridView.Ob(null)){var ua=this.calcManager.config;X=excelOnlineCalc.date.dateTime(X.getFullYear(),X.getMonth()+1,X.getDate(),X.getHours(),X.getMinutes(),X.getSeconds(),0,X.getMilliseconds(),0);X=ua.datepack.toNum(ua,X);ua=ua.mathpack.toNumber(X);this.Sub=!1;T.text=ua.toString();T.endEdit(!0,"DatePickerControl.SetCellDate",0);H.ULS.sendTraceTag(509110228,0,50,"DatePickerControl.setCellDate: User selected Date using Date Picker")}this.byc()};
this.byc=X=>{this.Sub=!1;z.FocusManager.instance().Gj(y.AFrame.y4);D.a.GMb(F.DOMElementExtensions.Kec(this.$.Df),R.a.Eb,X,this.$)};this.bSf=()=>{z.FocusManager.instance().Gj(y.AFrame.Y7)};this.$=Y;this.gridView=A.h(this.$);this.calcManager=la;null===(ea=this.gridView.hc)||void 0===ea?void 0:ea.Bm(this.k7);null===(ha=this.gridView.hc)||void 0===ha?void 0:ha.S$(this.Yza)}dispose(){var Y,la;this.Sub&&(this.Sub=!1,this.WOd(null,!1));null===(Y=this.gridView.hc)||void 0===Y?void 0:Y.yoa(this.Yza);null===
(la=this.gridView.hc)||void 0===la?void 0:la.km(this.k7);super.dispose()}get je(){return M.a.cNe}TWd(){this.WOd(this.gridView.ga.qa.activeCell,!0)}WOd(Y=null,la){this.FWd(Y,ea=>{appChrome.renderDatePicker(this.domElement,ea.y,ea.x,ea.y+ea.height,ea.x+ea.width,la,la?this.JVh():new Date,this.wDj,this.byc,this.bSf,this.rUd)});this.Sub=la}JVh(){var Y;let la=new Date;var ea=null===(Y=this.gridView.Ob(null))||void 0===Y?void 0:Y.cell;ea&&this.calcManager.kti(ea.si)&&1===ea.oz&&(Y=this.calcManager.config,
ea=Y.mathpack.fromNumber(parseInt(ea.cellValue,10)),ea=Y.datepack.fromNum(Y,ea,0),la=new Date(ea.yr,ea.mon-1,ea.dom));return la}Bj(){this.bSf()}hk(){this.byc()}};I=N=Object(m.b)([Object(P.d)(E.q),Object(m.c)(0,Object(E.u)()),Object(m.c)(1,Object(E.g)())],I);Object(n.a)(I,"DatePickerControl",B.a,[2]);var O=a(197),U=a(60),ca=a(1);let Q=class{constructor(Y){this.Dnh=Y}Oc(){return!1}executeCommand(Y,la){Y=!1;la=la.command;switch(la){case 1159342996:this.Dnh.TWd(),Y=!0}return Y?U.Task.Ua(!0):O.a(la)}Ac(Y,
la){switch(la.command){case 1159342996:return ca.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DatePicker",!1);default:return!1}}Vc(){return!1}};Q=Object(m.b)([Object(P.d)(E.p),Object(m.c)(0,Object(E.q)())],Q);Object(n.a)(Q,"DatePickerCommandHandler",null,[233]);Object(c.a)();Object(b.a)();Object(f.a)();Object(e.a)();Object(d.a)();Object(h.a)();Object(r.a)();Object(l.a)();Object(u.a)();Object(v.a)();Object(x.a)();Object(w.a)();String(t);String(C);window.___1680633106570_closurehack=t;
window.___1680633106570_closurehack=C},804:function(t,C,a){a.d(C,"a",function(){return c});t=a(0);class c{}c.VTe="ewa-ac";c.xyh="ewa-ac-param";c.TUe="ewa-function-help-link";c.Rac="ewa-lb";c.OUe="ewa-fb-refactor";c.listItem="list-item";c.hFb="list-item-selected";c.lFb="list-table-touch";c.kFb="list-table";c.TDh="ewa-suggested-cell-name";c.cah="columnName-header";c.JVe="ewa-tt";c.qBh="ewa-function-link-container";c.UUe="ewa-function-udf-name";c.rtl="rtl";Object(t.a)(c,"CssClassNames",null,[])},838:function(t,
C,a){a.r(C);t=a(0);var c=a(2),b=a(14);class f{}Object(t.a)(f,"Reference",null,[]);class e extends f{constructor(){super();this.column=this.row=null}}Object(t.a)(e,"CellReference",f,[]);class d{constructor(){this.end=this.start=0;this.Or=null}vWg(D,B){for(let M=0;M<this.Or.length;M++){const R=this.R2b(D,this.Or[M]);B+=R;M<this.Or.length-1&&(B+=":")}return B}}Object(t.a)(d,"IReferenceSequence",null,[]);var h=a(25),r=a(831);class l extends d{constructor(){super();this.plc=!1}afc(){const {RelativeAndAbsoluteReferencesManager:D}=
a(838),B=this.Or[0];return D.QAf(B.row.kind===r.a.abs,B.column.kind===r.a.abs)}R2b(D,B){B=h.Range.Lc(B.row.index+1,B.column.index+1);return this.plc?B.kyb(1===D||3===D,1===D||2===D):B.uMa(1===D||3===D,1===D||2===D,!0,!0)}}Object(t.a)(l,"CellReferenceSequence",d,[]);class u extends f{constructor(){super();this.secondColumn=this.firstColumn=null}}Object(t.a)(u,"ColumnReference",f,[]);class v extends d{constructor(){super()}afc(){const D=this.Or[0];return a(838).RelativeAndAbsoluteReferencesManager.nzf(D.firstColumn,
D.secondColumn).kind===r.a.abs?2:3}R2b(D,B){return h.Range.uxb(B.firstColumn.index+1,B.secondColumn.index+1).uMa(1===D||3===D,!0,1===D||3===D,!0)}}Object(t.a)(v,"ColumnReferenceSequence",d,[]);class x extends f{constructor(){super();this.right=this.left=this.bottom=this.top=null}}Object(t.a)(x,"RangeReference",f,[]);class w extends d{constructor(){super()}afc(){const {RelativeAndAbsoluteReferencesManager:D}=a(838),B=this.Or[0];return D.QAf(B.top.kind===r.a.abs,B.left.kind===r.a.abs)}R2b(D,B){B=new h.Range(B.top.index+
1,B.left.index+1,B.bottom.index+1,B.right.index+1,!1,!1);const M=1===D||3===D;D=1===D||2===D;return B.uMa(M,D,M,D)}}Object(t.a)(w,"RangeReferenceSequence",d,[]);class m extends f{constructor(){super();this.secondRow=this.firstRow=null}}Object(t.a)(m,"RowReference",f,[]);class n extends d{constructor(){super()}afc(){const D=this.Or[0];return a(838).RelativeAndAbsoluteReferencesManager.nzf(D.firstRow,D.secondRow).kind===r.a.abs?0:1}R2b(D,B){return h.Range.ddc(B.firstRow.index+1,B.secondRow.index+1).uMa(!0,
1===D||2===D,!0,1===D||2===D)}}Object(t.a)(n,"RowReferenceSequence",d,[]);var z=a(1095),y=a(1096),A=a(186);a.d(C,"RelativeAndAbsoluteReferencesManager",function(){return F});class F{constructor(D){this.calcManager=D}k3a(D,B,M){let R,P;R=B;P=M;if(!D||!A.f(D))return{returnValue:D,SCd:R,RCd:P};var E=this.calcManager.lZe(D);if(!E)return b.ULS.sendTraceTag(524039641,0,15,"RelativeAndAbsoluteReferencesManager.CycleThroughRelativeAndAbsoluteReferences: Couldn't extract references (might be invalid formula)"),
{returnValue:null,SCd:R,RCd:P};E=this.Z7h(E,D,B,M);let H=0,G="",N=0,I=0;for(;I<E.length;I++)if(this.pQe(E[I],B,M)){H=E[I].afc();R=E[I].start;break}for(;I<E.length&&this.pQe(E[I],B,M);I++)G+=D.substring(N,E[I].start),G=E[I].vWg(H,G),N=E[I].end;N&&(P=G.length);G+=D.substring(N,D.length);return{returnValue:G,SCd:R,RCd:P}}Z7h(D,B,M,R){const P=[];for(let N=0;N<D.length;N++){var E=D[N];if(E.kind===z.a.range)if(E=E.ref,E.type===y.a.cell){var H=E;E=Object(c.a)(new l,{start:E.span.start,end:E.span.end,Or:[Object(c.a)(new e,
{column:H.col,row:H.row})],plc:this.calcManager.q5b(E.span.end,B)});P.push(E)}else if(E.type===y.a.range)this.qQe(E.topLeftSpan,M,R)&&this.qQe(E.bottomRightSpan,M,R)?(H=new x,E.top.index<=E.bottom.index?(H.top=E.top,H.bottom=E.bottom):(H.bottom=E.top,H.top=E.bottom),E.left.index<=E.right.index?(H.left=E.left,H.right=E.right):(H.right=E.left,H.left=E.right),E=Object(c.a)(new w,{start:E.topLeftSpan.start,end:E.bottomRightSpan.end,Or:[H]}),P.push(E)):(H=Object(c.a)(new l,{start:E.topLeftSpan.start,end:E.topLeftSpan.end,
Or:[Object(c.a)(new e,{column:E.left,row:E.top})],plc:this.calcManager.q5b(E.topLeftSpan.end,B)}),E=Object(c.a)(new l,{start:E.bottomRightSpan.start,end:E.bottomRightSpan.end,Or:[Object(c.a)(new e,{column:E.right,row:E.bottom})],plc:this.calcManager.q5b(E.topLeftSpan.end,B)}),P.push(H),P.push(E));else if(E.type===y.a.column){H=E;for(E=Object(c.a)(new v,{start:E.span.start,end:E.span.end,Or:[Object(c.a)(new u,{firstColumn:H.startIndex,secondColumn:H.endIndex})]});E.end<B.length-1&&":"===B.charAt(E.end)&&
N<D.length-1;)if(H=D[N+1].ref,H.type===y.a.column&&H.span.start===E.end+1){var G=H;E.Or.push(Object(c.a)(new u,{firstColumn:G.startIndex,secondColumn:G.endIndex}));E.end=H.span.end;N++}else break;P.push(E)}else if(E.type===y.a.row){H=E;for(E=Object(c.a)(new n,{start:E.span.start,end:E.span.end,Or:[Object(c.a)(new m,{firstRow:H.startIndex,secondRow:H.endIndex})]});E.end<B.length-1&&":"===B.charAt(E.end)&&N<D.length-1;)if(H=D[N+1].ref,H.type===y.a.row&&H.span.start===E.end+1)G=H,E.Or.push(Object(c.a)(new m,
{firstRow:G.startIndex,secondRow:G.endIndex})),E.end=H.span.end,N++;else break;P.push(E)}}return P}pQe(D,B,M){return!(D.start>M||B>D.end)}qQe(D,B,M){return!(D.start>M||B>D.end)}static nzf(D,B){return D.index<=B.index?D:B}static QAf(D,B){return B||D?B&&D?2:!B&&D?3:0:1}}Object(t.a)(F,"RelativeAndAbsoluteReferencesManager",null,[545])},867:function(t,C,a){a.d(C,"h",function(){return h});a.d(C,"g",function(){return l});a.d(C,"f",function(){return u});a.d(C,"b",function(){return v});a.d(C,"c",function(){return x});
a.d(C,"e",function(){return w});a.d(C,"d",function(){return m});a.d(C,"a",function(){return z});t=a(0);var c=a(12),b=a(330),f=a(14),e=a(33),d=a(1287);const h=(D,B,M,R)=>{const P={["flowId"]:D.flowId,["originFormulaFlowId"]:D.A0.flowId,["formulaAnonymized"]:D.anonymizedFormula,["originalFormulaAnonymized"]:D.A0.anonymizedFormula,["range"]:D.range,["failureReason"]:B,["isTableSuggestion"]:Object(d.b)(D)};f.ULS.sendTraceTag(221794372,306,20,`FormulaByExample suggestion display failure reported. Failure data ${JSON.stringify(P)}`);
M&&M.Ep(D.flowId,R,{reason:B})};var r;(function(D){D.EXAMPLE="EXAMPLE";D.MODIFIEDEXAMPLE="MODIFIEDEXAMPLE";D.RESTOFRANGE="RESTOFRANGE";D.MODIFIEDRESTOFRANGE="MODIFIEDRESTOFRANGE"})(r||(r={}));Object(t.b)("suggestionCellType",r);const l=(D,B,M,R,P,E)=>{f.ULS.sendTraceTag(512350163,0,50,`Cell data didn't match suggestion output on FlowId: ${P.flowId}. cellType: ${E} caller: ${R}:
      CellData: ${F(D)}, CellFormatIndex: ${M}, SuggestionOutput: ${F(B)},
      SuggestedFormula: ${P.anonymizedFormula}}`)},u=(D,B,M)=>{try{const R=y(D,B,M);window.performance.mark(R)}catch(R){f.ULS.sendTraceTag(529109767,0,10,`FormulaByExampleTelemetryGenerator.markPerformancePoint: Error thrown : ${R.message}`)}},v=D=>{for(const B in n)try{window.performance.clearMarks(y(B,D,!1)),window.performance.clearMarks(y(B,D,!0))}catch(M){f.ULS.sendTraceTag(527005662,0,10,`FormulaByExampleTelemetryGenerator.clearPerformanceFlowMarks: Error thrown : ${M.message}`)}},x=D=>A(`FBE_flowCurrentDuration_${D}`,
y(n.EditCommit,D,!1)),w=(D,B)=>{try{return{["EditCommitToSignal"]:A(`FBE_EditCommitToSignal_${B}_${D}`,y(n.EditCommit,B,!1),y(n.SignalSent,B,!1)),["WorkflowAndNetworkTime"]:D?0:A(`FBE_WorkflowAndNetworkTime_${B}_${D}`,y(n.SignalSent,B,!1),y(n.AnnotationReceived,B,!1)),["Calculation"]:A(`FBE_Calculation_${B}_${D}`,y(n.CalculationStart,B,D),y(n.CalculationEnd,B,D)),["ModelUpdate"]:A(`FBE_ModelUpdate_${B}_${D}`,y(n.CalculationEnd,B,D),y(n.ModelUpdated,B,D)),["PreviewRender"]:A(`FBE_PreviewRendered_${B}_${D}`,
y(n.ModelUpdated,B,D),y(n.PreviewRendered,B,D)),["Total"]:A(`FBE_Total_${B}_${D}`,y(n.EditCommit,B,!1),y(n.PreviewRendered,B,D))}}catch(M){f.ULS.sendTraceTag(529109766,0,10,`FormulaByExampleTelemetryGenerator.getPreviewShownDurations: Error thrown : ${M.message}`)}},m=(D,B)=>{try{return{["UserInPreviewDuration"]:A(`FBE_InputToPreviewRemovedWithCSE_${B}_${D}`,y(n.PreviewRendered,B,D),y(n.UserInputArrived,B,D)),["InputToPreviewRemovedWithCSE"]:A(`FBE_InputToPreviewRemovedWithCSE_${B}_${D}`,y(n.UserInputArrived,
B,D),y(n.PreviewRemovedWithCSE,B,D))}}catch(M){f.ULS.sendTraceTag(529109765,0,10,`FormulaByExampleTelemetryGenerator.getPreviewRemovedDurations: Error thrown : ${M.message}`)}};var n;(function(D){D.EditCommit="EDITCOMMIT";D.SignalSent="SIGNALSENT";D.AnnotationReceived="ANNOTATIONRECEIVED";D.CalculationStart="CALCULATIONSTART";D.CalculationEnd="CALCULATIONED";D.ModelUpdated="MODELUPDATED";D.PreviewRendered="PREVIEWRENDERED";D.UserInputArrived="USERINPUTARRIVED";D.PreviewRemovedWithCSE="PREVIEWREMOVEDWITHCSE"})(n||
(n={}));Object(t.b)("FormulaByExampleFlowMarks",n);const z=D=>c.HelperMethods.B2c&&b.a.Lrb&&e.a.ACb(D),y=(D,B,M)=>`${D}_${B+(M?"_cached":"")}`,A=(D,B,M)=>{const R=window.performance.measure(D,B,M);if(R)return B=R.duration,performance.clearMeasures(D),B;f.ULS.sendTraceTag(526984791,0,15,`FormulaByExampleTelemetryGenerator.measureTime: could not find performance entry for measure: ${D}, startMark: ${B}, endMark: ${M}`);return-1},F=D=>D.replace(RegExp("[0-9a-zA-Z]","g"),B=>"a"<=B&&"z">=B?"a":"A"<=B&&
"Z">=B?"A":"0"<=B&&"9">=B?"9":B)},882:function(t,C,a){t=a(0);var c=a(14),b=a(430),f=a(1),e;(function(R){R[R.UserEditedInTable=0]="UserEditedInTable";R[R.FormulaByExampleNoTrigger=1]="FormulaByExampleNoTrigger";R[R.FlowInterrupted=2]="FlowInterrupted";R[R.FormulaByExampleFullTrigger=3]="FormulaByExampleFullTrigger";R[R.HadCachedSuggestion=4]="HadCachedSuggestion";R[R.NoCachedSuggestion=5]="NoCachedSuggestion";R[R.PreCalcPreviewRejected=6]="PreCalcPreviewRejected";R[R.WaitingForCalcResult=7]="WaitingForCalcResult";
R[R.PostCalcPreviewRejected=8]="PostCalcPreviewRejected";R[R.SuggestionDidntMatch=9]="SuggestionDidntMatch";R[R.SuggestionMatched=10]="SuggestionMatched";R[R.PreviewShouldBeShown=11]="PreviewShouldBeShown";R[R.SignalSent=12]="SignalSent";R[R.NoSignalSent=13]="NoSignalSent";R[R.AnnotationReceived=14]="AnnotationReceived";R[R.NoFormulaFound=15]="NoFormulaFound";R[R.FormulaFound=16]="FormulaFound";R[R.WorkbookClosed=17]="WorkbookClosed";R[R.UnexpectedTransition=18]="UnexpectedTransition"})(e||(e={}));
Object(t.b)("FormulaByExampleFlowState",e);const d=new Map([[e.UserEditedInTable,[e.FormulaByExampleNoTrigger,e.FormulaByExampleFullTrigger]],[e.FormulaByExampleFullTrigger,[e.FlowInterrupted,e.NoCachedSuggestion,e.HadCachedSuggestion]],[e.NoCachedSuggestion,[e.NoSignalSent,e.SignalSent]],[e.HadCachedSuggestion,[e.PreCalcPreviewRejected,e.WaitingForCalcResult]],[e.PreCalcPreviewRejected,[e.NoSignalSent,e.SignalSent]],[e.WaitingForCalcResult,[e.NoSignalSent,e.SignalSent]]]),h=new Set([e.FormulaByExampleNoTrigger,
e.FlowInterrupted,e.NoSignalSent,e.SignalSent]),r=new Map([[e.PreCalcPreviewRejected,[e.SuggestionDidntMatch,e.SuggestionMatched]]]),l=new Set([e.SuggestionDidntMatch,e.SuggestionMatched]),u=new Map([[e.WaitingForCalcResult,[e.PostCalcPreviewRejected,e.SuggestionDidntMatch,e.SuggestionMatched]],[e.SuggestionDidntMatch,[e.PostCalcPreviewRejected,e.PreviewShouldBeShown]],[e.SuggestionMatched,[e.PostCalcPreviewRejected,e.PreviewShouldBeShown]]]),v=new Set([e.PostCalcPreviewRejected,e.PreviewShouldBeShown]),
x=new Map([[e.SignalSent,[e.AnnotationReceived]],[e.AnnotationReceived,[e.NoFormulaFound,e.FormulaFound]],[e.FormulaFound,[e.PreCalcPreviewRejected,e.WaitingForCalcResult]]]),w=new Set([e.NoFormulaFound,e.FormulaFound]),m=new Set([e.NoFormulaFound,e.PreCalcPreviewRejected,e.WaitingForCalcResult]);var n;(function(R){R[R.Initial=0]="Initial";R[R.Pending=1]="Pending";R[R.Resolved=2]="Resolved"})(n||(n={}));Object(t.b)("SignalState",n);var z=a(159);class y{constructor(R,P,E){this.currentState=R;this.AUj=
P;this.zLh=E}Gva(R){const P=this.AUj.get(this.currentState);return P&&P.includes(R)?(this.currentState=R,!0):!1}get isActive(){return!this.zLh.has(this.currentState)}Bld(){return e[this.currentState]}}Object(t.a)(y,"FormulaByExampleStateMachine",null,[]);class A{constructor(R,P,E,H,G,N){this.bYi=N;this.itc=new y(0,d,h);this.d5={flowId:R,aah:P,cxj:E,uhb:H,aqc:null,w0e:!1,pTd:!1,pUa:0,f6:G,x0e:{},JDe:new Set}}get pUa(){return this.d5.pUa}set flowId(R){this.d5.flowId=R}Qqc(R){this.d5.JDe.add(R)}Gva(R,
P){17===R?this.caa():(this.zac(R,P),this.wUg())}caa(){this.bYi(this.d5)}zac(R,P){var E,H;this.itc.Gva(R)?this.f2i(R):(null===(E=this.x1a)||void 0===E?0:E.Gva(R))?this.yUi(R):(null===(H=this.oCc)||void 0===H?0:H.Gva(R))?this.Y4i(R,P):this.n0i(R,P);(R=this.G7e(R))&&this.Jre(R,P)}f2i(R){switch(R){case 2:this.d5.w0e=!0;break;case 6:this.x1a=new y(R,r,l);break;case 7:this.x1a=new y(R,u,v);break;case 12:this.d5.pUa=1,this.oCc=new y(R,x,f.EwaSettings.isChangeGateEnabled("OfficeVSO:6169955_ShowFormulaByExampleSuggestionsUponArrivalFromServer")?
m:w)}}yUi(R){switch(R){case 9:this.d5.pTd=!1;break;case 10:this.d5.pTd=!0}}Y4i(R,P){switch(R){case 14:this.d5.pUa=2;break;case 16:this.d5.aqc=P?P.aqc:null;break;case 7:this.x1a=new y(R,u,v)}}n0i(R,P){this.Jre(this.G7e(18),{reason:`${`Tried to change state from ${this.rCj()} to ${e[R]}`}.${this.u9e(P)}`});this.caa()}wUg(){var R,P;this.itc.isActive||(null===(R=this.x1a)||void 0===R?0:R.isActive)||(null===(P=this.oCc)||void 0===P?0:P.isActive)||this.caa()}Jre(R,P){if(P=this.u9e(P))R.explanation||(R.explanation=
""),R.explanation+=P;P=R.name;R=Object(z.d)(R,["name"]);this.d5.x0e[P]=R}u9e(R){return null!=R&&null!=R.reason?" "+R.reason:""}rCj(){var R,P;const E=`OriginStateMachine: ${this.itc.isActive?this.itc.Bld():"NotActive"}`,H=`CalcStateMachine: ${(null===(R=this.x1a)||void 0===R?0:R.isActive)?this.x1a.Bld():"NotActive"}`;R=`SignalStateMachine: ${(null===(P=this.oCc)||void 0===P?0:P.isActive)?this.oCc.Bld():"NotActive"}`;return`[${E}, ${H}, ${R}]`}G7e(R){switch(R){case 1:return this.IU("FBEFullTrigger",
!1);case 3:return this.IU("FBEFullTrigger",!0);case 5:return this.IU("CachedSuggestion",!1);case 4:return this.IU("CachedSuggestion",!0);case 6:return this.IU("PreviewShouldBeShown",!1,"Before calling calc evaluation");case 8:return this.IU("PreviewShouldBeShown",!1,"After returning from Calc");case 9:return this.IU("SetCellMatchedSuggestion",!1);case 10:return this.IU("SetCellMatchedSuggestion",!0);case 11:return this.IU("PreviewShouldBeShown",!0);case 8:return this.IU("PreviewShouldBeShown",!1,
"After returning from Calc");case 15:return this.IU("FormulaFound",!1);case 16:return this.IU("FormulaFound",!0);case 18:return this.IU("UnexpectedTransition",!0)}return null}IU(R,P,E){return E?{name:R,value:P,explanation:E}:{name:R,value:P}}}Object(t.a)(A,"FormulaByExampleFlowDataAggregator",null,[]);a.d(C,"b",function(){return-1});a.d(C,"a",function(){return F});class F{static getInstance(R){this.instance||(f.EwaSettings.isChangeGateEnabled("OfficeVSO:7041480_FormulaByExampleFlowAggregatorFixed")?
this.instance=D.getInstance(R):this.instance=M.getInstance(R));return this.instance}}Object(t.a)(F,"FormulaByExampleFlowsTrackerFactory",null,[]);class D{constructor(R){this.nextId=1;this.Oif=this.kRb=0;this.qV=new Map;this.c_d=new Map;this.XGe=new Map;this.Dc=()=>{const P=this.F4h();if(0!==P.size){this.$.sendBeaconTraceTag(526984790,50,!1,`some pending FBE flows were not resolved by workbook closure. Total flows amount in sessions: ${this.kRb}, Unresolved flows amount: ${P.size}, pending flows: ${[...P].join()}, interrupted flows amount ${this.Oif}`);
for(const E of P)this.Ep(E,17)}};this.$Vj=P=>{const E=P.flowId;var H=P.aah;const G=P.cxj,N=P.uhb,I=P.aqc,O=P.w0e,U=P.pTd,ca=P.pUa,Q=P.x0e,Y=P.JDe,la=P.f6,ea=this.z8e(H);P=ea.Lsf;const ha=P!==I;ha&&(ea.Fgg++,ea.Lsf=I);U&&ea.uRe++;O&&this.Oif++;2===ca&&this.kRb++;H={["flowId"]:E,["columnKey"]:H,["rowNumber"]:G,["triggerCommand"]:Object(b.a)(N),["flowDataAggergation"]:Q,["editOperationsInColumn"]:ea.lRe,["suggestionChangesInColumn"]:ea.Fgg,["gotNewSuggestion"]:ha,["matchedSuggestionsInColumn"]:ea.uRe,
["cellCycleColumns"]:Array.from(Y).sort(),["rowsEditedInColumn"]:Array.from(ea.rRe).sort(),["isInExplicitTable"]:la};c.ULS.sendTraceTag(512365781,0,null!=P||null!=I?20:50,`FormulaByExampleFlowsTracker.summarizeFlowOverallData: Flow Aggregation results: ${JSON.stringify(H)}`);this.qV.set(E,void 0)};this.$=R;this.$.wj(this.Dc);this.MSd=new B}static getInstance(R){D.instance||(D.instance=new D(R));return D.instance}Z7e(){const R=this.nextId++,P=this.qV.get(-1);P?(P.flowId=R,this.qV.set(R,P),this.qV.delete(-1)):
c.ULS.sendTraceTag(512503829,0,15,`FormulaByExampleFlowsTracker.getNewFlowId: on flowId ${R} called getNewFlowId without having matched anonymousFlow`);return R}Olf(R){const P=this.qV.has(R),E=this.qV.get(R),H=E&&1===E.pUa;let G;P?E?H||(G="The flow exists but is not pending for annotation"):G="Flow was resolved already":G="This flow does not exist";G&&c.ULS.sendTraceTag(509650145,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: flow is not pending for annotation. ${G} flowId: ${R}`);
return H}RLf(R,P,E,H){this.qV.get(-1)&&(this.Ep(-1,2),this.qV.delete(-1));const G=this.z8e(R);G.lRe++;G.rRe.add(P);this.qV.set(-1,new A(-1,R,P,H,E,this.$Vj))}EFf(R,P,E,H){P=this.b3e(P,E);this.RLf(P,H,!0,R)}FFf(R,P,E,H,G){P=this.vhd(P,E,G);this.RLf(P,H,!1,R)}Qqc(R,P){const E=this.qV.get(R);E?E.Qqc(P):this.$0f("onCellCycleFound",R)}Ep(R,P,E){const H=this.qV.get(R);H?H.Gva(P,E):this.$0f("notifyFlowReachedState",R,P)}b3e(R,P){let E=this.c_d.get(R);void 0===E&&(E=this.c_d.size,this.c_d.set(R,E));return E+
"_"+P}vhd(R,P,E){let H,G=this.MSd.N9h(E);G?G.find((N,I)=>{H=I;return N.xd(R)})||(this.MSd.jse(E,R),H=G.length-1):(H=0,this.MSd.jse(E,R));return`${E}_${H}_${P}`}F4h(){const R=new Set;for(const [P,E]of this.qV)1===(null===E||void 0===E?void 0:E.pUa)&&R.add(P);return R}z8e(R){let P=this.XGe.get(R);P||(P={lRe:0,uRe:0,Fgg:0,Lsf:null,rRe:new Set},this.XGe.set(R,P));return P}$0f(R,P,E){const H=this.qV.has(P);c.ULS.sendTraceTag(509678805,0,15,`FormulaByExampleFlowsTracker.${R}:
       on flowId ${P} ${E?` transition to ${e[E]}`:""}, `+"flowIdsToAggregatorsMap didn't find the requested flowAggregatoror. "+`Did flow exist: ${H}`)}}Object(t.a)(D,"FormulaByExampleFlowsTracker",null,[629]);class B{constructor(){this.XDc=new Map}jse(R,P){this.XDc.has(R)||this.XDc.set(R,[]);this.XDc.get(R).push(P)}N9h(R){return this.XDc.get(R)}}Object(t.a)(B,"SensedTablesHeatMap",null,[]);class M{constructor(R){this.nextId=1;this.bxb=new Set;this.kRb=0;this.Dc=()=>{let P=this.bxb.size;0!==P&&this.$.sendBeaconTraceTag(526984790,
50,!1,"some pending FBE flows were not resolved by workbook closure. Total flows amount in sessions: {0}, Unresolved flows amount: {1}, pending flows: {2}",this.kRb,P,[...this.bxb].join())};this.$=R;this.$.wj(this.Dc)}static getInstance(R){M.instance||(M.instance=new M(R));return M.instance}Olf(R){return this.bxb.has(R)}EFf(){}FFf(){}Qqc(){}b3e(){return null}vhd(){return null}Ep(R,P){switch(P){case 12:this.JEj(R);break;case 14:this.KEj(R)}}Z7e(){return this.nextId++}JEj(R){this.bxb.add(R);this.kRb++}KEj(R){this.bxb.delete(R)}}
Object(t.a)(M,"FormulaByExampleFlowsTrackerDeprecated",null,[629])},953:function(t,C,a){a.d(C,"a",function(){return c});const c={index:0,length:0}},954:function(t,C,a){a.d(C,"a",function(){return c});a.d(C,"c",function(){return b});a.d(C,"b",function(){return f});t=a(1474);a=a(783);C=[Object(t.b)("featureNameField","FormulaSmartSuggestions"),Object(t.b)("ver","1.0.0")];const c={eventName:"Office.Excel.FormulaSmartSuggestions.Seen",eventFlags:a.a,dataFields:[...C,Object(t.a)("isFeatureSeen",!0)]},
b={eventName:"Office.Excel.FormulaSmartSuggestions.Tried",eventFlags:a.a,dataFields:[...C,Object(t.a)("isFeatureTried",!0)]},f={eventName:"Office.Excel.FormulaSmartSuggestions.Succeeded",eventFlags:a.a,dataFields:[...C,Object(t.a)("isFeatureSucceeded",!0)]}},955:function(t,C,a){a.d(C,"b",function(){return"<<<FBE_XL_RW>>>"});a.d(C,"a",function(){return c});t=a(0);a=a(1130);class c extends a.a{constructor(b,f,e,d){super(b,f,e,d);this.kind="Range";this.tA=d.tA;this.Tkc=d.L_}get formula(){const b=super.formula;
return b?b.replace(RegExp("<<<FBE_XL_RW>>>","g"),`${this.originCell.top}`):null}get y1e(){return super.formula}get Tkc(){return this.hDg}set Tkc(b){this.hDg=b}get tA(){return this.ZIg}set tA(b){this.ZIg=b}}Object(t.a)(c,"FormulaByExampleRangeSuggestion",a.a,[])},956:function(t,C,a){a.d(C,"a",function(){return 2})},986:function(t,C,a){t=a(0);var c;(function(r){r.accept="ACCEPT";r.undo="UNDO";r.decline="DECLINE";r.ignore="IGNORE"})(c||(c={}));Object(t.b)("PreviewOutcome",c);a.d(C,"b",function(){return f});
a.d(C,"c",function(){return d});a.d(C,"a",function(){return h});var b;(b||(b={})).unseen="UNSEEN";Object(t.b)("EntryState",b);const f=Object.assign(Object.assign({},b),c);class e{constructor(r){this.state=f.unseen;this.vNb=0;this.suggestion=r}jki(){this.vNb+=1}}Object(t.a)(e,"SuggestionEntryInternal",null,[]);class d extends Map{P3(r){const l=this.Owa(r);if(!l)return null;let u=this.get(l);u||(u=[],this.set(l,u));r=new e(r);u.push(r);return r}u3a(r){r=this.Kyb(r);return this.vph(r)}vph(r){if(r){var l=
this.Owa(r.suggestion);l=this.get(l);l.splice(l.indexOf(r));return!0}return!1}Eng(r){const l=this.Kyb(r);return this.e3d(l,r)}e3d(r,l){r&&(r.suggestion=l);return r}}Object(t.a)(d,"SuggestionsCache",Map,[]);class h extends d{kZh(r){var l;return null===(l=super.get(r))||void 0===l?void 0:l[0]}Kyb(r){return(r=this.Owa(r))?this.has(r)?this.get(r)[0]:null:null}P3(r){const l=this.Owa(r);if(!l)return null;r=new e(r);this.set(l,[r]);return r}u3a(r){return(r=this.Owa(r))?this.delete(r):!1}}Object(t.a)(h,"SingularSuggestionsCache",
d,[])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSOpt.edt.js.map/71ef9bfb9ab4cea0c07e6b09a23927c6/EwaDSOpt.edt.js.map